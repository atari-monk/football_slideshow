"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[792],{208:(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{let TEXT_ENCODER,TEXT_DECODER;var LogLevel,Direction,Axis,AnimationType,PacketType,LogLevel1,dto_Direction_Direction,Axis1,AnimationType1,PacketType1,socket_io_parser_build_esm_namespaceObject={};__webpack_require__.r(socket_io_parser_build_esm_namespaceObject),__webpack_require__.d(socket_io_parser_build_esm_namespaceObject,{Decoder:()=>Decoder,Encoder:()=>Encoder,PacketType:()=>PacketType1,protocol:()=>build_esm_protocol});var componentList_componentList={debugUI:"debugUI",transform:"transform",boxCollider:"boxCollider",sprite:"sprite",rigidBody:"rigidBody",gameState:"gameState",insideBoxCollider:"insideBoxCollider",circleCollider:"circleCollider",collisionObject:"collisionObject",limitMove:"limitMove",direction:"direction",kick:"kick",keyMap:"keyMap",markerPoints:"markerPoints",score:"score",canvasScale:"canvasScale"},InputDto_InputDto=function(){function InputDto(){this._id="",this._direction=[]}var _proto=InputDto.prototype;return _proto.addDirection=function(direction){this._direction||(this._direction=[]),this._direction.includes(direction)||this._direction.push(direction)},_proto.removeDirection=function(direction){if(this._direction){var index=this._direction.indexOf(direction);-1!==index&&this._direction.splice(index,1),0===this._direction.length&&(this._direction=void 0)}},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(InputDto.prototype,[{key:"id",get:function(){return this._id},set:function(id){this._id=id}},{key:"direction",get:function(){return this._direction},set:function(direction){this._direction=direction}}]),InputDto}(),Component=function(){function Component(){this._id=""}var _proto=Component.prototype;return _proto.toJSON=function(){return{}},_proto.update=function(_deltaTime){},_proto.render=function(_deltaTime){},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Component.prototype,[{key:"id",get:function(){return this._id},set:function(id){this._id=id}}]),Component}();function _set_prototype_of(o,p){return(_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ClientMovement_ClientMovement=function(Component){var protoProps;function ClientMovement(){var _this;return _this=Component.apply(this,arguments)||this,_this._inputDto=new InputDto_InputDto,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_set_prototype_of(subClass,superClass)}(ClientMovement,Component),protoProps=[{key:"inputDto",get:function(){return this._inputDto}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ClientMovement.prototype,protoProps),ClientMovement}(Component);function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ClientComponentMapperFactory=function(){function ClientComponentMapperFactory(){}var _proto=ClientComponentMapperFactory.prototype;return _proto.createComponentMapper=function(mapper){return this.addNewComponentToList(),this.addNewComponentMapper(mapper),mapper},_proto.addNewComponentToList=function(){componentList_componentList.clientMovement="clientMovement"},_proto.addNewComponentMapper=function(mapper){mapper.mappers.clientMovement=this.mapClientMovement.bind(this)},_proto.mapClientMovement=function(data){var c=new ClientMovement_ClientMovement;c.id=data.id,c.inputDto.id=data.inputDto.id;for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return _array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(data.inputDto.direction);!(_step=_iterator()).done;){var _c_inputDto_direction,item=_step.value;null==(_c_inputDto_direction=c.inputDto.direction)||_c_inputDto_direction.push(item)}return c},ClientComponentMapperFactory}();function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var Configuration=function(){function Configuration(){this.config={}}var _proto=Configuration.prototype;return _proto.get=function(){return _extends({},this.config)},_proto.update=function(config){this.config=_extends({},this.config,config)},_proto.load=function(filePath){var _this=this;return _async_to_generator(function(){var fileConfig;return _ts_generator(this,function(_state){switch(_state.label){case 0:return _state.trys.push([0,3,,4]),[4,fetch(filePath)];case 1:return[4,_state.sent().json()];case 2:return fileConfig=_state.sent(),_this.config=_extends({},_this.config,fileConfig),[3,4];case 3:return console.error("Error loading config from "+filePath+": "+_state.sent().message),[3,4];case 4:return[2]}})})()},_proto.save=function(filePath){var _this=this;return _async_to_generator(function(){var configString,blob,link;return _ts_generator(this,function(_state){try{configString=JSON.stringify(_this.config,null,2),blob=new Blob([configString],{type:"application/json"}),(link=document.createElement("a")).href=URL.createObjectURL(blob),link.download=filePath,document.body.appendChild(link),link.click(),document.body.removeChild(link)}catch(error){console.error("Error saving config to "+filePath+": ",error.message)}return[2]})})()},Configuration.getConfigData=function(path){return _async_to_generator(function(){var configuration;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,(configuration=new Configuration).load(path)];case 1:return _state.sent(),[2,configuration.get()]}})})()},Configuration}(),ClientEngine=function(){function ClientEngine(_engine,_playerCache){this._engine=_engine,this._playerCache=_playerCache,this._clientId=""}var _proto=ClientEngine.prototype;return _proto.addPlayer=function(socketId,role){return this._playerCache.addPlayer(socketId,role)},_proto.getPlayerId=function(clientId){return this._playerCache.getPlayerId(clientId)},_proto.updatePlayer=function(gameFrameDTO){this._playerCache.updatePlayer(gameFrameDTO)},_proto.loadGameLoop=function(){this._engine.gameLoop.load(this.clientId)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ClientEngine.prototype,[{key:"clientId",get:function(){return this._clientId},set:function(id){this._clientId=id}},{key:"engine",get:function(){return this._engine}}]),ClientEngine}(),ClientEngineBuilder=function(){function ClientEngineBuilder(_engine){this._engine=_engine}var _proto=ClientEngineBuilder.prototype;return _proto.withGameClientApi=function(clientApi){return this._gameClientApi=clientApi,this},_proto.withClientGameLoop=function(){var gameLoop=this._engine.gameLoop;return gameLoop.clientApi=this._gameClientApi,gameLoop.entityCache=this._engine.entityCache,this},_proto.withPlayerManager=function(playerCache){return this._playerCache=playerCache,this._playerCache.entityCache=this._engine.entityCache,this},_proto.build=function(){return new ClientEngine(this._engine,this._playerCache)},ClientEngineBuilder}();(LogLevel=LogLevel1||(LogLevel1={}))[LogLevel.OFF=0]="OFF",LogLevel[LogLevel.INFO=1]="INFO",LogLevel[LogLevel.WARNING=2]="WARNING",LogLevel[LogLevel.ERROR=3]="ERROR",LogLevel[LogLevel.DEBUG=4]="DEBUG";var Logger=function(){function Logger(logLevel){void 0===logLevel&&(logLevel=LogLevel1.INFO),this._logLevel=logLevel}var _proto=Logger.prototype;return _proto.setLogLevel=function(logLevel){this._logLevel=logLevel},_proto.shouldLog=function(level){return this._logLevel>LogLevel1.OFF&&level>=this._logLevel},_proto.log=function(message){this.shouldLog(LogLevel1.INFO)&&console.log("[Game Log] "+message)},_proto.debug=function(message){this.shouldLog(LogLevel1.DEBUG)&&console.debug("[Game Debug] "+message)},_proto.warn=function(message){this.shouldLog(LogLevel1.WARNING)&&console.warn("[Game Warning] "+message)},_proto.error=function(message){this.shouldLog(LogLevel1.ERROR)&&console.error("[Game Error] "+message)},Logger.toLogLevel=function(level){switch(level){case"off":return LogLevel1.OFF;case"info":default:return LogLevel1.INFO;case"warning":return LogLevel1.WARNING;case"error":return LogLevel1.ERROR;case"debug":return LogLevel1.DEBUG}},Logger}(),LoggerSingleton=function(){function LoggerSingleton(){}return LoggerSingleton.getLogger=function(){return LoggerSingleton.loggerInstance||(LoggerSingleton.loggerInstance=new Logger),LoggerSingleton.loggerInstance},LoggerSingleton.setLogger=function(logger){LoggerSingleton.loggerInstance=logger},LoggerSingleton}();function ResourceCache_set_prototype_of(o,p){return(ResourceCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}LoggerSingleton.loggerInstance=null;var ResourceCache=function(ResourceCacheLogger){function ResourceCache(){var _this;return _this=ResourceCacheLogger.apply(this,arguments)||this,_this._list=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ResourceCache_set_prototype_of(subClass,superClass)}(ResourceCache,ResourceCacheLogger);var protoProps,_proto=ResourceCache.prototype;return _proto.add=function(name,object){this._list.has(name)?this.logError(this.getAlreadyExistsMessage(name)):this._list.set(name,object)},_proto.remove=function(name){this._list.delete(name)},_proto.removeAll=function(){this._list=new Map},_proto.get=function(name){var object=this._list.get(name);return void 0===object&&this.logWarn(this.getNotFoundMessage(name)),object},_proto.getStrict=function(name){var _this__list_get,_this=this;return null!=(_this__list_get=this._list.get(name))?_this__list_get:function(){var message=_this.getNotFoundMessage(name);throw _this.logError(message),Error(message)}()},_proto.getWithStatus=function(name){var object=this._list.get(name);return void 0===object&&this.logError(this.getNotFoundMessage(name)),{found:!!object,object:object}},_proto.forEach=function(callback){this._list.forEach(function(object,name){callback(name,object)})},_proto.getRegistered=function(entityIds){var _this=this,registeredEntities=[];return entityIds.forEach(function(entityId){var entity=_this._list.get(entityId);entity&&registeredEntities.push(entity)}),registeredEntities},_proto.getKeys=function(){return Array.from(this._list.keys())},_proto.values=function(){return this._list.values()},protoProps=[{key:"count",get:function(){return this._list.size}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ResourceCache.prototype,protoProps),ResourceCache}(function(){function ResourceCacheLogger(){this._logger=LoggerSingleton.getLogger()}var _proto=ResourceCacheLogger.prototype;return _proto.getAlreadyExistsMessage=function(name){return"Object with name '"+name+"' already exists!"},_proto.getNotFoundMessage=function(name){return"Object with name '"+name+"' not found!"},_proto.logError=function(message){this._logger.error(message)},_proto.logWarn=function(message){this._logger.warn(message)},_proto.logDebug=function(message){this._logger.debug(message)},ResourceCacheLogger}());function EntityCache_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function EntityCache_set_prototype_of(o,p){return(EntityCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function EntityCache_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return EntityCache_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EntityCache_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var EntityCache_EntityCache=function(ResourceCache){function EntityCache(){return ResourceCache.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&EntityCache_set_prototype_of(subClass,superClass)}(EntityCache,ResourceCache);var _proto=EntityCache.prototype;return _proto.update=function(dt){for(var _step,_iterator=EntityCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.update(dt)},_proto.render=function(dt){for(var _step,_iterator=EntityCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.render(dt)},EntityCache}(ResourceCache),Vector2=function(){function Vector2(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=x,this.y=y}var _proto=Vector2.prototype;return _proto.add=function(other){return new Vector2(this.x+other.x,this.y+other.y)},_proto.subtract=function(other){return new Vector2(this.x-other.x,this.y-other.y)},_proto.multiply=function(scalar){return new Vector2(this.x*scalar,this.y*scalar)},_proto.divide=function(scalar){return 0===scalar?new Vector2(this.x,this.y):new Vector2(this.x/scalar,this.y/scalar)},_proto.clone=function(){return new Vector2(this.x,this.y)},_proto.dot=function(other){return this.x*other.x+this.y*other.y},_proto.length=function(){return Math.hypot(this.x,this.y)},_proto.squaredLength=function(){return this.x*this.x+this.y*this.y},_proto.normalize=function(){var length=this.length();return 0===length?new Vector2(0,0):new Vector2(this.x/length,this.y/length)},_proto.equals=function(v){return this.x===v.x&&this.y===v.y},_proto.clampLength=function(min,max){var currentLength=this.length();if(currentLength<min){var ratio=min/currentLength;this.x*=ratio,this.y*=ratio}else if(currentLength>max){var ratio1=max/currentLength;this.x*=ratio1,this.y*=ratio1}return this},_proto.mutateAdd=function(other){return this.x+=other.x,this.y+=other.y,this},_proto.mutateSubtract=function(other){return this.x-=other.x,this.y-=other.y,this},_proto.mutateMultiply=function(scalar){return this.x*=scalar,this.y*=scalar,this},_proto.mutateDivide=function(scalar){return 0===scalar||(this.x/=scalar,this.y/=scalar),this},_proto.mutateNormalize=function(){var length=this.length();return 0===length?(this.x=0,this.y=0):(this.x/=length,this.y/=length),this},_proto.mutateSetTo=function(x,y){return this.x=x,this.y=y,this},_proto.mutateSetFrom=function(v){return this.x=v.x,this.y=v.y,this},_proto.min=function(){return Math.min(this.x,this.y)},Vector2.add=function(vector1,vector2){return new Vector2(vector1.x+vector2.x,vector1.y+vector2.y)},Vector2.subtract=function(v1,v2){return new Vector2(v1.x-v2.x,v1.y-v2.y)},Vector2.multiply=function(v,scalar){return new Vector2(v.x*scalar,v.y*scalar)},Vector2.divide=function(v,scalar){return 0===scalar?new Vector2(v.x,v.y):new Vector2(v.x/scalar,v.y/scalar)},Vector2.vlength=function(v){return Math.hypot(v.x,v.y)},Vector2.normalize=function(v){var length=Vector2.vlength(v);return 0===length?new Vector2(0,0):new Vector2(v.x/length,v.y/length)},Vector2.equals=function(v1,v2){return v1.x===v2.x&&v1.y===v2.y},Vector2.fromXY=function(x,y){return new Vector2(x,y)},Vector2.fromVector=function(vector){return new Vector2(vector.x,vector.y)},Vector2}();function Transform_extends(){return(Transform_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function Transform_set_prototype_of(o,p){return(Transform_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}Vector2.zero=new Vector2(0,0),Vector2.one=new Vector2(1,1),Vector2.unitX=new Vector2(1,0),Vector2.unitY=new Vector2(0,1);var Transform_Transform=function(Component){function Transform(){var _this;return _this=Component.apply(this,arguments)||this,_this._position=new Vector2,_this._rotation=0,_this._scale=new Vector2(1,1),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Transform_set_prototype_of(subClass,superClass)}(Transform,Component);var protoProps,_proto=Transform.prototype;return _proto.toJSON=function(){return Transform_extends({},Component.prototype.toJSON.call(this),{position:this.position,scale:this.scale,rotation:this.rotation})},_proto.scalePosition=function(initialPosition,canvasScale){this.position.x=initialPosition.x*canvasScale.x,this.position.y=initialPosition.y*canvasScale.y},protoProps=[{key:"position",get:function(){return this._position},set:function(position){this._position=position}},{key:"scale",get:function(){return this._scale},set:function(scale){this._scale=scale}},{key:"rotation",get:function(){return this._rotation},set:function(rotation){this._rotation=rotation}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Transform.prototype,protoProps),Transform}(Component);function MultiplayerPlayerCache_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function MultiplayerPlayerCache_set_prototype_of(o,p){return(MultiplayerPlayerCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function MultiplayerPlayerCache_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return MultiplayerPlayerCache_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MultiplayerPlayerCache_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var MultiplayerPlayerCache=function(EntityCache){function MultiplayerPlayerCache(){return EntityCache.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&MultiplayerPlayerCache_set_prototype_of(subClass,superClass)}(MultiplayerPlayerCache,EntityCache);var protoProps,_proto=MultiplayerPlayerCache.prototype;return _proto.getPlayerId=function(clientId){for(var _step,_iterator=MultiplayerPlayerCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;){var player=_step.value;if(player.clientId===clientId)return player.id}return console.warn("getPlayerId failed"),""},_proto.addPlayer=function(socketId,role){for(var _step,_iterator=MultiplayerPlayerCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)if(_step.value.clientId===socketId)return{isDone:!1,message:"Player already on the list",role:""};var count=this.count;if(count>=2)return{isDone:!1,message:"Number of players is "+count+". Server and clients at capacity",role:""};var playerKey="player"+(count+1),player1=this._entityManager.getStrict(playerKey);return player1.clientId=socketId,player1.role=role,this.add(playerKey,player1),{isDone:!0,message:"Client Engine added player on key: "+playerKey+", id: "+socketId+" with role "+role,role:role}},_proto.updatePlayer=function(gameFrameDto){var _this=this;gameFrameDto.players.forEach(function(playerDto){for(var _step,_iterator=MultiplayerPlayerCache_create_for_of_iterator_helper_loose(_this.values());!(_step=_iterator()).done;){var player=_step.value,transform=player.getComponentStrict(Transform_Transform);playerDto.id===player.id&&transform.position.mutateSetFrom(playerDto.position)}})},protoProps=[{key:"entityCache",set:function(entityManager){this._entityManager=entityManager}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(MultiplayerPlayerCache.prototype,protoProps),MultiplayerPlayerCache}(EntityCache_EntityCache),ClientEngineDirector=function(){function ClientEngineDirector(){}return ClientEngineDirector.prototype.createEngine=function(engine,client){return new ClientEngineBuilder(engine).withGameClientApi(client).withClientGameLoop().withPlayerManager(new MultiplayerPlayerCache).build()},ClientEngineDirector}();function ClientGameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function ClientGameBuilder_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){ClientGameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){ClientGameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function ClientGameBuilder_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var ClientGameBuilder=function(){function ClientGameBuilder(_gameClient,_gameBuilder){this._gameClient=_gameClient,this._gameBuilder=_gameBuilder}var _proto=ClientGameBuilder.prototype;return _proto.build=function(configName,componentMapper){var _this=this;return ClientGameBuilder_async_to_generator(function(){var engine,client,clientEngine;return ClientGameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.getEngine(configName,componentMapper)];case 1:return engine=_state.sent(),client=_this._gameClient,clientEngine=_this.getClientEngine(engine,client),client.loadEngine(clientEngine),client.start("http://localhost:3001/"),[2]}})})()},_proto.getEngine=function(configName,componentMapper){var _this=this;return ClientGameBuilder_async_to_generator(function(){return ClientGameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this._gameBuilder.build(configName,componentMapper)];case 1:return _state.sent(),[2,_this._gameBuilder.getEngine()]}})})()},_proto.getClientEngine=function(engine,client){return new ClientEngineDirector().createEngine(engine,client)},ClientGameBuilder}();function Dribble_set_prototype_of(o,p){return(Dribble_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Dribble=function(Component){var protoProps;function Dribble(){var _this;return _this=Component.apply(this,arguments)||this,_this._enable=!1,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Dribble_set_prototype_of(subClass,superClass)}(Dribble,Component),Dribble.prototype.toJSON=function(){return{id:this.id,enable:this.enable}},protoProps=[{key:"enable",get:function(){return this._enable},set:function(enable){this._enable=enable}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Dribble.prototype,protoProps),Dribble}(Component);function PlayerState_set_prototype_of(o,p){return(PlayerState_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var PlayerState=function(Component){var protoProps;function PlayerState(){var _this;return _this=Component.apply(this,arguments)||this,_this._enableRender=!1,_this._playerId="",_this._position=new Vector2,_this._font="",_this._color="",_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&PlayerState_set_prototype_of(subClass,superClass)}(PlayerState,Component),PlayerState.prototype.toJSON=function(){return{id:this.id,enableRender:this.enableRender,playerId:this._playerId,position:this._position,font:this._font,color:this._color}},protoProps=[{key:"enableRender",get:function(){return this._enableRender},set:function(value){this._enableRender=value}},{key:"playerId",get:function(){return this._playerId},set:function(playerId){this._playerId=playerId}},{key:"position",get:function(){return this._position},set:function(position){this._position=position}},{key:"font",get:function(){return this._font},set:function(font){this._font=font}},{key:"color",get:function(){return this._color},set:function(color){this._color=color}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(PlayerState.prototype,protoProps),PlayerState}(Component);function FacingDirection_set_prototype_of(o,p){return(FacingDirection_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var FacingDirection=function(Component){var protoProps;function FacingDirection(){var _this;return _this=Component.apply(this,arguments)||this,_this._left=!1,_this._right=!1,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&FacingDirection_set_prototype_of(subClass,superClass)}(FacingDirection,Component),FacingDirection.prototype.toJSON=function(){return{id:this.id,left:this.left,right:this.right}},protoProps=[{key:"left",get:function(){return this._left},set:function(left){this._left=left}},{key:"right",get:function(){return this._right},set:function(right){this._right=right}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(FacingDirection.prototype,protoProps),FacingDirection}(Component),PhysicMaterial=function(dynamicFriction,staticFriction,bounciness){void 0===dynamicFriction&&(dynamicFriction=.8),void 0===staticFriction&&(staticFriction=.2),void 0===bounciness&&(bounciness=.8),this.dynamicFriction=dynamicFriction,this.staticFriction=staticFriction,this.bounciness=bounciness};function Collider_set_prototype_of(o,p){return(Collider_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Collider=function(Component){var protoProps;function Collider(){var _this;return _this=Component.apply(this,arguments)||this,_this._center=new Vector2,_this._isTrigger=!1,_this._material=new PhysicMaterial,_this._color="red",_this._enableRender=!1,_this._origin={isTopLeft:!0,isCenter:!1},_this._style={isFill:!1,isStroke:!0,lineWidth:2,strokeColor:"red"},_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Collider_set_prototype_of(subClass,superClass)}(Collider,Component),Collider.prototype.toJSON=function(){return{center:this.center,isTrigger:this.isTrigger,material:this.material,color:this.color,enableRender:this.enableRender,origin:this.origin,style:this.style}},protoProps=[{key:"center",get:function(){return this._center},set:function(center){this._center=center}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(isTrigger){this._isTrigger=isTrigger}},{key:"material",get:function(){return this._material},set:function(material){this._material=material}},{key:"color",get:function(){return this._color},set:function(color){this._color=color}},{key:"enableRender",get:function(){return this._enableRender},set:function(enableRender){this._enableRender=enableRender}},{key:"origin",get:function(){return this._origin},set:function(origin){this._origin=origin}},{key:"style",get:function(){return this._style},set:function(style){this._style=style}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Collider.prototype,protoProps),Collider}(Component);function BoxCollider_extends(){return(BoxCollider_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function BoxCollider_set_prototype_of(o,p){return(BoxCollider_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BoxCollider_BoxCollider=function(Collider){function BoxCollider(){var _this;return _this=Collider.apply(this,arguments)||this,_this._size=new Vector2,_this._halfSize=new Vector2,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BoxCollider_set_prototype_of(subClass,superClass)}(BoxCollider,Collider);var protoProps,_proto=BoxCollider.prototype;return _proto.toJSON=function(){return BoxCollider_extends({id:this.id,size:this.size},Collider.prototype.toJSON.call(this))},_proto.scaleSize=function(initialSize,canvasScale){this.size.x=initialSize.x*canvasScale.x,this.size.y=initialSize.y*canvasScale.y},protoProps=[{key:"size",get:function(){return this._size},set:function(size){this._size=size,this._halfSize.x=this._size.x/2,this._halfSize.y=this._size.y/2}},{key:"halfSize",get:function(){return this._halfSize}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(BoxCollider.prototype,protoProps),BoxCollider}(Collider);function CircleCollider_extends(){return(CircleCollider_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function CircleCollider_set_prototype_of(o,p){return(CircleCollider_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var CircleCollider=function(Collider){var protoProps;function CircleCollider(){var _this;return _this=Collider.apply(this,arguments)||this,_this._radius=100,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CircleCollider_set_prototype_of(subClass,superClass)}(CircleCollider,Collider),CircleCollider.prototype.toJSON=function(){return CircleCollider_extends({id:this.id,radius:this.radius},Collider.prototype.toJSON.call(this))},protoProps=[{key:"radius",get:function(){return this._radius},set:function(radius){this._radius=radius}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(CircleCollider.prototype,protoProps),CircleCollider}(Collider);function CollisionObject_set_prototype_of(o,p){return(CollisionObject_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var CollisionObject=function(Component){var protoProps;function CollisionObject(){return Component.apply(this,arguments)}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CollisionObject_set_prototype_of(subClass,superClass)}(CollisionObject,Component),CollisionObject.prototype.toJSON=function(){return{id:this.id,objectIdToCollideWith:this.objectIdToCollideWith}},protoProps=[{key:"objectIdToCollideWith",get:function(){return this._objectIdToCollideWith},set:function(objectId){this._objectIdToCollideWith=objectId}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(CollisionObject.prototype,protoProps),CollisionObject}(Component);function LimitMove_extends(){return(LimitMove_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function LimitMove_set_prototype_of(o,p){return(LimitMove_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var LimitMove=function(Collider){var protoProps;function LimitMove(){var _this;return _this=Collider.apply(this,arguments)||this,_this._limitSize=new Vector2,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&LimitMove_set_prototype_of(subClass,superClass)}(LimitMove,Collider),LimitMove.prototype.toJSON=function(){return LimitMove_extends({id:this.id,limitSize:this.limitSize},Collider.prototype.toJSON.call(this))},protoProps=[{key:"limitSize",get:function(){return this._limitSize},set:function(limitSize){this._limitSize=limitSize}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(LimitMove.prototype,protoProps),LimitMove}(Collider);function RigidBody_extends(){return(RigidBody_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function RigidBody_set_prototype_of(o,p){return(RigidBody_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var RigidBody_RigidBody=function(Component){var protoProps;function RigidBody(){var _this;return _this=Component.apply(this,arguments)||this,_this._velocity=new Vector2,_this._mass=1,_this._cor=.9,_this._speedMultiplier=10,_this._maxSpeed=100,_this._moveStep=10,_this._useArrowKeys=!0,_this._stopThreshold=5,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&RigidBody_set_prototype_of(subClass,superClass)}(RigidBody,Component),RigidBody.prototype.toJSON=function(){return RigidBody_extends({id:this.id,velocity:this.velocity,mass:this.mass,cor:this.cor,speedMultiplier:this.speedMultiplier,maxSpeed:this.maxSpeed,moveStep:this.moveStep,useArrowKeys:this.useArrowKeys,stopThreshold:this.stopThreshold},Component.prototype.toJSON.call(this))},protoProps=[{key:"velocity",get:function(){return this._velocity},set:function(velocity){this._velocity=velocity}},{key:"mass",get:function(){return this._mass},set:function(mass){this._mass=mass}},{key:"cor",get:function(){return this._cor},set:function(cor){this._cor=cor}},{key:"speedMultiplier",get:function(){return this._speedMultiplier},set:function(value){this._speedMultiplier=value}},{key:"maxSpeed",get:function(){return this._maxSpeed},set:function(value){this._maxSpeed=value}},{key:"moveStep",get:function(){return this._moveStep},set:function(value){this._moveStep=value}},{key:"useArrowKeys",get:function(){return this._useArrowKeys},set:function(value){this._useArrowKeys=value}},{key:"stopThreshold",get:function(){return this._stopThreshold},set:function(stopThreshold){this._stopThreshold=stopThreshold}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(RigidBody.prototype,protoProps),RigidBody}(Component);function Sprite_extends(){return(Sprite_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function Sprite_set_prototype_of(o,p){return(Sprite_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Sprite=function(Component){var protoProps;function Sprite(){var _this;return _this=Component.apply(this,arguments)||this,_this._spriteOffset=new Vector2,_this._isFlipped=!1,_this._spriteAnimation=[],_this._state={},_this._flags={},_this._values={},_this._numbers={},_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Sprite_set_prototype_of(subClass,superClass)}(Sprite,Component),Sprite.prototype.toJSON=function(){return{id:this.id,spriteOffset:this.spriteOffset,isFlipped:this.isFlipped,spriteAnimation:this.spriteAnimation,state:"idle"}},protoProps=[{key:"spriteOffset",get:function(){return this._spriteOffset},set:function(spriteOffset){this._spriteOffset=spriteOffset}},{key:"isFlipped",get:function(){return this._isFlipped},set:function(isFlipped){this._isFlipped=isFlipped}},{key:"spriteAnimation",get:function(){return this._spriteAnimation},set:function(spriteAnimation){this._spriteAnimation=spriteAnimation}},{key:"state",get:function(){return this._state},set:function(state){this._state=state}},{key:"flags",get:function(){return this._flags},set:function(flags){this._flags=Sprite_extends({},this._flags,flags)}},{key:"values",get:function(){return this._values},set:function(values){this._values=Sprite_extends({},this._values,values)}},{key:"numbers",get:function(){return this._numbers},set:function(numbers){this._numbers=Sprite_extends({},this._numbers,numbers)}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Sprite.prototype,protoProps),Sprite}(Component);function GameState_set_prototype_of(o,p){return(GameState_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var GameState_GameState=function(Component){var protoProps;function GameState(){var _this;return _this=Component.apply(this,arguments)||this,_this._lastCollision={},_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&GameState_set_prototype_of(subClass,superClass)}(GameState,Component),protoProps=[{key:"lastCollisionInfo",get:function(){return this._lastCollision},set:function(lastCollision){this._lastCollision=lastCollision}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(GameState.prototype,protoProps),GameState}(Component);function Direction_set_prototype_of(o,p){return(Direction_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Direction_Direction=function(Component){var protoProps;function Direction(){var _this;return _this=Component.apply(this,arguments)||this,_this._direction=new Vector2(1,0),_this._directionPoint=new Vector2,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Direction_set_prototype_of(subClass,superClass)}(Direction,Component),Direction.prototype.toJSON=function(){return{id:this.id,direction:this.direction,directionPoint:this.directionPoint}},protoProps=[{key:"direction",get:function(){return this._direction},set:function(v){this._direction.x=v.x,this._direction.y=v.y,this._direction.normalize()}},{key:"directionPoint",get:function(){return this._directionPoint},set:function(v){this._directionPoint.x=v.x,this._directionPoint.y=v.y}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Direction.prototype,protoProps),Direction}(Component);function Kick_set_prototype_of(o,p){return(Kick_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Kick=function(Component){var protoProps;function Kick(){var _this;return _this=Component.apply(this,arguments)||this,_this._enableKick=!1,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Kick_set_prototype_of(subClass,superClass)}(Kick,Component),Kick.prototype.toJSON=function(){return{id:this.id,enableKick:this.enableKick}},protoProps=[{key:"enableKick",get:function(){return this._enableKick},set:function(enableKick){this._enableKick=enableKick}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Kick.prototype,protoProps),Kick}(Component);function KeyMap_set_prototype_of(o,p){return(KeyMap_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var KeyMap=function(Component){var protoProps;function KeyMap(){var _this;return _this=Component.apply(this,arguments)||this,_this._actions=[],_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&KeyMap_set_prototype_of(subClass,superClass)}(KeyMap,Component),KeyMap.prototype.toJSON=function(){return{actions:this.actions.map(function(action){return{action:action.action,key:action.key}})}},protoProps=[{key:"actions",get:function(){return this._actions},set:function(actions){this._actions=actions}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(KeyMap.prototype,protoProps),KeyMap}(Component);function MarkerPoints_set_prototype_of(o,p){return(MarkerPoints_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MarkerPoints=function(Component){var protoProps;function MarkerPoints(){var _this;return _this=Component.apply(this,arguments)||this,_this._markers=new Map,_this._enableRender=!1,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&MarkerPoints_set_prototype_of(subClass,superClass)}(MarkerPoints,Component),MarkerPoints.prototype.toJSON=function(){return{id:this.id,markers:this.markers,on:this.enableRender}},protoProps=[{key:"markers",get:function(){return this._markers},set:function(markers){this._markers=markers}},{key:"enableRender",get:function(){return this._enableRender},set:function(value){this._enableRender=value}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(MarkerPoints.prototype,protoProps),MarkerPoints}(Component);function Score_set_prototype_of(o,p){return(Score_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Score=function(Component){var protoProps;function Score(){var _this;return _this=Component.apply(this,arguments)||this,_this._position=new Vector2,_this._score={redScore:0,blueScore:0},_this._redTeam={},_this._blueTeam={},_this._delimiter={},_this._font="",_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Score_set_prototype_of(subClass,superClass)}(Score,Component),Score.prototype.toJSON=function(){return{id:this.id,position:this.position,score:this.score,redTeam:this._redTeam,blueTeam:this._blueTeam,delimiter:this._delimiter,font:this._font}},protoProps=[{key:"position",get:function(){return this._position},set:function(position){this._position=position}},{key:"score",get:function(){return this._score},set:function(score){this._score=score}},{key:"delimiter",get:function(){return this._delimiter},set:function(delimiter){this._delimiter=delimiter}},{key:"redTeam",get:function(){return this._redTeam},set:function(redTeam){this._redTeam=redTeam}},{key:"blueTeam",get:function(){return this._blueTeam},set:function(blueTeam){this._blueTeam=blueTeam}},{key:"font",get:function(){return this._font},set:function(font){this._font=font}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Score.prototype,protoProps),Score}(Component);function MapperTool_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var MapperTool=function(){function MapperTool(){}var _proto=MapperTool.prototype;return _proto.mapType=function(data,type,mapper){return Array.isArray(data)?this.mapArray(data,type,mapper):this.mapSingle(data,type,mapper)},_proto.mapArray=function(data,type,mapper){for(var _step,cArray=[],_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return MapperTool_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MapperTool_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(data);!(_step=_iterator()).done;){var d=_step.value,c=new type;mapper(c,d),cArray.push(c)}return cArray},_proto.mapSingle=function(data,type,mapper){var c=new type;return mapper(c,data),c},MapperTool}();function DebugUI_set_prototype_of(o,p){return(DebugUI_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var DebugUI=function(Component){var protoProps;function DebugUI(){var _this;return _this=Component.apply(this,arguments)||this,_this._isOn=!1,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&DebugUI_set_prototype_of(subClass,superClass)}(DebugUI,Component),DebugUI.prototype.toJSON=function(){return{id:this.id,isOn:this.isOn}},protoProps=[{key:"isOn",get:function(){return this._isOn},set:function(value){this._isOn=value}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(DebugUI.prototype,protoProps),DebugUI}(Component);function InsideBoxCollider_set_prototype_of(o,p){return(InsideBoxCollider_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var InsideBoxCollider=function(BoxCollider){function InsideBoxCollider(){return BoxCollider.apply(this,arguments)}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&InsideBoxCollider_set_prototype_of(subClass,superClass)}(InsideBoxCollider,BoxCollider),InsideBoxCollider}(BoxCollider_BoxCollider);function CanvasScale_set_prototype_of(o,p){return(CanvasScale_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var CanvasScale=function(Component){var protoProps;function CanvasScale(){var _this;return _this=Component.apply(this,arguments)||this,_this._scaleFactor=new Vector2(1,1),_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CanvasScale_set_prototype_of(subClass,superClass)}(CanvasScale,Component),CanvasScale.prototype.toJSON=function(){return{id:this.id,scaleFactor:this._scaleFactor}},protoProps=[{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(scaleFactor){this._scaleFactor=scaleFactor}},{key:"uniformScale",get:function(){return this._scaleFactor.min()}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(CanvasScale.prototype,protoProps),CanvasScale}(Component),ComponentMapper=function(){function ComponentMapper(){this._mapper=new MapperTool,this.mappers={debugUI:this.mapDebugUI.bind(this),transform:this.mapTransform.bind(this),boxCollider:this.mapBoxColliders.bind(this),circleCollider:this.mapCircleCollider.bind(this),insideBoxCollider:this.mapInsideBoxCollider.bind(this),collisionObject:this.mapCollisionObject.bind(this),limitMove:this.mapLimitMove.bind(this),rigidBody:this.mapRigidBody.bind(this),sprite:this.mapSprite.bind(this),gameState:this.mapGameState.bind(this),direction:this.mapDirection.bind(this),kick:this.mapKick.bind(this),keyMap:this.mapKeyMap.bind(this),markerPoints:this.mapMarkerPoints.bind(this),score:this.mapScore.bind(this),canvasScale:this.mapCanvasScale.bind(this)}}var _proto=ComponentMapper.prototype;return _proto.mapCanvasScale=function(data){var c=new CanvasScale;return c.scaleFactor=Vector2.fromVector(data.scaleFactor),c},_proto.mapDebugUI=function(data){var c=new DebugUI;return c.isOn=data.isOn,c},_proto.mapTransform=function(data){var c=new Transform_Transform;return c.position=Vector2.fromVector(data.position),c.rotation=data.rotation,c.scale=data.scale,c},_proto.mapBoxColliders=function(data){return this._mapper.mapType(data,BoxCollider_BoxCollider,this.mapBoxCollider.bind(this))},_proto.mapCollider=function(component,data){component.id=data.id,component.center=Vector2.fromVector(data.center),component.color=data.color,component.enableRender=data.enableRender,component.isTrigger=data.isTrigger,component.material=data.material,component.origin=data.origin,component.style=data.style},_proto.mapBoxCollider=function(component,data){return this.mapCollider(component,data),component.size=Vector2.fromVector(data.size),component},_proto.mapCircleCollider=function(data){var c=new CircleCollider;return this.mapCollider(c,data),c.radius=data.radius,c},_proto.mapInsideBoxCollider=function(data){var c=new InsideBoxCollider;return this.mapCollider(c,data),c.size=Vector2.fromVector(data.size),c},_proto.mapCollisionObject=function(data){var c=new CollisionObject;return c.objectIdToCollideWith=data.objectIdToCollideWith,c},_proto.mapLimitMove=function(data){var c=new LimitMove;return this.mapCollider(c,data),c.limitSize=data.limitSize,c},_proto.mapRigidBody=function(data){var c=new RigidBody_RigidBody;return c.velocity=Vector2.fromVector(data.velocity),c.mass=data.mass,c.cor=data.cor,c.speedMultiplier=data.speedMultiplier,c.maxSpeed=data.maxSpeed,c.moveStep=data.moveStep,c.useArrowKeys=data.useArrowKeys,c.stopThreshold=data.stopThreshold,c},_proto.mapSprite=function(data){var _d_flags,_d_values,_d_numbers,c=new Sprite;return c.spriteOffset=data.spriteOffset,c.isFlipped=data.isFlipped,c.spriteAnimation=data.spriteAnimation,c.state=data.state,c.flags=null!=(_d_flags=data.flags)?_d_flags:{},c.values=null!=(_d_values=data.values)?_d_values:{},c.numbers=null!=(_d_numbers=data.numbers)?_d_numbers:{},c},_proto.mapGameState=function(_data){return new GameState_GameState},_proto.mapDirection=function(data){var c=new Direction_Direction;return c.direction=Vector2.fromVector(data.direction),c.directionPoint=Vector2.fromVector(data.directionPoint),c},_proto.mapKick=function(data){var c=new Kick;return c.enableKick=data.enableKick,c},_proto.mapKeyMap=function(data){var c=new KeyMap;return c.actions=[].concat(data.actions),c},_proto.mapMarkerPoints=function(data){var c=new MarkerPoints;return c.markers=this.jsonToMap(data),c.enableRender=data.enableRender,c},_proto.jsonToMap=function(json){var map=new Map;for(var key in json.markers)Object.prototype.hasOwnProperty.call(json.markers,key)&&map.set(key,json.markers[key]);return map},_proto.mapScore=function(data){var c=new Score;return c.position=data.position,c.score=data.score,c.redTeam=data.redTeam,c.blueTeam=data.blueTeam,c.delimiter=data.delimiter,c.font=data.font,c},ComponentMapper}(),ComponentMapperFactory=function(){function ComponentMapperFactory(){this._mapper=new MapperTool}var _proto=ComponentMapperFactory.prototype;return _proto.createComponentMapper=function(){var mapper=new ComponentMapper;return this.addNewComponentToList(),this.addNewComponentMapper(mapper),mapper},_proto.addNewComponentToList=function(){componentList_componentList.dribble="dribble",componentList_componentList.playerState="playerState",componentList_componentList.facingDirection="facingDirection"},_proto.addNewComponentMapper=function(mapper){mapper.mappers.dribble=this.mapDribble.bind(this),mapper.mappers.playerState=this.mapPlayerStates.bind(this),mapper.mappers.facingDirection=this.mapFacingDirection.bind(this)},_proto.mapDribble=function(data){var c=new Dribble;return c.id=data.id,c.enable=data.enable,c},_proto.mapPlayerStates=function(data){return this._mapper.mapType(data,PlayerState,this.mapPlayerState.bind(this))},_proto.mapPlayerState=function(component,data){return component.id=data.id,component.enableRender=data.enableRender,component.playerId=data.playerId,component.position=Vector2.fromVector(data.position),component.font=data.font,component.color=data.color,component},_proto.mapFacingDirection=function(data){var c=new FacingDirection;return c.id=data.id,c.left=data.left,c.right=data.right,c},ComponentMapperFactory}();function JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var JsonLoader=function(){function JsonLoader(){}return JsonLoader.prototype.getData=function(filePath,defaultValue){var fn;return(fn=function(){var response;return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:return _state.trys.push([0,3,,4]),[4,fetch(filePath)];case 1:if(!(response=_state.sent()).ok)throw Error("HTTP error! status: "+response.status);return[4,response.json()];case 2:return[2,_state.sent()];case 3:return console.error("Error loading data:",_state.sent()),[2,defaultValue];case 4:return[2]}})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},JsonLoader}();function createSingleton(creator){var instance=null;return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return instance||(instance=creator.apply(void 0,[].concat(args))),instance}}var LoggerEmpty=function(){function LoggerEmpty(){}var _proto=LoggerEmpty.prototype;return _proto.setLogLevel=function(logLevel){},_proto.log=function(message){},_proto.debug=function(message){},_proto.warn=function(message){},_proto.error=function(message){},LoggerEmpty}(),ClientGameLoop=function(){function ClientGameLoop(){var _this=this;this.animationFrameId=null,this.lastFrameTime=0,this.updateCallbacks=[],this.renderCallbacks=[],this.paused=!1,this.loop=function(){if(!_this.paused){var currentTime=performance.now();_this.lastFrameTime||(_this.lastFrameTime=currentTime);var deltaTime=(currentTime-_this.lastFrameTime)/1e3;_this.updateCallbacks.forEach(function(callback){return callback(deltaTime)}),_this.renderCallbacks.forEach(function(callback){return callback(deltaTime)}),_this.sendFrame(),_this.lastFrameTime=currentTime,_this.animationFrameId=requestAnimationFrame(_this.loop)}}}var _proto=ClientGameLoop.prototype;return _proto.load=function(clientId){console.log("Load GameLoop clientId: ",clientId);var player1=this._entityCache.getStrict("player1"),player2=this._entityCache.getStrict("player2");if("player1"===player1.role&&(this._player=player1,console.log("Player1 was chosen as active")),"player1"===player2.role&&(this._player=player2,console.log("Player2 was chosen as active")),!this._player)throw Error("player was not assigned!");this._inputDto=this._player.getComponentStrict(ClientMovement_ClientMovement).inputDto,this._inputDto.id=this._player.id},_proto.start=function(){this.paused=!1,this.loop()},_proto.stop=function(){null!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)},_proto.pause=function(){this.paused=!0},_proto.resume=function(){this.paused=!1,this.loop()},_proto.sendFrame=function(){this._inputDto&&this._clientApi.sendInput(this._inputDto)},_proto.subscribeUpdate=function(callback){this.updateCallbacks.push(callback)},_proto.unsubscribeUpdate=function(callback){this.updateCallbacks=this.updateCallbacks.filter(function(cb){return cb!==callback})},_proto.subscribeRender=function(callback){this.renderCallbacks.push(callback)},_proto.unsubscribeRender=function(callback){this.renderCallbacks=this.renderCallbacks.filter(function(cb){return cb!==callback})},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ClientGameLoop.prototype,[{key:"entityCache",set:function(entityCache){this._entityCache=entityCache}},{key:"clientApi",set:function(clientApi){this._clientApi=clientApi}}]),ClientGameLoop}(),System=function(){function System(_entityCache){this._entityCache=_entityCache,this._entities=[]}var _proto=System.prototype;return _proto.registerEntityById=function(entity){this._entities.push(this._entityCache.getStrict(entity.id))},_proto.registerEntitiesById=function(entitys){var _this=this;this._entities=entitys.map(function(entity){return _this._entityCache.getStrict(entity.id)})},_proto.start=function(){var _this=this;this._entities.forEach(function(entity){_this.startEntity(entity)})},_proto.startEntity=function(_entity){},_proto.update=function(deltaTime){var _this=this;this._entities.forEach(function(entity){_this.updateEntity(entity,deltaTime)})},_proto.updateEntity=function(_entity,_deltaTime){},_proto.render=function(_deltaTime){var _this=this;this._entities.forEach(function(entity){_this.renderEntity(entity,_deltaTime)})},_proto.renderEntity=function(_entity,_deltaTime){},System}(),BallHelper=function(){function BallHelper(){}return BallHelper.getBall=function(entityCache,entity){var colObj=entity.getComponentStrict(CollisionObject);return entityCache.getStrict(colObj.objectIdToCollideWith).getComponentStrict(Transform_Transform)},BallHelper}();function BallDribbleV1_set_prototype_of(o,p){return(BallDribbleV1_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BallDribbleV1=function(System){function BallDribbleV1(entityCache){var _this;return(_this=System.call(this,entityCache)||this)._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BallDribbleV1_set_prototype_of(subClass,superClass)}(BallDribbleV1,System);var _proto=BallDribbleV1.prototype;return _proto.startEntity=function(entity){this._ballTransform||(this._ballTransform=BallHelper.getBall(this._entityCache,entity)),this._cache.set(entity.id,{transform:entity.getComponentStrict(Transform_Transform),kick:entity.getComponentStrict(Kick),collider:entity.getComponentStrict(BoxCollider_BoxCollider,"kick")})},_proto.calculateSpringForce=function(playerTransform,playerCollider,ballTransform){return playerTransform.position.add(playerCollider.center).subtract(ballTransform.position).multiply(.1)},_proto.updateEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,kick=cache.kick,collider=cache.collider;if(kick.enableKick){var springForce=this.calculateSpringForce(transform,collider,this._ballTransform);this._ballTransform.position.mutateAdd(springForce)}}},BallDribbleV1}(System);function BallDribbleV2_set_prototype_of(o,p){return(BallDribbleV2_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BallDribbleV2=function(System){function BallDribbleV2(entityCache){var _this;return(_this=System.call(this,entityCache)||this)._cache=new Map,_this._canvasScale=_this.getCanvasScale(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BallDribbleV2_set_prototype_of(subClass,superClass)}(BallDribbleV2,System);var _proto=BallDribbleV2.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.startEntity=function(entity){this._ballTransform||(this._ballTransform=BallHelper.getBall(this._entityCache,entity)),this._cache.set(entity.id,{transform:entity.getComponentStrict(Transform_Transform),sprite:entity.getComponentStrict(Sprite),kick:entity.getComponentStrict(Kick),collider:entity.getComponentStrict(BoxCollider_BoxCollider,"kick")})},_proto.calculateSpringForce=function(playerTransform,sprite,playerCollider,ballTransform){var position=playerTransform.position,ballPosition=ballTransform.position,spriteSize=sprite.spriteAnimation[0].frameSize,scale=this._canvasScale.scaleFactor,boxCenter=new Vector2((position.x+spriteSize.x/2+playerCollider.center.x)*scale.x,(position.y+spriteSize.y/2+playerCollider.center.y)*scale.y),ballCenter=new Vector2((ballPosition.x+40)*scale.x,(ballPosition.y+20)*scale.y);return boxCenter.subtract(ballCenter).multiply(.1)},_proto.updateEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,sprite=cache.sprite,kick=cache.kick,collider=cache.collider;if(kick.enableKick){var springForce=this.calculateSpringForce(transform,sprite,collider,this._ballTransform);this._ballTransform.position.mutateAdd(springForce)}}},BallDribbleV2}(System);function getSystem(engine,sysData,handlers){var system=sysData.system,version=sysData.version,handler=handlers.get(version);if(handler)return handler(engine,sysData);var lastEntry=Array.from(handlers.values()).pop();if(!lastEntry)throw engine.logger.error("No version found for "+system+" and no default version available."),Error("No handler available for any version.");return engine.logger.warn("No version "+version+" found for "+system+". Falling back to the last added version."),lastEntry(engine,sysData)}function hasFeature(sysData,featureName){return void 0!==sysData.features&&!0===sysData.features[featureName]}function EngineConfig_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var EngineConfig=function(){function EngineConfig(){}return EngineConfig.getConfig=function(factory,path){var fn;return(fn=function(){var configuration,config;return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:return[4,(configuration=factory.getConfiguration()).load(path)];case 1:return _state.sent(),config=configuration.get(),[2,{configuration:configuration,config:config}]}})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){EngineConfig_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EngineConfig_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},EngineConfig.getClientFeatureBit=function(config,id){var _config_clientFeature_find,_config_clientFeature_find_isOn;return null!=(_config_clientFeature_find_isOn=null==(_config_clientFeature_find=config.clientFeature.find(function(c){return c.id===id}))?void 0:_config_clientFeature_find.isOn)&&_config_clientFeature_find_isOn},EngineConfig.getGameDependencyBit=function(config,id){var _config_gameDependency_find,_config_gameDependency_find_isOn;return null!=(_config_gameDependency_find_isOn=null==(_config_gameDependency_find=config.gameDependency.find(function(c){return c.id===id}))?void 0:_config_gameDependency_find.isOn)&&_config_gameDependency_find_isOn},EngineConfig.getEngineDependencyBit=function(config,id){var _config_engineDependency_find,_config_engineDependency_find_isOn;return null!=(_config_engineDependency_find_isOn=null==(_config_engineDependency_find=config.engineDependency.find(function(c){return c.id===id}))?void 0:_config_engineDependency_find.isOn)&&_config_engineDependency_find_isOn},EngineConfig.getSystemBit=function(config,id){var _config_system_find,_config_system_find_isOn;return null!=(_config_system_find_isOn=null==(_config_system_find=config.system.find(function(c){return c.id===id}))?void 0:_config_system_find.isOn)&&_config_system_find_isOn},EngineConfig}();function validationFunction_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function validationFunction_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return validationFunction_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return validationFunction_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function entityExists(entityName){return function(entities,logger){var result=!!entities[entityName];return null==logger||logger.debug("entityExists: "+entityName+": "+result),result}}function everyEntityExists(entityNames){return function(entities,logger){var result=entityNames.every(function(name){return!!entities[name]});return null==logger||logger.debug("everyEntityExists: "+entityNames+": "+result),result}}function isEngineDependencyOn(dependencyId){return function(_entities,logger,config){var result=EngineConfig.getEngineDependencyBit(config,dependencyId);return null==logger||logger.debug("isEngineDependencyOn: "+dependencyId+": "+result),result}}function validationFunction_isSystemOn(dependencyId){return function(_entities,logger,config){var result=EngineConfig.getSystemBit(config,dependencyId);return null==logger||logger.debug("isSystemOn: "+dependencyId+": "+result),result}}function isEnvironmentOn(environment){return function(_entities,logger,config){var _config_environment,_ref=null!=(_config_environment=null==config?void 0:config.environment)?_config_environment:{},client=_ref.client,server=_ref.server,desktop=_ref.desktop,mobile=_ref.mobile,singlePlayer=_ref.singlePlayer,fclient=environment.client,fserver=environment.server,fdesktop=environment.desktop,fmobile=environment.mobile,fsingle=environment.singlePlayer,result=client===fclient&&server===fserver&&desktop===fdesktop&&mobile===fmobile&&singlePlayer===fsingle;return null==logger||logger.debug("isEnvironmentOn: "+environment+": "+result),result}}function entityWithSubstringExists(substring){return function(entities,logger){var result=Object.keys(entities).some(function(id){return id.includes(substring)});return null==logger||logger.debug("entityWithSubstringExists: "+substring+": "+result),result}}function entityWithComponentExists(componentType){return function(entities,logger){for(var _step,_iterator=validationFunction_create_for_of_iterator_helper_loose(Object.keys(entities));!(_step=_iterator()).done;)if(entities[_step.value].getComponent(componentType))return null==logger||logger.debug("entityWithComponentExists: true"),!0;return null==logger||logger.debug("entityWithComponentExists: false"),!1}}function entityWithComponentsExist(componentTypes){return function(entities,logger){for(var _step,components=componentTypes.map(function(type){return type.name}).join(", "),_iterator=validationFunction_create_for_of_iterator_helper_loose(Object.keys(entities));!(_step=_iterator()).done;){var _ret=function(){var entity=entities[_step.value];if(componentTypes.every(function(componentType){return entity.getComponent(componentType)}))return null==logger||logger.debug("entityWithComponentsExist: "+components+": true"),{v:!0}}();if("object"==(_ret&&"undefined"!=typeof Symbol&&_ret.constructor===Symbol?"symbol":typeof _ret))return _ret.v}return null==logger||logger.debug("entityWithComponentsExist: "+components+": false"),!1}}function BallDribbleV3_set_prototype_of(o,p){return(BallDribbleV3_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BallDribbleV3=function(System){function BallDribbleV3(entityCache){var _this;return(_this=System.call(this,entityCache)||this)._cache=new Map,_this._canvasScale=_this.getCanvasScale(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BallDribbleV3_set_prototype_of(subClass,superClass)}(BallDribbleV3,System);var _proto=BallDribbleV3.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.startEntity=function(entity){this._ballTransform||(this._ballTransform=BallHelper.getBall(this._entityCache,entity)),this._cache.set(entity.id,{transform:entity.getComponentStrict(Transform_Transform),sprite:entity.getComponentStrict(Sprite),kick:entity.getComponentStrict(Kick),collider:entity.getComponentStrict(BoxCollider_BoxCollider,"kick")})},_proto.calculateSpringForce=function(playerTransform,sprite,playerCollider,ballTransform){var position=playerTransform.position,ballPosition=ballTransform.position;sprite.spriteAnimation[0].frameSize;var scale=this._canvasScale.scaleFactor,boxCenter=new Vector2((position.x+playerCollider.center.x)*scale.x,(position.y+playerCollider.center.y)*scale.y),ballCenter=new Vector2(ballPosition.x*scale.x,ballPosition.y*scale.y);return boxCenter.subtract(ballCenter).multiply(.1)},_proto.updateEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,sprite=cache.sprite,kick=cache.kick,collider=cache.collider;if(kick.enableKick){var springForce=this.calculateSpringForce(transform,sprite,collider,this._ballTransform);this._ballTransform.position.mutateAdd(springForce)}}},BallDribbleV3}(System),versions=new Map([["1.0.0",function(engine,sysData){return new BallDribbleV1(engine.entityCache)}],["2.0.0",function(engine,sysData){return new BallDribbleV2(engine.entityCache)}],["3.0.0",function(engine,sysData){return new BallDribbleV3(engine.entityCache)}]]);function getBallDribble(engine,sysData){return getSystem(engine,sysData,versions)}function getBallDribbleValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("ballDribble")(entities,logger,config)&&entityExists("ball")(entities,logger)}}function CenterCollisionV1_extends(){return(CenterCollisionV1_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var CenterCollisionV1=function(){function CenterCollisionV1(_eventSystem,_renderer,_isDebugMode){void 0===_isDebugMode&&(_isDebugMode=!1),this._eventSystem=_eventSystem,this._renderer=_renderer,this._isDebugMode=_isDebugMode,this._ctx=this._renderer.ctx}var _proto=CenterCollisionV1.prototype;return _proto.start=function(collision){var _this=this,updateCallback=function(){_this.calculateData(collision)};this._eventSystem.subscribe(""+collision.object1.entityId+"_updateCenter",updateCallback),updateCallback()},_proto.calculateData=function(collision){var position1=collision.object1.transform.position,position2=collision.object2.transform.position,_collision_object1_collider=collision.object1.collider,halfSize1=_collision_object1_collider.halfSize,center1=_collision_object1_collider.center,size1=_collision_object1_collider.size,_collision_object2_collider=collision.object2.collider,halfSize2=_collision_object2_collider.halfSize,center2=_collision_object2_collider.center,size2=_collision_object2_collider.size,point1=new Vector2(center1.x-halfSize1.x,center1.y-halfSize1.y),point2=new Vector2(center2.x-halfSize2.x,center2.y-halfSize2.y),rect1=this.createRect(position1,point1,size1),rect2=this.createRect(position2,point2,size2);return CenterCollisionV1_extends({},collision,{rect1:rect1,rect2:rect2,point1:point1,point2:point2})},_proto.createRect=function(position,point,size){var rect={};return rect.position=new Vector2(position.x+point.x,position.y+point.y),rect.size=new Vector2(size.x,size.y),rect},_proto.updatePoints=function(collision){var p1=collision.object1.transform.position,p2=collision.object2.transform.position;this.updatePosition(collision.rect1,p1,collision.point1),this.updatePosition(collision.rect2,p2,collision.point2)},_proto.updatePosition=function(rect,pos,point){rect.position.x=pos.x+point.x,rect.position.y=pos.y+point.y},_proto.isColliding=function(collision){var updColl=this.calculateData(collision);return this.updatePoints(updColl),collision.rect1=updColl.rect1,collision.rect2=updColl.rect2,updColl.rect1.position.x<updColl.rect2.position.x+updColl.rect2.size.x&&updColl.rect1.position.x+updColl.rect1.size.x>updColl.rect2.position.x&&updColl.rect1.position.y<updColl.rect2.position.y+updColl.rect2.size.y&&updColl.rect1.position.y+updColl.rect1.size.y>updColl.rect2.position.y},_proto.draw=function(collision){if(this._isDebugMode){var rect1=collision.rect1,rect2=collision.rect2;this._ctx.fillStyle="white",rect1.position&&(this._ctx.fillRect(rect1.position.x,rect1.position.y,rect1.size.x,rect1.size.y),this._ctx.fillStyle="yellow",this._ctx.fillRect(rect2.position.x,rect2.position.y,rect2.size.x,rect2.size.y))}},CenterCollisionV1}(),CollisionDetector=function(){function CollisionDetector(_collisionAlgorithm){this._collisionAlgorithm=_collisionAlgorithm,this._collisionCallbacks=new Map,this._noCollisionCallbacks=new Map}var _proto=CollisionDetector.prototype;return _proto.start=function(collision){this._collisionAlgorithm.start(collision)},_proto.getCollisionKey=function(collision){var id1=collision.object1.entityId,cid1=collision.object1.collider.id,id2=collision.object2.entityId;return cid1?id1+"_"+cid1+"_"+id2:id1+"_"+id2},_proto.update=function(collision){var isColliding=this._collisionAlgorithm.isColliding(collision),key=this.getCollisionKey(collision);if(isColliding){var callback=this._collisionCallbacks.get(key);callback&&callback(collision)}else{var callback1=this._noCollisionCallbacks.get(key);callback1&&callback1(collision)}},_proto.subscribe=function(collision,collisionCallback,noCollisionCallback){var key=this.getCollisionKey(collision);this._collisionCallbacks.set(key,collisionCallback),this._noCollisionCallbacks.set(key,noCollisionCallback)},_proto.draw=function(collision){this._collisionAlgorithm.draw(collision)},CollisionDetector}(),BallFieldCollisionHandler=function(){function BallFieldCollisionHandler(){}var _proto=BallFieldCollisionHandler.prototype;return _proto.onCollisionHandler=function(collision){var id=collision.object1.collider.id;("top_left"===id||"top_right"===id||"bottom_left"===id||"bottom_right"===id)&&(collision.object2.rigidBody.velocity.x*=-1),("top"===id||"bottom"===id)&&(collision.object2.rigidBody.velocity.y*=-1)},_proto.offCollisionHandler=function(_collision){},BallFieldCollisionHandler}();function Collision_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Collision_set_prototype_of(o,p){return(Collision_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function Collision_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return Collision_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Collision_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Collision=function(System){function Collision(entityCache,_collisionDetector,_collisionHandlers){var _this;return(_this=System.call(this,entityCache)||this)._collisionDetector=_collisionDetector,_this._collisionHandlers=_collisionHandlers,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Collision_set_prototype_of(subClass,superClass)}(Collision,System);var _proto=Collision.prototype;return _proto.startEntity=function(entity){var colliders=entity.getComponents(BoxCollider_BoxCollider);if(!colliders)throw Error("No colliders in "+entity.id);for(var _step,collisions=[],_iterator=Collision_create_for_of_iterator_helper_loose(colliders);!(_step=_iterator()).done;){var collider=_step.value,handlers=this._collisionHandlers.get(collider.id);if(handlers){var collision={object1:{},object2:{},rect1:{},rect2:{},point1:{},point2:{}};this.setCollision(collision,entity,collider),this._collisionDetector.start(collision);for(var _step1,_iterator1=Collision_create_for_of_iterator_helper_loose(handlers);!(_step1=_iterator1()).done;){var handler=_step1.value;this._collisionDetector.subscribe(collision,handler.onCollisionHandler.bind(handler),handler.offCollisionHandler.bind(handler))}collisions.push(collision)}}this._cache.set(entity.id,collisions)},_proto.setCollision=function(collision,entity,collider){this.setObject1(collision,entity,collider),this.setObject2(collision,entity)},_proto.setObject1=function(collision,entity,collider){collision.object1={entityId:entity.id,collider:collider,rigidBody:entity.getComponentStrict(RigidBody_RigidBody),transform:entity.getComponentStrict(Transform_Transform)}},_proto.setObject2=function(collision,entity){var entity2=this.getEntity2(entity);collision.object2={entityId:entity2.id,collider:entity2.getComponentStrict(BoxCollider_BoxCollider),rigidBody:entity2.getComponentStrict(RigidBody_RigidBody),transform:entity2.getComponentStrict(Transform_Transform)}},_proto.getEntity2=function(entity){return this._entityCache.getStrict(entity.getComponentStrict(CollisionObject).objectIdToCollideWith)},_proto.updateEntity=function(entity,_deltaTime){var collisions=this._cache.get(entity.id);if(collisions)for(var _step,_iterator=Collision_create_for_of_iterator_helper_loose(collisions);!(_step=_iterator()).done;){var collision=_step.value;this._collisionDetector.update(collision)}},_proto.renderEntity=function(entity,_deltaTime){var collisions=this._cache.get(entity.id);if(collisions)for(var _step,_iterator=Collision_create_for_of_iterator_helper_loose(collisions);!(_step=_iterator()).done;){var collision=_step.value;this._collisionDetector.draw(collision)}},Collision}(System),ballFieldCollisionFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem,renderer=engine.renderer,handler=new BallFieldCollisionHandler;return new Collision(entityCache,new CollisionDetector(new CenterCollisionV1(eventSystem,renderer)),new Map().set("top_left",[handler]).set("bottom_left",[handler]).set("top_right",[handler]).set("bottom_right",[handler]).set("top",[handler]).set("bottom",[handler]))}]]);function getBallFieldCollision(engine,sysData){return getSystem(engine,sysData,ballFieldCollisionFactory_versions)}function getBallFieldCollisionValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("ballFieldCollision")(entities,logger,config)&&entityExists("ball")(entities,logger)}}var componentType_Transform="transform",EntityId_Player1="player1",EntityId_Player2="player2",EntityId_Ball="ball",EventNames={StoreLastCollisionInfo:"storeLastCollisionInfo",UpdateScore:"updateScore",ChangeState:"changeState",AnimationSwitch:"animationSwitch"},IdleState=function(){function IdleState(_eventSystem){this._eventSystem=_eventSystem}var _proto=IdleState.prototype;return _proto.enter=function(entity){this._eventSystem.publish(EventNames.AnimationSwitch,{id:entity.id,animId:0})},_proto.execute=function(_entity){},_proto.exit=function(_entity){},IdleState}(),BallGateCollisionHandler=function(){function BallGateCollisionHandler(_entityCache,_entityDataCache,_eventSystem){this._entityCache=_entityCache,this._entityDataCache=_entityDataCache,this._eventSystem=_eventSystem}var _proto=BallGateCollisionHandler.prototype;return _proto.onCollisionHandler=function(collision){this.resetEntities(),this.updateEntitiesPositions(),this.handleGateCollisions(collision)},_proto.offCollisionHandler=function(_collision){},_proto.resetEntities=function(){this.resetEntity(EntityId_Player1),this.resetEntity(EntityId_Player2),this._eventSystem.publish("resetBox"),this.resetEntity(EntityId_Ball)},_proto.resetEntity=function(entityId){var entityData=this._entityDataCache.getStrict(entityId),entity=this._entityCache.getStrict(entityId),transform=entity.getComponentStrict(Transform_Transform);if(entity.getComponentStrict(RigidBody_RigidBody).velocity=new Vector2,transform.position=Vector2.fromVector(entityData[componentType_Transform].position),entityId.includes("player")){var sprite=entity.getComponentStrict(Sprite),facingDirection=entity.getComponentStrict(FacingDirection);"player1"===entityId&&(facingDirection.left=!1,facingDirection.right=!0,sprite.isFlipped=!1),"player2"===entityId&&(facingDirection.left=!0,facingDirection.right=!1,sprite.isFlipped=!1)}},_proto.updateEntitiesPositions=function(){this.updateEntityPosition(EntityId_Player1),this.updateEntityPosition(EntityId_Player2),this.updateEntityPosition(EntityId_Ball)},_proto.updateEntityPosition=function(entityId){var entityData=this._entityDataCache.getStrict(entityId);this._entityCache.getStrict(entityId).getComponentStrict(Transform_Transform).position=Vector2.fromVector(entityData[componentType_Transform].position)},_proto.handleGateCollisions=function(collision){var score=this._entityCache.getStrict("gameScore").getComponentStrict(Score);"leftGate"===collision.object1.entityId&&this.handleLeftGateCollision(score),"rightGate"===collision.object1.entityId&&this.handleRightGateCollision(score)},_proto.handleLeftGateCollision=function(score){score.score.blueScore++,this.publishScore(score),this.publishIdle()},_proto.handleRightGateCollision=function(score){score.score.redScore++,this.publishScore(score),this.publishIdle()},_proto.publishScore=function(score){this._eventSystem.publish(EventNames.UpdateScore,{redScore:score.score.redScore,blueScore:score.score.blueScore})},_proto.publishIdle=function(){this._eventSystem.publish(EventNames.ChangeState,{id:EntityId_Ball,newState:new IdleState(this._eventSystem)})},BallGateCollisionHandler}(),ballGateCollisionFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,entityDataCache=engine.entityDataCache,eventSystem=engine.eventSystem;return new Collision(entityCache,new CollisionDetector(new CenterCollisionV1(eventSystem,engine.renderer)),new Map().set("gate",[new BallGateCollisionHandler(entityCache,entityDataCache,eventSystem)]))}]]);function getBallGateCollision(engine,sysData){return getSystem(engine,sysData,ballGateCollisionFactory_versions)}function getBallGateCollisionValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("ballGateCollision")(entities,logger,config)&&(everyEntityExists(["ball","leftGate"])(entities,logger)||everyEntityExists(["ball","rightGate"])(entities,logger)||everyEntityExists(["ball","leftGate","rightGate"])(entities,logger))}}var MoveState=function(){function MoveState(_eventSystem){this._eventSystem=_eventSystem}var _proto=MoveState.prototype;return _proto.enter=function(entity){this._eventSystem.publish(EventNames.AnimationSwitch,{id:entity.id,animId:1})},_proto.execute=function(_entity){},_proto.exit=function(_entity){},MoveState}(),KeyEvents_KeyDown="KeyDown",KeyEvents_KeyUp="KeyUp",KeyboardEvent="KeyboardEvent";function Movement_set_prototype_of(o,p){return(Movement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Movement=function(System){function Movement(entityCache,_input,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._input=_input,_this._eventSystem=_eventSystem,_this._pressedKey=new Set,_this._arrowKeyActions=_this.initArrowKeyAction(),_this._wsadKeyActions=_this.initWSADKeyAction(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Movement_set_prototype_of(subClass,superClass)}(Movement,System);var _proto=Movement.prototype;return _proto.initArrowKeyAction=function(){var _this=this;return{arrowleft:function(id){return _this.OnLeft(id)},arrowright:function(id){return _this.OnRight(id)},arrowup:function(id){return _this.OnUp(id)},arrowdown:function(id){return _this.OnDown(id)}}},_proto.initWSADKeyAction=function(){var _this=this;return{a:function(id){return _this.OnLeft(id)},d:function(id){return _this.OnRight(id)},w:function(id){return _this.OnUp(id)},s:function(id){return _this.OnDown(id)}}},_proto.startEntity=function(entity){var _this=this,rigidBody=entity.getComponentStrict(RigidBody_RigidBody),keyActions=rigidBody.useArrowKeys?this._arrowKeyActions:this._wsadKeyActions;this._keyDownCallback=function(key){var keyL=key.toLowerCase();_this.isKeyMapped(keyL,keyActions)||(_this._pressedKey.add(keyL),_this.handleKeyDown(keyL,entity.id,rigidBody,keyActions))},this._keyUpCallback=function(key){var keyL=key.toLowerCase();_this.isKeyMapped(keyL,keyActions)||(_this._pressedKey.delete(keyL),_this.handleKeyUp(keyL,entity.id,rigidBody,keyActions))},this._input.subscribeInputEvent(KeyEvents_KeyDown,this._keyDownCallback),this._input.subscribeInputEvent(KeyEvents_KeyUp,this._keyUpCallback)},_proto.isKeyMapped=function(key,keyActions){return!Object.prototype.hasOwnProperty.call(keyActions,key)},_proto.handleKeyDown=function(_key,_id,_rigidBody,_keyActions){},_proto.handleKeyUp=function(_key,_id,_rigidBody,_keyActions){},_proto.unsubscribe=function(){this._input.unsubscribeInputEvent(KeyEvents_KeyDown,this._keyDownCallback),this._input.unsubscribeInputEvent(KeyEvents_KeyUp,this._keyUpCallback)},_proto.sendIdleEvent=function(id){var state={id:id,newState:new IdleState(this._eventSystem),force:!1};this._eventSystem.publish(EventNames.ChangeState+id,state)},_proto.sendMoveEvent=function(id){var state={id:id,newState:new MoveState(this._eventSystem),force:!1};this._eventSystem.publish(EventNames.ChangeState+id,state)},Movement}(System);function BallMovement_set_prototype_of(o,p){return(BallMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BallMovement=function(Movement){function BallMovement(entityCache,input,eventSystem){var _this;return(_this=Movement.call(this,entityCache,input,eventSystem)||this)._directionX=0,_this._directionY=0,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BallMovement_set_prototype_of(subClass,superClass)}(BallMovement,Movement);var _proto=BallMovement.prototype;return _proto.OnLeft=function(id){this._directionX=-1,this.sendMoveEvent(id)},_proto.OnRight=function(id){this._directionX=1,this.sendMoveEvent(id)},_proto.OnUp=function(id){this._directionY=-1,this.sendMoveEvent(id)},_proto.OnDown=function(id){this._directionY=1,this.sendMoveEvent(id)},_proto.handleKeyDown=function(_key,id,rigidBody,keyActions){this.handleKey(id,rigidBody,keyActions)},_proto.handleKeyUp=function(_key,_id,_rigidBody,_keyActions){this._directionX=0,this._directionY=0},_proto.handleKey=function(id,rigidBody,keyActions){this._pressedKey.forEach(function(key){var action=keyActions[key];action&&action(id)});var direction=new Vector2(this._directionX,this._directionY);direction.mutateNormalize().mutateMultiply(rigidBody.moveStep),rigidBody.velocity.mutateSetFrom(direction),this.sendMoveEvent(id)},BallMovement}(Movement),ballMovementFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,input=engine.input,eventSystem=engine.eventSystem,logger=engine.logger;return input||logger.warn("InputManager requiered for BallMovement."),new BallMovement(entityCache,input,eventSystem)}]]);function getBallMovement(engine,sysData){return getSystem(engine,sysData,ballMovementFactory_versions)}function getBallMovementValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("ballMovement")(entities,logger,config)&&entityExists("ball")(entities,logger)&&entityWithComponentExists(RigidBody_RigidBody)(entities,logger)}}function BoxColliderRenderer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function BoxColliderRenderer_set_prototype_of(o,p){return(BoxColliderRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BoxColliderRenderer=function(System){function BoxColliderRenderer(entityCache,_renderer){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BoxColliderRenderer_set_prototype_of(subClass,superClass)}(BoxColliderRenderer,System);var _proto=BoxColliderRenderer.prototype;return _proto.startEntity=function(entity){var _entity_getComponents,cache={transform:entity.getComponent(Transform_Transform),boxes:null!=(_entity_getComponents=entity.getComponents(BoxCollider_BoxCollider))?_entity_getComponents:[]};this._cache.set(entity.id,cache)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,boxes=cache.boxes;if(transform)for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return BoxColliderRenderer_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return BoxColliderRenderer_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(boxes);!(_step=_iterator()).done;){var box=_step.value;if(box){if(!box.enableRender)return;this._renderer.drawCollisionBox(transform,box,!0)}}}},BoxColliderRenderer}(System),boxColliderRendererFactory_versions=new Map([["1.0.0",function(engine,_sysData){return new BoxColliderRenderer(engine.entityCache,engine.renderer)}]]);function getBoxColliderRenderer(engine,sysData){return getSystem(engine,sysData,boxColliderRendererFactory_versions)}function getBoxColliderRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("boxColliderRenderer")(entities,logger,config)&&entityWithComponentsExist([Transform_Transform,BoxCollider_BoxCollider])(entities,logger)}}function BoxFlip_set_prototype_of(o,p){return(BoxFlip_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var BoxFlip=function(System){function BoxFlip(entityCache,_eventSystem,_ballHelper,_logger){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this._ballHelper=_ballHelper,_this._logger=_logger,_this._cache=new Map,_this._eventSystem.subscribe("resetBox",_this.resetBox.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&BoxFlip_set_prototype_of(subClass,superClass)}(BoxFlip,System);var _proto=BoxFlip.prototype;return _proto.startEntity=function(entity){var _this=this;this._ballTransform||(this._ballTransform=BallHelper.getBall(this._entityCache,entity));var components={transform:entity.getComponentStrict(Transform_Transform),box:entity.getComponentStrict(BoxCollider_BoxCollider,"kick"),direction:entity.getComponentStrict(Direction_Direction),dribble:entity.getComponentStrict(Dribble),facingDirection:entity.getComponentStrict(FacingDirection)};this._cache.set(entity.id,components),"player1"===entity.id&&(this._eventSystem.subscribe(""+entity.id+"_left",function(data){return _this.onLeftPlayer1(data.id,components)}),this._eventSystem.subscribe(""+entity.id+"_right",function(data){return _this.onRightPlayer1(data.id,components)})),"player2"===entity.id&&(this._eventSystem.subscribe(""+entity.id+"_left",function(data){return _this.onLeftPlayer2(data.id,components)}),this._eventSystem.subscribe(""+entity.id+"_right",function(data){return _this.onRightPlayer2(data.id,components)}))},_proto.onLeftPlayer1=function(_id,components){components.box.center.x>0&&(components.box.center.x*=-1),components.direction.directionPoint.x>0&&(components.direction.directionPoint.x*=-1),this.onLeftBallFlip(components),this._eventSystem.publish(""+_id+"_updateCenter")},_proto.onLeftBallFlip=function(components){components.dribble.enable&&components.facingDirection.right&&(this._ballTransform.position.x+=2*components.box.center.x,components.facingDirection.left=!0,components.facingDirection.right=!1,this._logger.debug("ball flipped left"))},_proto.onRightPlayer1=function(_id,components){components.box.center.x<0&&(components.box.center.x*=-1),components.direction.directionPoint.x<0&&(components.direction.directionPoint.x*=-1),this.onRightBallFlip(components),this._eventSystem.publish(""+_id+"_updateCenter")},_proto.onRightBallFlip=function(components){components.dribble.enable&&components.facingDirection.left&&(this._ballTransform.position.x+=2*components.box.center.x,components.facingDirection.right=!0,components.facingDirection.left=!1,this._logger.debug("ball flipped right"))},_proto.onLeftPlayer2=function(id,components){components.box.center.x>0&&(components.box.center.x*=-1),components.direction.directionPoint.x>0&&(components.direction.directionPoint.x*=-1),this.onLeftBallFlip(components),this._eventSystem.publish(""+id+"_updateCenter")},_proto.onRightPlayer2=function(id,components){components.box.center.x<0&&(components.box.center.x*=-1),components.direction.directionPoint.x<0&&(components.direction.directionPoint.x*=-1),this.onRightBallFlip(components),this._eventSystem.publish(""+id+"_updateCenter")},_proto.resetBox=function(){var components1=this._cache.get("player1"),components2=this._cache.get("player2");components1&&components2&&(this.onRightPlayer1("player1",components1),this.onLeftPlayer2("player2",components2))},BoxFlip}(System),boxFlipFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem,logger=engine.logger;return new BoxFlip(entityCache,eventSystem,new BallHelper,logger)}]]);function getBoxFlip(engine,sysData){return getSystem(engine,sysData,boxFlipFactory_versions)}function getBoxFlipValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("boxFlip")(entities,logger,config)&&entityExists("ball")(entities,logger)}}var CanvasContext2D=function(){function CanvasContext2D(canvasId){this._canvas=this.getCanvasElement(canvasId),this._context=this.getCanvasContext()}var _proto=CanvasContext2D.prototype;return _proto.getCanvasElement=function(canvasId){var canvas=document.getElementById(canvasId);if(!canvas)throw Error("Canvas element with id '"+canvasId+"' not found.");return canvas},_proto.getCanvasContext=function(){var context=this._canvas.getContext("2d");if(!context)throw Error("Unable to get 2D context from canvas with id '"+this._canvas.id+"'.");return context},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(CanvasContext2D.prototype,[{key:"canvas",get:function(){return this._canvas}},{key:"ctx",get:function(){return this._context}}]),CanvasContext2D}();function _construct(Parent,args,Class){return(_construct=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&GenericFactory_set_prototype_of(instance,Class.prototype),instance}:Reflect.construct).apply(null,arguments)}function GenericFactory_set_prototype_of(o,p){return(GenericFactory_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var GenericFactory=function(){function GenericFactory(){}return GenericFactory.getInstance=function(cls){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];if(!("boolean"!=typeof args[args.length-1]||args.pop()))return _construct(cls,[].concat(args));if(!GenericFactory.instances.has(cls)){var instance=_construct(cls,[].concat(args));GenericFactory.instances.set(cls,instance)}return GenericFactory.instances.get(cls)},GenericFactory.clearInstances=function(){GenericFactory.instances.clear()},GenericFactory.hasInstance=function(cls){return GenericFactory.instances.has(cls)},GenericFactory.getInstanceCount=function(){return GenericFactory.instances.size},GenericFactory}();function CanvasScaler_set_prototype_of(o,p){return(CanvasScaler_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}GenericFactory.instances=new Map;var CanvasScaler=function(System){function CanvasScaler(entityCache,_canvasContext2D,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._canvasContext2D=_canvasContext2D,_this._eventSystem=_eventSystem,_this.originalWidth=1920,_this.originalHeight=1080,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CanvasScaler_set_prototype_of(subClass,superClass)}(CanvasScaler,System);var _proto=CanvasScaler.prototype;return _proto.startEntity=function(entity){this.canvasScale=entity.getComponentStrict(CanvasScale),this.handleResize(),this.addResizeListener()},_proto.addResizeListener=function(){var _this=this;window.addEventListener("resize",function(){_this.handleResize()})},_proto.handleResize=function(){this._canvasContext2D.canvas.width=window.innerWidth,this._canvasContext2D.canvas.height=window.innerHeight,this.canvasScale.scaleFactor.x=window.innerWidth/this.originalWidth,this.canvasScale.scaleFactor.y=window.innerHeight/this.originalHeight,this._eventSystem.publish("resizeCanvas")},CanvasScaler}(System),canvasScalerFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,config=engine.config;return new CanvasScaler(entityCache,GenericFactory.getInstance(CanvasContext2D,config.canvasId),engine.eventSystem)}]]);function getCanvasScaler(engine,sysData){return getSystem(engine,sysData,canvasScalerFactory_versions)}function getCanvasScalerValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("canvasScaler")(entities,logger,config)}}function ClientMovement_set_prototype_of(o,p){return(ClientMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}(Direction=dto_Direction_Direction||(dto_Direction_Direction={})).Left="left",Direction.Right="right",Direction.Up="up",Direction.Down="down",Direction.None="none";var ClientMovement=function(Movement){function ClientMovement(entityCache,input,eventSystem){var _this;return(_this=Movement.call(this,entityCache,input,eventSystem)||this)._cache=new Map,_this._keyToDirectionMapArrows={arrowleft:dto_Direction_Direction.Left,arrowright:dto_Direction_Direction.Right,arrowup:dto_Direction_Direction.Up,arrowdown:dto_Direction_Direction.Down},_this._keyToDirectionMapWSAD={a:dto_Direction_Direction.Left,d:dto_Direction_Direction.Right,w:dto_Direction_Direction.Up,s:dto_Direction_Direction.Down},_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ClientMovement_set_prototype_of(subClass,superClass)}(ClientMovement,Movement);var _proto=ClientMovement.prototype;return _proto.startEntity=function(entity){Movement.prototype.startEntity.call(this,entity);var clientMovement=entity.getComponentStrict(ClientMovement_ClientMovement);this._cache.set(entity.id,clientMovement)},_proto.getInputDto=function(id){var cacheEntry=this._cache.get(id);return cacheEntry?(cacheEntry.inputDto.id||console.warn("inputDto has no id"),cacheEntry):(console.warn("Cache miss for entity id: "+id),{})},_proto.OnLeft=function(id){var inputDto=this.getInputDto(id).inputDto;inputDto&&inputDto.addDirection(dto_Direction_Direction.Left)},_proto.OnRight=function(id){var inputDto=this.getInputDto(id).inputDto;inputDto&&inputDto.addDirection(dto_Direction_Direction.Right)},_proto.OnUp=function(id){var inputDto=this.getInputDto(id).inputDto;inputDto&&inputDto.addDirection(dto_Direction_Direction.Up)},_proto.OnDown=function(id){var inputDto=this.getInputDto(id).inputDto;inputDto&&inputDto.addDirection(dto_Direction_Direction.Down)},_proto.handleKeyDown=function(key,id,_rigidBody,keyActions){var action=keyActions[key];action&&action(id)},_proto.handleKeyUp=function(key,id,_rigidBody,_keyActions){var inputDto=this.getInputDto(id).inputDto,releasedDirection=this.getDirectionForKey(key);inputDto&&releasedDirection&&inputDto.removeDirection(releasedDirection)},_proto.getDirectionForKey=function(key){var k=this._keyToDirectionMapWSAD[key];return k||console.warn("getDirectionForKey for "+key+" failed"),k},ClientMovement}(Movement),clientMovementFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,input=engine.input,eventSystem=engine.eventSystem,logger=engine.logger;return input||logger.warn("InputManager requiered for ClientMovement."),new ClientMovement(entityCache,input,eventSystem)}]]);function getClientMovement(engine,sysData){return getSystem(engine,sysData,clientMovementFactory_versions)}function getClientMovementValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("clientMovement")(entities,logger,config)&&(isEnvironmentOn({client:!0,desktop:!0,mobile:!1,singlePlayer:!1,server:!1})(entities,logger,config)||isEnvironmentOn({client:!0,mobile:!0,desktop:!1,singlePlayer:!1,server:!1})(entities,logger,config))}}function CollisionBoxRendererV1_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CollisionBoxRendererV1_set_prototype_of(o,p){return(CollisionBoxRendererV1_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function CollisionBoxRendererV1_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return CollisionBoxRendererV1_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CollisionBoxRendererV1_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var CollisionBoxRendererV1=function(System){function CollisionBoxRendererV1(entityCache,_renderer,_keyboardActionHandler){var _this,_this__keyboardActionHandler,_this__keyboardActionHandler_initKeyboardKey;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=null!=(_this__keyboardActionHandler_initKeyboardKey=null==(_this__keyboardActionHandler=_this._keyboardActionHandler)?void 0:_this__keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))))&&_this__keyboardActionHandler_initKeyboardKey,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CollisionBoxRendererV1_set_prototype_of(subClass,superClass)}(CollisionBoxRendererV1,System);var _proto=CollisionBoxRendererV1.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchIt=function(){for(var _step,include=["body","boots","kick","ball"],_iterator=CollisionBoxRendererV1_create_for_of_iterator_helper_loose(this._cache.values());!(_step=_iterator()).done;)for(var _step1,cache=_step.value,_iterator1=CollisionBoxRendererV1_create_for_of_iterator_helper_loose(cache.boxes);!(_step1=_iterator1()).done;)!function(){var box=_step1.value;include.find(function(b){return b===box.id})&&(box.enableRender=!box.enableRender)}()},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(cache)for(var _step,transform=cache.transform,boxes=cache.boxes,frameSize=cache.sprite.spriteAnimation[0].frameSize,scaleFactor=this._canvasScale.scaleFactor,halfFrameSizeX=frameSize.x/2,halfFrameSizeY=frameSize.y/2,spriteCenterX=(transform.position.x+halfFrameSizeX)*scaleFactor.x,spriteCenterY=(transform.position.y+halfFrameSizeY)*scaleFactor.y,i=0,_iterator=CollisionBoxRendererV1_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;if(box&&box.enableRender){var boxCenterX=spriteCenterX+(box.center.x-box.size.x/2)*scaleFactor.x,boxCenterY=spriteCenterY+(box.center.y-box.size.y/2)*scaleFactor.y;cache.boxCenter[i].x=box.origin.isCenter?boxCenterX:box.center.x*scaleFactor.x,cache.boxCenter[i].y=box.origin.isCenter?boxCenterY:box.center.y*scaleFactor.y,i++}}},_proto.startEntity=function(entity){var _entity_getComponents,sprite=entity.getComponentStrict(Sprite),boxes=null!=(_entity_getComponents=entity.getComponents(BoxCollider_BoxCollider))?_entity_getComponents:[],cache={sprite:sprite,animator:{},transform:entity.getComponentStrict(Transform_Transform),boxes:boxes,spriteOrigin:{},spriteCenter:{},boxCenter:boxes.map(function(){return new Vector2}),renderPosition:new Vector2,scale:new Vector2};this._cache.set(entity.id,cache)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache)for(var _step,ctx=this._renderer.ctx,boxes=cache.boxes,boxCenter=cache.boxCenter,scaleFactor=this._canvasScale.scaleFactor,i=0,_iterator=CollisionBoxRendererV1_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;box&&box.enableRender&&(box.style&&box.style.isStroke&&(ctx.strokeStyle=box.style.strokeColor,ctx.lineWidth=box.style.lineWidth,ctx.strokeRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),box.style&&box.style.isFill&&(ctx.fillStyle=box.color,ctx.fillRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),box.style||(ctx.fillStyle=box.color,ctx.fillRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),i++)}},CollisionBoxRendererV1}(System);function CollisionBoxRendererV2_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CollisionBoxRendererV2_set_prototype_of(o,p){return(CollisionBoxRendererV2_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function CollisionBoxRendererV2_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return CollisionBoxRendererV2_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CollisionBoxRendererV2_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var CollisionBoxRendererV2=function(System){function CollisionBoxRendererV2(entityCache,_renderer,_keyboardActionHandler){var _this,_this__keyboardActionHandler,_this__keyboardActionHandler_initKeyboardKey;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=null!=(_this__keyboardActionHandler_initKeyboardKey=null==(_this__keyboardActionHandler=_this._keyboardActionHandler)?void 0:_this__keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))))&&_this__keyboardActionHandler_initKeyboardKey,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&CollisionBoxRendererV2_set_prototype_of(subClass,superClass)}(CollisionBoxRendererV2,System);var _proto=CollisionBoxRendererV2.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchIt=function(){for(var _step,include=["body","boots","kick","ball"],_iterator=CollisionBoxRendererV2_create_for_of_iterator_helper_loose(this._cache.values());!(_step=_iterator()).done;)for(var _step1,cache=_step.value,_iterator1=CollisionBoxRendererV2_create_for_of_iterator_helper_loose(cache.boxes);!(_step1=_iterator1()).done;)!function(){var box=_step1.value;include.find(function(b){return b===box.id})&&(box.enableRender=!box.enableRender)}()},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(cache)for(var _step,transform=cache.transform,boxes=cache.boxes,scaleFactor=this._canvasScale.scaleFactor,spriteCenterX=transform.position.x*scaleFactor.x,spriteCenterY=transform.position.y*scaleFactor.y,i=0,_iterator=CollisionBoxRendererV2_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;if(box&&box.enableRender){var boxCenterX=spriteCenterX+(box.center.x-box.size.x/2)*scaleFactor.x,boxCenterY=spriteCenterY+(box.center.y-box.size.y/2)*scaleFactor.y;cache.boxCenter[i].x=box.origin.isCenter?boxCenterX:box.center.x*scaleFactor.x,cache.boxCenter[i].y=box.origin.isCenter?boxCenterY:box.center.y*scaleFactor.y,i++}}},_proto.startEntity=function(entity){var _entity_getComponents,sprite=entity.getComponentStrict(Sprite),boxes=null!=(_entity_getComponents=entity.getComponents(BoxCollider_BoxCollider))?_entity_getComponents:[],cache={sprite:sprite,animator:{},transform:entity.getComponentStrict(Transform_Transform),boxes:boxes,spriteOrigin:{},spriteCenter:{},boxCenter:boxes.map(function(){return new Vector2}),renderPosition:new Vector2,scale:new Vector2};this._cache.set(entity.id,cache)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache)for(var _step,ctx=this._renderer.ctx,boxes=cache.boxes,boxCenter=cache.boxCenter,scaleFactor=this._canvasScale.scaleFactor,i=0,_iterator=CollisionBoxRendererV2_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;box&&box.enableRender&&(box.style&&box.style.isStroke&&(ctx.strokeStyle=box.style.strokeColor,ctx.lineWidth=box.style.lineWidth,ctx.strokeRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),box.style&&box.style.isFill&&(ctx.fillStyle=box.color,ctx.fillRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),box.style||(ctx.fillStyle=box.color,ctx.fillRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y)),i++)}},CollisionBoxRendererV2}(System),KeyboardActionHandler=function(){function KeyboardActionHandler(_entityCache,_eventSystem,_logger,_data){this._entityCache=_entityCache,this._eventSystem=_eventSystem,this._logger=_logger,this._data=_data}var _proto=KeyboardActionHandler.prototype;return _proto.initKeyboardKey=function(handler){var action=this.getKeyAction();return this._eventSystem.subscribe(KeyboardEvent,this.keyHandler.bind(this,action,handler)),action.pressOnceOnStart},_proto.getKeyAction=function(){var _component_actions_find,_this__data=this._data,entityId=_this__data.entityId,actionId=_this__data.actionId,defaultKey=_this__data.defaultKey;return null!=(_component_actions_find=this._entityCache.getStrict(entityId).getComponentStrict(KeyMap).actions.find(function(a){return a.action===actionId}))?_component_actions_find:{action:actionId,key:defaultKey,pressOnceOnStart:!1}},_proto.keyHandler=function(action,handler,data){data.entityId===this._data.entityId&&data.key===action.key&&(handler(),this._logger.debug("keyHandler entity: "+data.entityId+", key: "+data.key))},KeyboardActionHandler}();function collisionBoxRendererFactory_getV2(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem,renderer=engine.renderer,logger=engine.logger;return new CollisionBoxRendererV2(entityCache,renderer,hasFeature(sysData,"keys")?new KeyboardActionHandler(entityCache,eventSystem,logger,{entityId:"debugUI",actionId:"toggleCollider",defaultKey:"i"}):void 0)}var collisionBoxRendererFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem,renderer=engine.renderer,logger=engine.logger;return new CollisionBoxRendererV1(entityCache,renderer,hasFeature(sysData,"keys")?new KeyboardActionHandler(entityCache,eventSystem,logger,{entityId:"debugUI",actionId:"toggleCollider",defaultKey:"i"}):void 0)}],["2.0.0",collisionBoxRendererFactory_getV2],["3.0.0",collisionBoxRendererFactory_getV2],["4.0.0",collisionBoxRendererFactory_getV2]]);function getCollisionBoxRenderer(engine,sysData){return getSystem(engine,sysData,collisionBoxRendererFactory_versions)}function getCollisionBoxRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("collisionBoxRenderer")(entities,logger,config)&&entityWithComponentsExist([BoxCollider_BoxCollider])(entities,logger)}}function ContentScalerTester_set_prototype_of(o,p){return(ContentScalerTester_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ContentScalerTester=function(System){function ContentScalerTester(entityCache,eventSystem,canvasContext2D,logger){var _this;return(_this=System.call(this,entityCache)||this).eventSystem=eventSystem,_this.canvasContext2D=canvasContext2D,_this.logger=logger,_this.state={lastLoggedSize:void 0,deltaThreshold:100,canvas:{initial:{width:1920,height:1080},resize:{uniformScaleFactor:1}},background:{color:"green",border:{color:"red",width:15}},square:{initial:{size:430},size:430,position:{x:0,y:0},color:"blue",point:{color:"red",radius:5}}},_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ContentScalerTester_set_prototype_of(subClass,superClass)}(ContentScalerTester,System);var _proto=ContentScalerTester.prototype;return _proto.startEntity=function(_entity){var _this=this;this.onResizeCanvas(),this.eventSystem.subscribe("resizeCanvas",function(){return _this.onResizeCanvas()})},_proto.renderEntity=function(_entity,_deltaTime){this.draw()},_proto.draw=function(){this.drawBackground(),this.drawBorder(),this.drawSquare()},_proto.drawBackground=function(){var _this_canvasContext2D=this.canvasContext2D,canvas=_this_canvasContext2D.canvas,ctx=_this_canvasContext2D.ctx;ctx.fillStyle=this.state.background.color,ctx.fillRect(0,0,canvas.width,canvas.height)},_proto.drawBorder=function(){var _this_canvasContext2D=this.canvasContext2D,canvas=_this_canvasContext2D.canvas,ctx=_this_canvasContext2D.ctx;ctx.strokeStyle=this.state.background.border.color,ctx.lineWidth=this.state.background.border.width,ctx.strokeRect(0,0,canvas.width,canvas.height)},_proto.drawSquare=function(){var ctx=this.canvasContext2D.ctx,_this_state_square=this.state.square,size=_this_state_square.size,position=_this_state_square.position,color=_this_state_square.color;ctx.fillStyle=color,ctx.fillRect(position.x,position.y,size,size),this.drawPoint(position.x,position.y)},_proto.drawPoint=function(x,y){var ctx=this.canvasContext2D.ctx,_this_state_square_point=this.state.square.point,color=_this_state_square_point.color,radius=_this_state_square_point.radius;ctx.fillStyle=color,ctx.beginPath(),ctx.arc(x,y,radius,0,2*Math.PI),ctx.fill()},_proto.onResizeCanvas=function(){this.updateScaleFactor(),this.calculateSquare(),(void 0===this.state.lastLoggedSize||Math.abs(this.state.square.size-this.state.lastLoggedSize)>=this.state.deltaThreshold)&&(this.log(),this.state.lastLoggedSize=this.state.square.size)},_proto.updateScaleFactor=function(){var _this_state_canvas_initial=this.state.canvas.initial,width=_this_state_canvas_initial.width,height=_this_state_canvas_initial.height,widthRatio=window.innerWidth/width,heightRatio=window.innerHeight/height;this.state.canvas.resize.uniformScaleFactor=Math.min(widthRatio,heightRatio)},_proto.calculateSquare=function(){var canvas=this.canvasContext2D.canvas,width=canvas.width,height=canvas.height;this.state.square.size=this.state.square.initial.size*this.state.canvas.resize.uniformScaleFactor,this.state.square.position.x=(width-this.state.square.size)/2,this.state.square.position.y=(height-this.state.square.size)/2},_proto.log=function(){var canvas=this.canvasContext2D.canvas,width=canvas.width,height=canvas.height,_this_state_canvas_initial=this.state.canvas.initial,initialCanvasWidth=_this_state_canvas_initial.width,initialCanvasHeight=_this_state_canvas_initial.height,uniformScaleFactor=this.state.canvas.resize.uniformScaleFactor,initialSquareSize=this.state.square.initial.size,_this_state_square_position=this.state.square.position,squareX=_this_state_square_position.x,squareY=_this_state_square_position.y,squareSize=this.state.square.size;this.logger.debug("Drawing resize state: \n      initialCanvasWidth: "+initialCanvasWidth+", \n      initialCanvasHeight: "+initialCanvasHeight+", \n      initialSquareSize: "+initialSquareSize+",\n      canvasWidth: "+width+", \n      canvasHeight: "+height+", \n      uniformScaleFactor: "+uniformScaleFactor+", \n      squareX: "+squareX+", \n      squareY: "+squareY+", \n      squareSize: "+squareSize)},ContentScalerTester}(System),contentScalerTesterFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,config=engine.config,logger=engine.logger;return new ContentScalerTester(entityCache,engine.eventSystem,GenericFactory.getInstance(CanvasContext2D,config.canvasId),logger)}]]);function getContentScalerTester(engine,sysData){return getSystem(engine,sysData,contentScalerTesterFactory_versions)}function DebugRenderer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function DebugRenderer_set_prototype_of(o,p){return(DebugRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function DebugRenderer_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return DebugRenderer_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DebugRenderer_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var DebugRenderer=function(System){function DebugRenderer(entityCache,_renderer,_keyboardActionHandler){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._pressOnceOnStart=_this._keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&DebugRenderer_set_prototype_of(subClass,superClass)}(DebugRenderer,System);var _proto=DebugRenderer.prototype;return _proto.switchIt=function(){for(var _step,_iterator=DebugRenderer_create_for_of_iterator_helper_loose(this._cache.values());!(_step=_iterator()).done;)for(var _step1,cache=_step.value,_iterator1=DebugRenderer_create_for_of_iterator_helper_loose(cache.boxes);!(_step1=_iterator1()).done;){var box=_step1.value;box.enableRender=!box.enableRender}},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.startEntity=function(entity){var _entity_getComponents,cache={transform:entity.getComponent(Transform_Transform),direction:entity.getComponent(Direction_Direction),rigidBody:entity.getComponent(RigidBody_RigidBody),boxes:null!=(_entity_getComponents=entity.getComponents(BoxCollider_BoxCollider))?_entity_getComponents:[]};this._cache.set(entity.id,cache)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,rigidBody=cache.rigidBody,direction=cache.direction,boxes=cache.boxes;if(transform)for(var _step,_iterator=DebugRenderer_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;if(box){if(!box.enableRender)return;this._renderer.drawCollisionBox(transform,box),rigidBody&&this._renderer.drawVector(transform.position,rigidBody.velocity,box.color),direction&&this._renderer.drawVector(transform.position,direction.directionPoint,"orange"),this._renderer.drawPoint(transform.position,{color:"yellow",halfSize:2.5})}}}},DebugRenderer}(System);function DebugRendererWithScaling_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function DebugRendererWithScaling_set_prototype_of(o,p){return(DebugRendererWithScaling_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function DebugRendererWithScaling_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return DebugRendererWithScaling_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DebugRendererWithScaling_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var DebugRendererWithScaling=function(System){function DebugRendererWithScaling(entityCache,_renderer,_keyboardActionHandler){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this.canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=_this._keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&DebugRendererWithScaling_set_prototype_of(subClass,superClass)}(DebugRendererWithScaling,System);var _proto=DebugRendererWithScaling.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchIt=function(){for(var _step,_iterator=DebugRendererWithScaling_create_for_of_iterator_helper_loose(this._cache.values());!(_step=_iterator()).done;)for(var _step1,cache=_step.value,_iterator1=DebugRendererWithScaling_create_for_of_iterator_helper_loose(cache.boxes);!(_step1=_iterator1()).done;){var box=_step1.value;box.enableRender=!box.enableRender}},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.startEntity=function(entity){var _entity_getComponents,cache={transform:entity.getComponentStrict(Transform_Transform),sprite:entity.getComponentStrict(Sprite),direction:entity.getComponentStrict(Direction_Direction),rigidBody:entity.getComponentStrict(RigidBody_RigidBody),boxes:null!=(_entity_getComponents=entity.getComponents(BoxCollider_BoxCollider))?_entity_getComponents:[],spriteOrigin:new Vector2,spriteCenter:new Vector2,boxCenter:[]};cache.boxCenter=cache.boxes.map(function(){return new Vector2}),this._cache.set(entity.id,cache)},_proto.updateEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,boxes=cache.boxes,frameSize=cache.sprite.spriteAnimation[0].frameSize,scaleFactor=this.canvasScale.scaleFactor,scaledPosX=transform.position.x*scaleFactor.x,scaledPosY=transform.position.y*scaleFactor.y,halfFrameSizeX=frameSize.x/2,halfFrameSizeY=frameSize.y/2,scaledCenterX=(transform.position.x+halfFrameSizeX)*scaleFactor.x,scaledCenterY=(transform.position.y+halfFrameSizeY)*scaleFactor.y;cache.spriteOrigin.x=scaledPosX,cache.spriteOrigin.y=scaledPosY,cache.spriteCenter.x=scaledCenterX,cache.spriteCenter.y=scaledCenterY;for(var _step,i=0,_iterator=DebugRendererWithScaling_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;if(box&&box.enableRender){var boxCenterX=scaledCenterX+(box.center.x-box.size.x/2)*scaleFactor.x,boxCenterY=scaledCenterY+(box.center.y-box.size.y/2)*scaleFactor.y;cache.boxCenter[i].x=boxCenterX,cache.boxCenter[i].y=boxCenterY,i++}}}},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,boxes=(cache.rigidBody,cache.direction,cache.boxes),spriteOrigin=(cache.sprite,cache.spriteOrigin),spriteCenter=cache.spriteCenter,boxCenter=cache.boxCenter,ctx=this._renderer.ctx,scaleFactor=this.canvasScale.scaleFactor;transform.position;for(var _step,i=0,_iterator=DebugRendererWithScaling_create_for_of_iterator_helper_loose(boxes);!(_step=_iterator()).done;){var box=_step.value;box&&box.enableRender&&(ctx.strokeStyle=box.color,ctx.lineWidth=2,ctx.strokeRect(boxCenter[i].x,boxCenter[i].y,box.size.x*scaleFactor.x,box.size.y*scaleFactor.y),this._renderer.drawPoint(spriteOrigin,{color:"purple",halfSize:4}),this._renderer.drawPoint(spriteCenter,{color:"yellow",halfSize:4}),i++)}}},DebugRendererWithScaling}(System),debugRendererFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem;return new DebugRenderer(entityCache,engine.renderer,new KeyboardActionHandler(entityCache,eventSystem,engine.logger,{entityId:"debugUI",actionId:"toggleCollider",defaultKey:"i"}))}],["2.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem;return new DebugRendererWithScaling(entityCache,engine.renderer,new KeyboardActionHandler(entityCache,eventSystem,engine.logger,{entityId:"debugUI",actionId:"toggleCollider",defaultKey:"i"}))}]]);function getDebugRenderer(engine,sysData){return getSystem(engine,sysData,debugRendererFactory_versions)}function getDebugRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("debugRenderer")(entities,logger,config)}}function DrawDirection_set_prototype_of(o,p){return(DrawDirection_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var DrawDirection=function(System){function DrawDirection(entityCache,_renderer){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._cache=new Map,_this.canvasScale=_this.getCanvasScale(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&DrawDirection_set_prototype_of(subClass,superClass)}(DrawDirection,System);var _proto=DrawDirection.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.startEntity=function(entity){var cache={transform:entity.getComponentStrict(Transform_Transform),direction:entity.getComponentStrict(Direction_Direction)};this._cache.set(entity.id,cache)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var transform=cache.transform,direction=cache.direction;this.canvasScale.scaleFactor,direction&&this._renderer.drawVector(transform.position,direction.directionPoint,"orange")}},DrawDirection}(System),drawDirectionFactory_versions=new Map([["1.0.0",function(engine,sysData){return new DrawDirection(engine.entityCache,engine.renderer)}]]);function getDrawDirection(engine,sysData){return getSystem(engine,sysData,drawDirectionFactory_versions)}function getDrawDirectionValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("drawDirection")(entities,logger,config)}}function EntityScaler_set_prototype_of(o,p){return(EntityScaler_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var EntityScaler=function(System){function EntityScaler(entityCache,_eventSystem,_logger){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this._logger=_logger,_this.resizeEventCount=0,_this.initialCenterX=960,_this.initialCenterY=540,_this.initialSize=430,_this.lastLoggedSize=void 0,_this.deltaThreshold=100,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&EntityScaler_set_prototype_of(subClass,superClass)}(EntityScaler,System);var _proto=EntityScaler.prototype;return _proto.startEntity=function(entity){var _this=this;this.scaleEntity(entity),this._eventSystem.subscribe("resizeCanvas",function(){return _this.scaleEntity(entity)})},_proto.scaleEntity=function(entity){var scale=this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale),transform=entity.getComponentStrict(Transform_Transform),boxCollider=entity.getComponentStrict(BoxCollider_BoxCollider);transform.position.x=this.initialCenterX*scale.scaleFactor.x,transform.position.y=this.initialCenterY*scale.scaleFactor.y;var uniformScaleFactor=Math.min(scale.scaleFactor.x,scale.scaleFactor.y);boxCollider.size.x=this.initialSize*uniformScaleFactor,boxCollider.size.y=this.initialSize*uniformScaleFactor,(void 0===this.lastLoggedSize||Math.abs(boxCollider.size.x-this.lastLoggedSize.x)>=this.deltaThreshold||Math.abs(boxCollider.size.y-this.lastLoggedSize.y)>=this.deltaThreshold)&&(this.log(uniformScaleFactor,transform,boxCollider),this.lastLoggedSize={x:boxCollider.size.x,y:boxCollider.size.y})},_proto.log=function(uniformScaleFactor,transform,boxCollider){this._logger.log("Entity resize state:\n        initialSize: "+this.initialSize+",\n        initialX: "+this.initialCenterX+",\n        initialY: "+this.initialCenterY+",\n        resizeEventCount: "+this.resizeEventCount+",\n        uniformScaleFactor: "+uniformScaleFactor+", \n        positionX: "+transform.position.x+", \n        positionY: "+transform.position.y+", \n        sizeX: "+boxCollider.size.x+"\n        sizeY: "+boxCollider.size.y+"\n        ")},EntityScaler}(System);function EntityScalerV11_set_prototype_of(o,p){return(EntityScalerV11_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var EntityScalerV11=function(System){function EntityScalerV11(entityCache,_entityDataCache,_renererCache,_eventSystem,_logger){var _this;return(_this=System.call(this,entityCache)||this)._entityDataCache=_entityDataCache,_this._renererCache=_renererCache,_this._eventSystem=_eventSystem,_this._logger=_logger,_this.lastLoggedSize=void 0,_this.deltaThreshold=100,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&EntityScalerV11_set_prototype_of(subClass,superClass)}(EntityScalerV11,System);var _proto=EntityScalerV11.prototype;return _proto.startEntity=function(entity){var _this=this;this.scaleEntity(entity),this._eventSystem.subscribe("resizeCanvas",function(){return _this.scaleEntity(entity)})},_proto.scaleEntity=function(entity){var canvasScale=this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale),transform=entity.getComponentStrict(Transform_Transform),boxCollider=entity.getComponentStrict(BoxCollider_BoxCollider),entityData=this._entityDataCache.getStrict(entity.id);transform.scalePosition(entityData.transform.position,canvasScale.scaleFactor),boxCollider.scaleSize(entityData.boxCollider[0].size,canvasScale.scaleFactor),(void 0===this.lastLoggedSize||Math.abs(boxCollider.size.x-this.lastLoggedSize.x)>=this.deltaThreshold||Math.abs(boxCollider.size.y-this.lastLoggedSize.y)>=this.deltaThreshold)&&(this.log(canvasScale.uniformScale,transform,boxCollider,entityData),this.lastLoggedSize={x:boxCollider.size.x,y:boxCollider.size.y})},_proto.log=function(uniformScale,transform,boxCollider,entityData){this._logger.log("Entity resize state:\n        initialSizeX: "+entityData.boxCollider[0].size.x+",\n        initialSizeY: "+entityData.boxCollider[0].size.y+",\n        initialX: "+entityData.transform.position.x+",\n        initialY: "+entityData.transform.position.y+",\n        uniformScaleFactor: "+uniformScale+", \n        positionX: "+transform.position.x+", \n        positionY: "+transform.position.y+", \n        sizeX: "+boxCollider.size.x+"\n        sizeY: "+boxCollider.size.y+"\n        ")},EntityScalerV11}(System),entityScalerFactory_versions=new Map([["1.0.0",function(engine,sysData){return new EntityScaler(engine.entityCache,engine.eventSystem,engine.logger)}],["1.1.0",function(engine,sysData){return new EntityScalerV11(engine.entityCache,engine.entityDataCache,engine.rendererCache,engine.eventSystem,engine.logger)}]]);function getEntityScaler(engine,sysData){return getSystem(engine,sysData,entityScalerFactory_versions)}function getEntityScalerValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("entityScaler")(entities,logger,config)}}function GameScore_set_prototype_of(o,p){return(GameScore_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var GameScore=function(System){function GameScore(entityCache,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&GameScore_set_prototype_of(subClass,superClass)}(GameScore,System);var _proto=GameScore.prototype;return _proto.startEntity=function(entity){this._eventSystem.subscribe(EventNames.UpdateScore,this.handleUpdateScore.bind(this,entity.getComponentStrict(Score)))},_proto.handleUpdateScore=function(component,data){component.score=data},GameScore}(System),gameScoreFactory_versions=new Map([["1.0.0",function(engine,sysData){return new GameScore(engine.entityCache,engine.eventSystem)}]]);function getGameScore(engine,sysData){return getSystem(engine,sysData,gameScoreFactory_versions)}function getGameScoreValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("gameScore")(entities,logger,config)&&everyEntityExists(["player1","player2","ball"])(entities,logger)}}function ecs_system_GameState_set_prototype_of(o,p){return(ecs_system_GameState_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var GameState=function(System){function GameState(entityCache,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ecs_system_GameState_set_prototype_of(subClass,superClass)}(GameState,System);var _proto=GameState.prototype;return _proto.startEntity=function(entity){this._eventSystem.subscribe(EventNames.StoreLastCollisionInfo,this.handleStoreLastCollisionInfo.bind(this,entity.getComponentStrict(GameState_GameState)))},_proto.handleStoreLastCollisionInfo=function(component,eventData){component.lastCollisionInfo=eventData},GameState}(System),gameStateFactory_versions=new Map([["1.0.0",function(engine,sysData){return new GameState(engine.entityCache,engine.eventSystem)}]]);function getGameState(engine,sysData){return getSystem(engine,sysData,gameStateFactory_versions)}function getGameStateValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("gameState")(entities,logger,config)&&everyEntityExists(["player1","player2","ball"])(entities,logger)}}function InsideBoxCollisionSystem_set_prototype_of(o,p){return(InsideBoxCollisionSystem_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}(Axis=Axis1||(Axis1={})).X="x",Axis.Y="y";var InsideBoxCollisionSystem=function(System){function InsideBoxCollisionSystem(){var _this;return _this=System.apply(this,arguments)||this,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&InsideBoxCollisionSystem_set_prototype_of(subClass,superClass)}(InsideBoxCollisionSystem,System);var _proto=InsideBoxCollisionSystem.prototype;return _proto.startEntity=function(entity){var cache={transform:entity.getComponentStrict(Transform_Transform),circleCollider:entity.getComponentStrict(CircleCollider),insideBoxCollider:entity.getComponentStrict(InsideBoxCollider)};this._cache.set(entity.id,cache)},_proto.updateEntity=function(entity,_deltaTime){var _this=this,cache=this._cache.get(entity.id);cache&&["x","y"].forEach(function(axis){_this.checkAndHandleCollision(cache,axis)})},_proto.checkAndHandleCollision=function(cache,axis){var transform=cache.transform,circleCollider=cache.circleCollider,insideBoxCollider=cache.insideBoxCollider,position=transform.position[axis],radius=circleCollider.radius,center=insideBoxCollider.center[axis],maxLimit=insideBoxCollider.size[axis]/2+center,minLimit=-insideBoxCollider.size[axis]/2+center;this.isCollisionDetected(position,radius,maxLimit,minLimit)&&this.resolveCollision(cache,radius,maxLimit,minLimit,axis)},_proto.isCollisionDetected=function(position,radius,maxlimit,minLimit){return position-radius<=minLimit||position+radius>=maxlimit},_proto.resolveCollision=function(cache,radius,maxLimit,minLimit,axis){var transform=cache.transform;transform.position[axis]=this.adjustPosition(transform.position[axis],radius,maxLimit,minLimit)},_proto.adjustPosition=function(position,radius,maxLimit,minLimit){return Math.max(minLimit+radius,Math.min(maxLimit-radius,position))},InsideBoxCollisionSystem}(System),insideBoxCollisionFactory_versions=new Map([["1.0.0",function(engine,sysData){return new InsideBoxCollisionSystem(engine.entityCache)}]]);function getInsideBoxCollision(engine,sysData){return getSystem(engine,sysData,insideBoxCollisionFactory_versions)}function getInsideBoxCollisionValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("insideBoxCollision")(entities,logger,config)&&entityWithComponentsExist([Transform_Transform,CircleCollider,InsideBoxCollider])(entities,logger)}}function KeyboardMapping_set_prototype_of(o,p){return(KeyboardMapping_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var KeyboardMapping=function(System){function KeyboardMapping(entityCache,_inputManager,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._inputManager=_inputManager,_this._eventSystem=_eventSystem,_this._keyActions=_this.initKeyAction(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&KeyboardMapping_set_prototype_of(subClass,superClass)}(KeyboardMapping,System);var _proto=KeyboardMapping.prototype;return _proto.initKeyAction=function(){var _obj,_this=this;return(_obj={}).q=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"q"})},_obj.e=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"e"})},_obj.z=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"z"})},_obj.x=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"x"})},_obj.r=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"r"})},_obj.f=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"f"})},_obj.y=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"y"})},_obj.u=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"u"})},_obj.i=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"i"})},_obj.o=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"o"})},_obj.p=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"p"})},_obj["/"]=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"/"})},_obj["."]=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:"."})},_obj[","]=function(id){return _this._eventSystem.publish(KeyboardEvent,{entityId:id,key:","})},_obj},_proto.startEntity=function(entity){this.subscribe(entity)},_proto.subscribe=function(entity){var _this=this;this._keyDownCallback=function(inputKey){var key=inputKey.toLowerCase();_this.isKeyMapped(key)||_this._keyActions[key](entity.id)},this._inputManager.subscribeInputEvent(KeyEvents_KeyDown,this._keyDownCallback)},_proto.isKeyMapped=function(key){return!Object.prototype.hasOwnProperty.call(this._keyActions,key)},_proto.unsubscribe=function(){this._inputManager.unsubscribeInputEvent(KeyEvents_KeyDown,this._keyDownCallback)},KeyboardMapping}(System),keyboardMappingFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,input=engine.input,eventSystem=engine.eventSystem,logger=engine.logger;return input||logger.warn("InputManager requiered for KeyboardMapping."),new KeyboardMapping(entityCache,input,eventSystem)}]]);function getKeyboardMapping(engine,sysData){return getSystem(engine,sysData,keyboardMappingFactory_versions)}function getKeyboardMappingValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("keyboardMapping")(entities,logger,config)&&isEngineDependencyOn("input")(entities,logger,config)}}function KinematicsSystem_set_prototype_of(o,p){return(KinematicsSystem_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var KinematicsSystem=function(System){function KinematicsSystem(entityCache,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&KinematicsSystem_set_prototype_of(subClass,superClass)}(KinematicsSystem,System);var _proto=KinematicsSystem.prototype;return _proto.startEntity=function(entity){var cache={transform:entity.getComponentStrict(Transform_Transform),rigidBody:entity.getComponentStrict(RigidBody_RigidBody),boxCollider:entity.getComponentStrict(BoxCollider_BoxCollider)};this._cache.set(entity.id,cache)},_proto.updateEntity=function(entity,deltaTime){var _this__cache_get,_ref=null!=(_this__cache_get=this._cache.get(entity.id))?_this__cache_get:{},transform=_ref.transform,rigidBody=_ref.rigidBody,boxCollider=_ref.boxCollider;transform&&rigidBody&&boxCollider&&(this.move(deltaTime,{transform:transform,rigidBody:rigidBody}),this.isFriction(boxCollider)&&this.friction(deltaTime,{rigidBody:rigidBody,boxCollider:boxCollider}),this.isStopped(rigidBody)&&this.stop(entity,rigidBody))},_proto.move=function(deltaTime,data){var transform=data.transform,rigidBody=data.rigidBody;transform.position.mutateAdd(Vector2.fromVector(rigidBody.velocity).multiply(deltaTime))},_proto.checkAssertion=function(condition,message){condition||console.error(message)},_proto.moveWithAssertions=function(deltaTime,data){var transform=data.transform,rigidBody=data.rigidBody,velocityVector=Vector2.fromVector(rigidBody.velocity),deltaTimeVector=velocityVector.multiply(deltaTime);this.checkAssertion(!isNaN(velocityVector.x)&&!isNaN(velocityVector.y),"Velocity vector contains NaN values"),this.checkAssertion(!isNaN(deltaTimeVector.x)&&!isNaN(deltaTimeVector.y),"DeltaTime vector contains NaN values"),this.checkAssertion(void 0!==transform.position&&null!==transform.position,"Transform position is not initialized"),this.checkAssertion(!isNaN(transform.position.x)&&!isNaN(transform.position.y),"Transform position contains NaN values"),this.checkAssertion(void 0!==rigidBody.velocity&&null!==rigidBody.velocity,"RigidBody velocity is not initialized"),this.checkAssertion(!isNaN(rigidBody.velocity.x)&&!isNaN(rigidBody.velocity.y),"RigidBody velocity contains NaN values"),transform.position.mutateAdd(deltaTimeVector),this.checkAssertion(!isNaN(transform.position.x)&&!isNaN(transform.position.y),"Transform position became NaN after mutation")},_proto.isFriction=function(boxCollider){return boxCollider.material.dynamicFriction>0},_proto.friction=function(deltaTime,data){var rigidBody=data.rigidBody,boxCollider=data.boxCollider;rigidBody.velocity.multiply(Math.pow(boxCollider.material.dynamicFriction,deltaTime))},_proto.isStopped=function(rigidBody){return rigidBody.stopThreshold>0&&rigidBody.velocity.length()<rigidBody.stopThreshold},_proto.stop=function(entity,rigidBody){(0!==rigidBody.velocity.x||0!==rigidBody.velocity.y)&&(rigidBody.velocity.x=0,rigidBody.velocity.y=0,this.sendEvent(entity.id))},_proto.sendEvent=function(id){this._eventSystem.publish(EventNames.ChangeState,{id:id,newState:new IdleState(this._eventSystem)})},KinematicsSystem}(System),kinematicsFactory_versions=new Map([["1.0.0",function(engine,sysData){return new KinematicsSystem(engine.entityCache,engine.eventSystem)}]]);function getKinematics(engine,sysData){return getSystem(engine,sysData,kinematicsFactory_versions)}function getKinematicsValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("kinematics")(entities,logger,config)&&entityWithComponentsExist([Transform_Transform,RigidBody_RigidBody,BoxCollider_BoxCollider])(entities,logger)}}function LimitMoveSystem_set_prototype_of(o,p){return(LimitMoveSystem_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var LimitMoveSystem=function(System){function LimitMoveSystem(){var _this;return _this=System.apply(this,arguments)||this,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&LimitMoveSystem_set_prototype_of(subClass,superClass)}(LimitMoveSystem,System);var _proto=LimitMoveSystem.prototype;return _proto.startEntity=function(entity){var cache={limitMove:entity.getComponentStrict(LimitMove),boxCollider:entity.getComponentStrict(BoxCollider_BoxCollider,"body"),transform:entity.getComponentStrict(Transform_Transform)};this._cache.set(entity.id,cache)},_proto.updateEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var limitMove=cache.limitMove,boxCollider=cache.boxCollider,transform=cache.transform,_boxCollider_center=boxCollider.center,offsetX=_boxCollider_center.x,offsetY=_boxCollider_center.y,halfWidth=boxCollider.halfSize.x,halfHeight=boxCollider.halfSize.y,newX=Math.max(halfWidth+offsetX,Math.min(limitMove.limitSize.x-halfWidth-offsetX,transform.position.x)),newY=Math.max(halfHeight-offsetY,Math.min(limitMove.limitSize.y-halfHeight-offsetY,transform.position.y));transform.position.x=newX,transform.position.y=newY}},LimitMoveSystem}(System),limitMoveFactory_versions=new Map([["1.0.0",function(engine,sysData){return new LimitMoveSystem(engine.entityCache)}]]);function getLimitMove(engine,sysData){return getSystem(engine,sysData,limitMoveFactory_versions)}function getLimitMoveValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("limitMove")(entities,logger,config)&&entityWithComponentExists(LimitMove)(entities,logger)}}function MarkersRendererWithScaling_set_prototype_of(o,p){return(MarkersRendererWithScaling_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MarkersRendererWithScaling=function(System){function MarkersRendererWithScaling(entityCache,_renderer,_keyboardActionHandler){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._components=new Map,_this._pressOnceOnStart=!1,_this._canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=_this._keyboardActionHandler.initKeyboardKey(_this.switchMarkers.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&MarkersRendererWithScaling_set_prototype_of(subClass,superClass)}(MarkersRendererWithScaling,System);var _proto=MarkersRendererWithScaling.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchMarkers=function(){this._components.forEach(function(components,_entityId){components.markerPoints.enableRender=!components.markerPoints.enableRender})},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchMarkers()},_proto.startEntity=function(entity){var components=this.initializeComponents(entity);this._components.set(entity.id,components),this.updateMarkers(components)},_proto.initializeComponents=function(entity){return{transform:entity.getComponentStrict(Transform_Transform),sprite:entity.getComponentStrict(Sprite),box:entity.getComponentStrict(BoxCollider_BoxCollider,"kick"),markerPoints:entity.getComponentStrict(MarkerPoints),direction:entity.getComponentStrict(Direction_Direction)}},_proto.updateMarkers=function(components){var position=components.transform.position,spriteAnimation=components.sprite.spriteAnimation,directionPoint=components.direction.directionPoint,center=components.box.center,markers=components.markerPoints.markers,scale=this._canvasScale.scaleFactor,spriteCenter=new Vector2((position.x+spriteAnimation[0].frameSize.x/2)*scale.x,(position.y+spriteAnimation[0].frameSize.y/2)*scale.y),boxCenter=new Vector2((position.x+spriteAnimation[0].frameSize.x/2+center.x)*scale.x,(position.y+spriteAnimation[0].frameSize.y/2+center.y)*scale.y),boxCenterMirror=new Vector2((position.x+spriteAnimation[0].frameSize.x/2-center.x)*scale.x,(position.y+spriteAnimation[0].frameSize.y/2+center.y)*scale.y);markers.set("position",spriteCenter),markers.set("directionPoint",position.clone().add(directionPoint)),markers.set("boxCenter",boxCenter),markers.set("boxCenterMirror",boxCenterMirror)},_proto.updateEntity=function(entity,_deltaTime){var components=this._components.get(entity.id);components&&components.markerPoints.enableRender&&this.updateMarkers(components)},_proto.renderEntity=function(entity,_deltaTime){var _this=this,components=this._components.get(entity.id);if(components&&components.markerPoints.enableRender){var markers=components.markerPoints.markers,drawPoint=function(markerName,color){void 0===color&&(color="red");var marker=markers.get(markerName);marker&&_this._renderer.drawPoint(marker,{halfSize:2.5,color:color})};drawPoint("position"),drawPoint("boxCenter"),drawPoint("boxCenterMirror")}},MarkersRendererWithScaling}(System);function MarkersRenderer_set_prototype_of(o,p){return(MarkersRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MarkersRenderer=function(System){function MarkersRenderer(entityCache,_renderer,_keyboardActionHandler){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._components=new Map,_this._pressOnceOnStart=!1,_this._pressOnceOnStart=_this._keyboardActionHandler.initKeyboardKey(_this.switchMarkers.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&MarkersRenderer_set_prototype_of(subClass,superClass)}(MarkersRenderer,System);var _proto=MarkersRenderer.prototype;return _proto.switchMarkers=function(){this._components.forEach(function(components,_entityId){components.markerPoints.enableRender=!components.markerPoints.enableRender})},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchMarkers()},_proto.startEntity=function(entity){var components=this.initializeComponents(entity);this._components.set(entity.id,components),this.updateMarkers(components)},_proto.initializeComponents=function(entity){return{transform:entity.getComponentStrict(Transform_Transform),box:entity.getComponentStrict(BoxCollider_BoxCollider,"kick"),markerPoints:entity.getComponentStrict(MarkerPoints),direction:entity.getComponentStrict(Direction_Direction)}},_proto.updateMarkers=function(components){var position=components.transform.position,directionPoint=components.direction.directionPoint,center=components.box.center,markers=components.markerPoints.markers;markers.set("position",position),markers.set("directionPoint",position.clone().add(directionPoint)),markers.set("boxCenter",position.clone().add(center));var mirror=center.clone();mirror.x*=-1,markers.set("boxCenterMirror",position.clone().add(mirror))},_proto.updateEntity=function(entity,_deltaTime){var components=this._components.get(entity.id);components&&components.markerPoints.enableRender&&this.updateMarkers(components)},_proto.renderEntity=function(entity,_deltaTime){var _this=this,components=this._components.get(entity.id);if(components&&components.markerPoints.enableRender){var markers=components.markerPoints.markers,drawPoint=function(markerName,color){void 0===color&&(color="red");var marker=markers.get(markerName);marker&&_this._renderer.drawPoint(marker,{halfSize:2.5,color:color})};drawPoint("zero"),drawPoint("position"),drawPoint("directionPoint","pink"),drawPoint("boxCenter"),drawPoint("boxCenterMirror")}},MarkersRenderer}(System),markersRendererFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache;return new MarkersRenderer(entityCache,engine.renderer,new KeyboardActionHandler(entityCache,engine.eventSystem,engine.logger,{entityId:"debugUI",actionId:"toggleMarkers",defaultKey:"u"}))}],["2.0.0",function(engine,sysData){var entityCache=engine.entityCache;return new MarkersRendererWithScaling(entityCache,engine.renderer,new KeyboardActionHandler(entityCache,engine.eventSystem,engine.logger,{entityId:"debugUI",actionId:"toggleMarkers",defaultKey:"u"}))}]]);function getMarkersRenderer(engine,sysData){return getSystem(engine,sysData,markersRendererFactory_versions)}function getMarkersRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("markers")(entities,logger,config)&&entityExists("debugUI")(entities,logger)}}var MOUSE_MOVE_EVENT_TYPE="mousemove";function MouseInput_set_prototype_of(o,p){return(MouseInput_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MouseInput=function(System){function MouseInput(entityCache){var _this;return(_this=System.call(this,entityCache)||this)._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&MouseInput_set_prototype_of(subClass,superClass)}(MouseInput,System);var _proto=MouseInput.prototype;return _proto.startEntity=function(entity){var cache={direction:entity.getComponentStrict(Direction_Direction),transform:entity.getComponentStrict(Transform_Transform),boundHandleMouseMove:this.handleMouseMove.bind(this,entity)};this._cache.set(entity.id,cache),document.addEventListener(MOUSE_MOVE_EVENT_TYPE,cache.boundHandleMouseMove)},_proto.handleMouseMove=function(entity,event){var cache=this._cache.get(entity.id);if(cache){var direction=cache.direction,transform=cache.transform;direction.direction.mutateSetTo(event.clientX-transform.position.x,event.clientY-transform.position.y),direction.directionPoint=direction.direction.normalize().multiply(50)}},_proto.unsubscribe=function(entity){var cache=this._cache.get(entity.id);cache&&cache.boundHandleMouseMove&&document.removeEventListener(MOUSE_MOVE_EVENT_TYPE,cache.boundHandleMouseMove)},MouseInput}(System),mouseInputFactory_versions=new Map([["1.0.0",function(engine,sysData){return new MouseInput(engine.entityCache)}]]);function getMouseInput(engine,sysData){return getSystem(engine,sysData,mouseInputFactory_versions)}function getMouseInputValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("mouseInput")(entities,logger,config)&&entityWithComponentExists(Direction_Direction)(entities,logger)}}function CenterCollisionV2_extends(){return(CenterCollisionV2_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var CenterCollisionV2=function(){function CenterCollisionV2(_eventSystem,_entityCache,_renderer,_isDebugMode){void 0===_isDebugMode&&(_isDebugMode=!1),this._eventSystem=_eventSystem,this._entityCache=_entityCache,this._renderer=_renderer,this._isDebugMode=_isDebugMode,this._ctx=this._renderer.ctx,this._canvasScale=this.getCanvasScale()}var _proto=CenterCollisionV2.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.start=function(collision){var _this=this,updateCallback=function(){_this.calculateData(collision)};this._eventSystem.subscribe(""+collision.object1.entityId+"_updateCenter",updateCallback),updateCallback()},_proto.calculateData=function(collision){this._canvasScale.scaleFactor;var position1=collision.object1.transform.position,position2=collision.object2.transform.position,_collision_object1_collider=collision.object1.collider,collisionBoxHalfSize1=_collision_object1_collider.halfSize,collisionBoxTopLeft1=_collision_object1_collider.center,collisionBoxSize1=_collision_object1_collider.size,_collision_object2_collider=collision.object2.collider,collisionBoxHalfSize2=_collision_object2_collider.halfSize,collisionBoxTopLeft2=_collision_object2_collider.center,collisionBoxSize2=_collision_object2_collider.size,collisionBoxCenter1=new Vector2(collisionBoxTopLeft1.x-collisionBoxHalfSize1.x,collisionBoxTopLeft1.y-collisionBoxHalfSize1.y),collisionBoxCenter2=new Vector2(collisionBoxTopLeft2.x-collisionBoxHalfSize2.x,collisionBoxTopLeft2.y-collisionBoxHalfSize2.y),spriteCenter1=new Vector2;spriteCenter1.x=position1.x+40,spriteCenter1.y=position1.y+80;var spriteCenter2=new Vector2;spriteCenter2.x=position2.x+40,spriteCenter2.y=position2.y+20;var rect1=this.createRect(spriteCenter1,collisionBoxCenter1,collisionBoxSize1),rect2=this.createRect(spriteCenter2,collisionBoxCenter2,collisionBoxSize2);return CenterCollisionV2_extends({},collision,{rect1:rect1,rect2:rect2,point1:collisionBoxTopLeft1,point2:collisionBoxTopLeft2})},_proto.createRect=function(position,point,size){var rect={},scale=this._canvasScale.scaleFactor;return rect.position=new Vector2((position.x+point.x)*scale.x,(position.y+point.y)*scale.y),rect.size=new Vector2(size.x*scale.x,size.y*scale.y),rect},_proto.updatePoints=function(collision){var p1=collision.object1.transform.position.add(new Vector2(40,80)),p2=collision.object2.transform.position.add(new Vector2(40,20));this.updatePosition(collision.rect1,p1,collision.point1,collision.object1.collider.halfSize),this.updatePosition(collision.rect2,p2,collision.point2,collision.object2.collider.halfSize)},_proto.updatePosition=function(rect,spriteCenter,boxCenter,boxHalfSize){var scale=this._canvasScale.scaleFactor;rect.position.x=(spriteCenter.x+boxCenter.x-boxHalfSize.x)*scale.x,rect.position.y=(spriteCenter.y+boxCenter.y-boxHalfSize.y)*scale.y},_proto.isColliding=function(collision){var updColl=this.calculateData(collision);return this.updatePoints(updColl),collision.rect1=updColl.rect1,collision.rect2=updColl.rect2,updColl.rect1.position.x<updColl.rect2.position.x+updColl.rect2.size.x&&updColl.rect1.position.x+updColl.rect1.size.x>updColl.rect2.position.x&&updColl.rect1.position.y<updColl.rect2.position.y+updColl.rect2.size.y&&updColl.rect1.position.y+updColl.rect1.size.y>updColl.rect2.position.y},_proto.draw=function(collision){if(this._isDebugMode){var rect1=collision.rect1,rect2=collision.rect2;this._ctx.fillStyle="white",rect1.position&&(this._ctx.fillRect(rect1.position.x,rect1.position.y,rect1.size.x,rect1.size.y),this._ctx.fillStyle="white",this._ctx.fillRect(rect2.position.x,rect2.position.y,rect2.size.x,rect2.size.y))}},_proto.drawSpriteTopLeftUnscaled=function(collision){var position1=collision.object1.transform.position,position2=collision.object2.transform.position;this._ctx.fillStyle="green",this._ctx.beginPath(),this._ctx.arc(position1.x,position1.y,5,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="green",this._ctx.beginPath(),this._ctx.arc(position2.x,position2.y,5,0,2*Math.PI),this._ctx.fill()},_proto.drawSpriteTopLeftScaled=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position;this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(position1.x*scale.x,position1.y*scale.y,2,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(position2.x*scale.x,position2.y*scale.y,2,0,2*Math.PI),this._ctx.fill()},_proto.drawSpriteCenterScaled=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position;collision.object1.collider.halfSize,collision.object2.collider.halfSize;var center1=new Vector2((position1.x+40)*scale.x,(position1.y+80)*scale.y),center2=new Vector2((position2.x+40)*scale.x,(position2.y+20)*scale.y);this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center1.x,center1.y,2,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center2.x,center2.y,2,0,2*Math.PI),this._ctx.fill()},_proto.drawCollisionBoxCenter=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position,_collision_object1_collider=collision.object1.collider,halfSize1=_collision_object1_collider.halfSize,topLeft1=_collision_object1_collider.center,_collision_object2_collider=collision.object2.collider,halfSize2=_collision_object2_collider.halfSize,topLeft2=_collision_object2_collider.center,center1=new Vector2((position1.x+40+topLeft1.x-halfSize1.x)*scale.x,(position1.y+80+topLeft1.y-halfSize1.y)*scale.y),center2=new Vector2((position2.x+40+topLeft2.x-halfSize2.x)*scale.x,(position2.y+20+topLeft2.y-halfSize2.y)*scale.y);this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center1.x,center1.y,5,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="blue",this._ctx.beginPath(),this._ctx.arc(center2.x,center2.y,5,0,2*Math.PI),this._ctx.fill()},CenterCollisionV2}();function CenterCollisionV3_extends(){return(CenterCollisionV3_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var CenterCollisionV3=function(){function CenterCollisionV3(_eventSystem,_entityCache,_renderer,_isDebugMode){void 0===_isDebugMode&&(_isDebugMode=!1),this._eventSystem=_eventSystem,this._entityCache=_entityCache,this._renderer=_renderer,this._isDebugMode=_isDebugMode,this._ctx=this._renderer.ctx,this._canvasScale=this.getCanvasScale()}var _proto=CenterCollisionV3.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.start=function(collision){var _this=this,updateCallback=function(){_this.calculateData(collision)};this._eventSystem.subscribe(""+collision.object1.entityId+"_updateCenter",updateCallback),updateCallback()},_proto.calculateData=function(collision){this._canvasScale.scaleFactor;var position1=collision.object1.transform.position,position2=collision.object2.transform.position,_collision_object1_collider=collision.object1.collider,collisionBoxHalfSize1=_collision_object1_collider.halfSize,collisionBoxTopLeft1=_collision_object1_collider.center,collisionBoxSize1=_collision_object1_collider.size,_collision_object2_collider=collision.object2.collider,collisionBoxHalfSize2=_collision_object2_collider.halfSize,collisionBoxTopLeft2=_collision_object2_collider.center,collisionBoxSize2=_collision_object2_collider.size,collisionBoxCenter1=new Vector2(collisionBoxTopLeft1.x-collisionBoxHalfSize1.x,collisionBoxTopLeft1.y-collisionBoxHalfSize1.y),collisionBoxCenter2=new Vector2(collisionBoxTopLeft2.x-collisionBoxHalfSize2.x,collisionBoxTopLeft2.y-collisionBoxHalfSize2.y),spriteCenter1=new Vector2;spriteCenter1.x=position1.x,spriteCenter1.y=position1.y;var spriteCenter2=new Vector2;spriteCenter2.x=position2.x,spriteCenter2.y=position2.y;var rect1=this.createRect(spriteCenter1,collisionBoxCenter1,collisionBoxSize1),rect2=this.createRect(spriteCenter2,collisionBoxCenter2,collisionBoxSize2);return CenterCollisionV3_extends({},collision,{rect1:rect1,rect2:rect2,point1:collisionBoxTopLeft1,point2:collisionBoxTopLeft2})},_proto.createRect=function(position,point,size){var rect={},scale=this._canvasScale.scaleFactor;return rect.position=new Vector2((position.x+point.x)*scale.x,(position.y+point.y)*scale.y),rect.size=new Vector2(size.x*scale.x,size.y*scale.y),rect},_proto.updatePoints=function(collision){var p1=collision.object1.transform.position,p2=collision.object2.transform.position;this.updatePosition(collision.rect1,p1,collision.point1,collision.object1.collider.halfSize),this.updatePosition(collision.rect2,p2,collision.point2,collision.object2.collider.halfSize)},_proto.updatePosition=function(rect,spriteCenter,boxCenter,boxHalfSize){var scale=this._canvasScale.scaleFactor;rect.position.x=(spriteCenter.x+boxCenter.x-boxHalfSize.x)*scale.x,rect.position.y=(spriteCenter.y+boxCenter.y-boxHalfSize.y)*scale.y},_proto.isColliding=function(collision){var updColl=this.calculateData(collision);return this.updatePoints(updColl),collision.rect1=updColl.rect1,collision.rect2=updColl.rect2,updColl.rect1.position.x<updColl.rect2.position.x+updColl.rect2.size.x&&updColl.rect1.position.x+updColl.rect1.size.x>updColl.rect2.position.x&&updColl.rect1.position.y<updColl.rect2.position.y+updColl.rect2.size.y&&updColl.rect1.position.y+updColl.rect1.size.y>updColl.rect2.position.y},_proto.draw=function(collision){if(this._isDebugMode){var rect1=collision.rect1,rect2=collision.rect2;this._ctx.fillStyle="white",rect1.position&&(this._ctx.fillRect(rect1.position.x,rect1.position.y,rect1.size.x,rect1.size.y),this._ctx.fillStyle="white",this._ctx.fillRect(rect2.position.x,rect2.position.y,rect2.size.x,rect2.size.y))}},_proto.drawSpriteTopLeftUnscaled=function(collision){var position1=collision.object1.transform.position,position2=collision.object2.transform.position;this._ctx.fillStyle="green",this._ctx.beginPath(),this._ctx.arc(position1.x,position1.y,5,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="green",this._ctx.beginPath(),this._ctx.arc(position2.x,position2.y,5,0,2*Math.PI),this._ctx.fill()},_proto.drawSpriteTopLeftScaled=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position;this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(position1.x*scale.x,position1.y*scale.y,2,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(position2.x*scale.x,position2.y*scale.y,2,0,2*Math.PI),this._ctx.fill()},_proto.drawSpriteCenterScaled=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position;collision.object1.collider.halfSize,collision.object2.collider.halfSize;var center1=new Vector2((position1.x+40)*scale.x,(position1.y+80)*scale.y),center2=new Vector2((position2.x+40)*scale.x,(position2.y+20)*scale.y);this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center1.x,center1.y,2,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center2.x,center2.y,2,0,2*Math.PI),this._ctx.fill()},_proto.drawCollisionBoxCenter=function(collision){var scale=this._canvasScale.scaleFactor,position1=collision.object1.transform.position,position2=collision.object2.transform.position,_collision_object1_collider=collision.object1.collider,halfSize1=_collision_object1_collider.halfSize,topLeft1=_collision_object1_collider.center,_collision_object2_collider=collision.object2.collider,halfSize2=_collision_object2_collider.halfSize,topLeft2=_collision_object2_collider.center,center1=new Vector2((position1.x+40+topLeft1.x-halfSize1.x)*scale.x,(position1.y+80+topLeft1.y-halfSize1.y)*scale.y),center2=new Vector2((position2.x+40+topLeft2.x-halfSize2.x)*scale.x,(position2.y+20+topLeft2.y-halfSize2.y)*scale.y);this._ctx.fillStyle="red",this._ctx.beginPath(),this._ctx.arc(center1.x,center1.y,5,0,2*Math.PI),this._ctx.fill(),this._ctx.fillStyle="blue",this._ctx.beginPath(),this._ctx.arc(center2.x,center2.y,5,0,2*Math.PI),this._ctx.fill()},CenterCollisionV3}(),PlayerBootsBallCollisionHandler=function(){function PlayerBootsBallCollisionHandler(_entityCache,_eventSystem){this._entityCache=_entityCache,this._eventSystem=_eventSystem,this._components=new Map}var _proto=PlayerBootsBallCollisionHandler.prototype;return _proto.onCollisionHandler=function(collision){if(!this.getComponents(collision).dribble.enable){var player=collision.object1.rigidBody,ball=collision.object2.rigidBody;this.handlePhysics(player,ball),this.sendLastCollisionEvent(collision),this.sendMoveEvent(ball,collision)}},_proto.getComponents=function(collision){var _this__components_get,playerId=collision.object1.entityId,components=null!=(_this__components_get=this._components.get(playerId))?_this__components_get:{};if(components.dribble)return components;var dribble=this._entityCache.getStrict(playerId).getComponent(Dribble);return dribble&&(components={dribble:dribble},this._components.set(playerId,components)),components},_proto.handlePhysics=function(player,ball){var relativeV=ball.velocity.clone().subtract(player.velocity),ballMassFactor=2*player.mass/(player.mass+ball.mass),newBallV=ball.velocity.clone().subtract(relativeV.clone()).multiply(ballMassFactor).multiply(ball.cor);ball.velocity.mutateSetFrom(newBallV).multiply(ball.speedMultiplier).clampLength(0,ball.maxSpeed)},_proto.sendLastCollisionEvent=function(collision){this._eventSystem.publish(EventNames.StoreLastCollisionInfo,collision)},_proto.sendMoveEvent=function(ball,collision){(Math.abs(ball.velocity.x)>0||Math.abs(ball.velocity.y)>0)&&this._eventSystem.publish(EventNames.ChangeState,{id:collision.object2.entityId,newState:new MoveState(this._eventSystem)})},_proto.offCollisionHandler=function(_collision){},PlayerBootsBallCollisionHandler}(),PlayerKickBallCollisionHandler=function(){function PlayerKickBallCollisionHandler(_entityCache){this._entityCache=_entityCache,this._components=new Map}var _proto=PlayerKickBallCollisionHandler.prototype;return _proto.onCollisionHandler=function(collision){var components=this.getComponents(collision);components.kick.enableKick=!0,0===components.timer&&(components.timer=window.setTimeout(function(){components.dribble.enable=!0},100))},_proto.getComponents=function(collision){var _this__components_get,playerId=collision.object1.entityId,components=null!=(_this__components_get=this._components.get(playerId))?_this__components_get:{};if(components.kick&&components.dribble)return components;var kick=this._entityCache.getStrict(playerId).getComponent(Kick),dribble=this._entityCache.getStrict(playerId).getComponent(Dribble);return kick&&dribble&&(components={kick:kick,dribble:dribble,timer:0},this._components.set(playerId,components)),components},_proto.offCollisionHandler=function(collision){var components=this.getComponents(collision);components.kick.enableKick=!1,components.dribble.enable=!1,components.timer>0&&(window.clearTimeout(components.timer),components.timer=0)},PlayerKickBallCollisionHandler}(),playerBallCollisionFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem;return new Collision(entityCache,new CollisionDetector(new CenterCollisionV1(eventSystem,engine.renderer,hasFeature(sysData,"debug"))),new Map().set("boots",[new PlayerBootsBallCollisionHandler(entityCache,eventSystem)]).set("kick",[new PlayerKickBallCollisionHandler(entityCache)]))}],["2.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem;return new Collision(entityCache,new CollisionDetector(new CenterCollisionV2(eventSystem,entityCache,engine.renderer,hasFeature(sysData,"debug"))),new Map().set("boots",[new PlayerBootsBallCollisionHandler(entityCache,eventSystem)]).set("kick",[new PlayerKickBallCollisionHandler(entityCache)]))}],["3.0.0",function(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem;return new Collision(entityCache,new CollisionDetector(new CenterCollisionV3(eventSystem,entityCache,engine.renderer,hasFeature(sysData,"debug"))),new Map().set("boots",[new PlayerBootsBallCollisionHandler(entityCache,eventSystem)]).set("kick",[new PlayerKickBallCollisionHandler(entityCache)]))}]]);function getPlayerBallCollision(engine,sysData){return getSystem(engine,sysData,playerBallCollisionFactory_versions)}function getPlayerBallCollisionValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("playerBallCollision")(entities,logger,config)&&everyEntityExists(["ball","player1"])(entities,logger)||everyEntityExists(["player1","player2","ball"])(entities,logger)}}function PlayerKick_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function PlayerKick_set_prototype_of(o,p){return(PlayerKick_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var PlayerKick=function(System){function PlayerKick(entityCache,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&PlayerKick_set_prototype_of(subClass,superClass)}(PlayerKick,System);var _proto=PlayerKick.prototype;return _proto.registerEntitiesById=function(entitys){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return PlayerKick_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PlayerKick_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(entitys);!(_step=_iterator()).done;){var entity=_step.value;this.registerEntityById(entity)}},_proto.registerEntityById=function(entity){System.prototype.registerEntityById.call(this,entity);var cache={};cache.direction=entity.getComponentStrict(Direction_Direction),cache.kick=entity.getComponentStrict(Kick),this.setAction(entity,cache),this._cache.set(entity.id,cache)},_proto.setAction=function(entity,cache){cache.keyMap=entity.getComponentStrict(KeyMap);var action=cache.keyMap.actions.find(function(a){return"kick"===a.action});if(action)cache.action=action;else throw Error("No kick action found on KeyMap Component")},_proto.registerBallById=function(entityId,ballEntity){var cache=this._cache.get(entityId);cache&&(cache.ballRigidBody=ballEntity.getComponentStrict(RigidBody_RigidBody))},_proto.startEntity=function(entity){var cache=this._cache.get(entity.id);cache&&this._eventSystem.subscribe(KeyboardEvent,this.kick.bind(this,entity.id,cache))},_proto.kick=function(id,cache,data){id===data.entityId&&cache.kick.enableKick&&data.key===cache.action.key&&(cache.ballRigidBody.velocity=cache.direction.direction.normalize().multiply(250),cache.kick.enableKick=!1)},PlayerKick}(System),playerKickFactory_versions=new Map([["1.0.0",function(engine,sysData){return new PlayerKick(engine.entityCache,engine.eventSystem)}]]);function getPlayerKick(engine,sysData){return getSystem(engine,sysData,playerKickFactory_versions)}function getPlayerKickValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("playerKick")(entities,logger,config)&&entityExists("ball")(entities,logger)}}function PlayerMovement_set_prototype_of(o,p){return(PlayerMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var PlayerMovement=function(Movement){function PlayerMovement(entityCache,input,eventSystem){var _this;return(_this=Movement.call(this,entityCache,input,eventSystem)||this)._cumulativeDirection=new Vector2,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&PlayerMovement_set_prototype_of(subClass,superClass)}(PlayerMovement,Movement);var _proto=PlayerMovement.prototype;return _proto.OnLeft=function(id){this.updateDirection(-1,0),this._eventSystem.publish(""+id+"_left",{id:id})},_proto.OnRight=function(id){this.updateDirection(1,0),this._eventSystem.publish(""+id+"_right",{id:id})},_proto.OnUp=function(_id){this.updateDirection(0,-1)},_proto.OnDown=function(_id){this.updateDirection(0,1)},_proto.updateDirection=function(x,y){this._cumulativeDirection.x+=x,this._cumulativeDirection.y+=y},_proto.handleKeyDown=function(_key,id,rigidBody,keyActions){this.handleKey(id,rigidBody,keyActions)},_proto.handleKey=function(id,rigidBody,keyActions){if(0===this._pressedKey.size){rigidBody.velocity.x=0,rigidBody.velocity.y=0,this.sendIdleEvent(id);return}this.resetCumulativeDirection(),this._pressedKey.forEach(function(key){var action=keyActions[key];action&&action(id)});var direction=this._cumulativeDirection.clone().normalize().multiply(rigidBody.moveStep);this.checkAssertion(!isNaN(direction.x)&&!isNaN(direction.y),"direction contains NaN values after setting"),rigidBody.velocity.mutateSetFrom(direction),this.checkAssertion(!isNaN(rigidBody.velocity.x)&&!isNaN(rigidBody.velocity.y),"RigidBody velocity contains NaN values after setting"),this.sendMoveEvent(id)},_proto.checkAssertion=function(condition,message){condition||console.error(message)},_proto.resetCumulativeDirection=function(){this._cumulativeDirection.x=0,this._cumulativeDirection.y=0},_proto.handleKeyUp=function(_key,id,rigidBody,keyActions){this.handleKey(id,rigidBody,keyActions)},PlayerMovement}(Movement),playerMovementFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,input=engine.input,eventSystem=engine.eventSystem,logger=engine.logger;return input||logger.warn("InputManager requiered for PlayerMovement."),new PlayerMovement(entityCache,input,eventSystem)}]]);function getPlayerMovement(engine,sysData){return getSystem(engine,sysData,playerMovementFactory_versions)}function getPlayerMovementValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("playerMovement")(entities,logger,config)&&isEngineDependencyOn("input")(entities,logger,config)&&entityWithSubstringExists("player")(entities,logger)&&entityWithComponentExists(RigidBody_RigidBody)(entities,logger)}}function PlayerStateRenderer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function PlayerStateRenderer_set_prototype_of(o,p){return(PlayerStateRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function PlayerStateRenderer_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return PlayerStateRenderer_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PlayerStateRenderer_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var PlayerStateRenderer=function(SumSystem){function PlayerStateRenderer(entityCache,_renderer,_keyboardActionHandler,_state){var _this;return(_this=SumSystem.call(this,entityCache)||this)._renderer=_renderer,_this._keyboardActionHandler=_keyboardActionHandler,_this._state=_state,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._offset=new Vector2,_this._pressOnceOnStart=_this._keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&PlayerStateRenderer_set_prototype_of(subClass,superClass)}(PlayerStateRenderer,SumSystem);var _proto=PlayerStateRenderer.prototype;return _proto.switchIt=function(){for(var _step,_iterator=PlayerStateRenderer_create_for_of_iterator_helper_loose(this._playerState);!(_step=_iterator()).done;){var state=_step.value;state.enableRender=!state.enableRender}},_proto.start=function(){SumSystem.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt(),this._canvasScale=this.getCanvasScale()},_proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.startEntity=function(entity){if(!this._playerState&&"playerState"===entity.id){this._playerState=null!=(_entity_getComponents=entity.getComponents(PlayerState))?_entity_getComponents:[];return}var _entity_getComponents,_this__cache_get,dribble=entity.getComponent(Dribble),kick=entity.getComponent(Kick),facingDirection=entity.getComponent(FacingDirection),cache=null!=(_this__cache_get=this._cache.get(entity.id))?_this__cache_get:{};dribble&&(cache.dribble=dribble),kick&&(cache.kick=kick),facingDirection&&(cache.facingDirection=facingDirection),this._cache.set(entity.id,cache)},_proto.render=function(_deltaTime){for(var _this,_step,scale=this._canvasScale.scaleFactor,_iterator=PlayerStateRenderer_create_for_of_iterator_helper_loose(this._cache);!(_step=_iterator()).done;)_this=this,function(){var _step_value=_step.value,key=_step_value[0],cache=_step_value[1];if(cache){var dribble=cache.dribble,kick=cache.kick,facingDirection=cache.facingDirection,textConfig=_this._playerState.find(function(p){return p.playerId===key});textConfig&&textConfig.enableRender&&(_this._offset.y=0,_this.drawText(key,""+key+":",_this._offset,"player1"===key?"red":"blue",scale),_this._offset.y=25,_this.drawText(key,"dribble: "+dribble.enable.toString(),_this._offset,"",scale),_this._offset.y=50,_this.drawText(key,"kick: "+kick.enableKick.toString(),_this._offset,"",scale),_this._offset.y=75,_this.drawText(key,"left: "+facingDirection.left.toString(),_this._offset,"",scale),_this._offset.y=100,_this.drawText(textConfig.playerId,"right: "+facingDirection.right.toString(),_this._offset,"",scale))}}()},_proto.drawText=function(id,text,offset,overrideColor,scale){void 0===overrideColor&&(overrideColor="");var textConfig=this._playerState.find(function(p){return p.playerId===id});if(textConfig){var position=textConfig.position,color=textConfig.color,font=textConfig.font,myColor=overrideColor.length>0?overrideColor:color;this._state.drawText&&this._renderer.drawText(text,position,offset,myColor,font),this._state.drawTextScaling&&this._renderer.drawTextScaling(text,position,offset,scale,myColor,font),this._state.drawTextTransform&&this._renderer.drawTextTransform(text,position,offset,scale,myColor,font)}},PlayerStateRenderer}(function(){function SumSystem(_entityCache){this._entityCache=_entityCache,this._entities=[]}var _proto=SumSystem.prototype;return _proto.registerEntityById=function(entity){this._entities.push(this._entityCache.getStrict(entity.id))},_proto.registerEntitiesById=function(entitys){var _this=this;this._entities=entitys.map(function(entity){return _this._entityCache.getStrict(entity.id)})},_proto.start=function(){var _this=this;this._entities.forEach(function(entity){_this.startEntity(entity)})},_proto.startEntity=function(_entity){},_proto.render=function(_deltaTime){},SumSystem}());function getVersion(engine,sysData){var entityCache=engine.entityCache,eventSystem=engine.eventSystem,renderer=engine.renderer,keyboardActionHandler=new KeyboardActionHandler(entityCache,eventSystem,engine.logger,{entityId:"playerState",actionId:"playerState",defaultKey:"y"}),version=sysData.version;return new PlayerStateRenderer(entityCache,renderer,keyboardActionHandler,{drawText:"1.0.0"===version,drawTextScaling:"1.5.0"===version,drawTextTransform:"2.0.0"===version})}var playerStateRendererFactory_versions=new Map([["1.0.0",getVersion],["1.5.0",getVersion],["2.0.0",getVersion]]);function getPlayerStateRenderer(engine,sysData){return getSystem(engine,sysData,playerStateRendererFactory_versions)}function getPlayerStateRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("playerStateRenderer")(entities,logger,config)&&entityExists("playerState")(entities,logger)}}function SceneRenderer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SceneRenderer_set_prototype_of(o,p){return(SceneRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function SceneRenderer_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SceneRenderer_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SceneRenderer_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var SceneRenderer=function(System){function SceneRenderer(entityCache,_systems){var _this;return(_this=System.call(this,entityCache)||this)._systems=_systems,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SceneRenderer_set_prototype_of(subClass,superClass)}(SceneRenderer,System);var _proto=SceneRenderer.prototype;return _proto.registerEntityById=function(entity){for(var _step,_iterator=SceneRenderer_create_for_of_iterator_helper_loose(this._systems);!(_step=_iterator()).done;)_step.value.registerEntityById(entity)},_proto.registerEntitiesById=function(entitys){for(var _step,_iterator=SceneRenderer_create_for_of_iterator_helper_loose(this._systems);!(_step=_iterator()).done;)_step.value.registerEntitiesById(entitys)},_proto.start=function(){for(var _step,_iterator=SceneRenderer_create_for_of_iterator_helper_loose(this._systems);!(_step=_iterator()).done;)_step.value.start()},_proto.update=function(deltaTime){for(var _step,_iterator=SceneRenderer_create_for_of_iterator_helper_loose(this._systems);!(_step=_iterator()).done;)_step.value.update(deltaTime)},_proto.render=function(deltaTime){for(var _step,_iterator=SceneRenderer_create_for_of_iterator_helper_loose(this._systems);!(_step=_iterator()).done;)_step.value.render(deltaTime)},SceneRenderer}(System);function AnimationSwitcher_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var AnimationSwitcher=function(){function AnimationSwitcher(_eventSystem,_keyboardActionHandler,_animations){this._eventSystem=_eventSystem,this._keyboardActionHandler=_keyboardActionHandler,this._animations=_animations,this._keyboardActionHandler.initKeyboardKey(this.switchIt.bind(this))}return AnimationSwitcher.prototype.switchIt=function(){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return AnimationSwitcher_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return AnimationSwitcher_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._animations);!(_step=_iterator()).done;){var animation=_step.value;animation.currentAnimation++,animation.currentAnimation>=animation.animations.length&&(animation.currentAnimation=0),this._eventSystem.publish(EventNames.AnimationSwitch,{id:animation.entityId,animId:animation.currentAnimation})}},AnimationSwitcher}();function getFootballAnimations(){return[{entityId:"player1",animations:[0,1],currentAnimation:0},{entityId:"player2",animations:[0,1],currentAnimation:0},{entityId:"ball",animations:[0,1],currentAnimation:0}]}var RendererV1=function(){function RendererV1(){}var _proto=RendererV1.prototype;return _proto.drawNormal=function(ctx,image,frame,position,_scale){ctx.drawImage(image,frame.framePosition.x,frame.framePosition.y,frame.frameSize.x,frame.frameSize.y,position.x,position.y,frame.frameSize.x,frame.frameSize.y)},_proto.drawFlipped=function(ctx,image,frame,position,scale){ctx.save(),ctx.translate(position.x+frame.frameSize.x,position.y),ctx.scale(-1,1),this.drawNormal(ctx,image,frame,Vector2.zero,scale),ctx.restore()},RendererV1}(),RendererV2=function(){function RendererV2(){}var _proto=RendererV2.prototype;return _proto.drawNormal=function(ctx,image,frame,position,scale){ctx.drawImage(image,frame.framePosition.x,frame.framePosition.y,frame.frameSize.x,frame.frameSize.y,position.x*scale.x,position.y*scale.y,frame.frameSize.x*scale.x,frame.frameSize.y*scale.y)},_proto.drawFlipped=function(ctx,image,frame,position,scale){ctx.save(),ctx.translate((position.x+frame.frameSize.x)*scale.x,position.y*scale.y),ctx.scale(-1,1),this.drawNormal(ctx,image,frame,Vector2.zero,scale),ctx.restore()},RendererV2}(),RendererV3=function(){function RendererV3(){}var _proto=RendererV3.prototype;return _proto.drawNormal=function(ctx,image,frame,position,scale){ctx.drawImage(image,frame.framePosition.x,frame.framePosition.y,frame.frameSize.x,frame.frameSize.y,(position.x-frame.frameSize.x/2)*scale.x,(position.y-frame.frameSize.y/2)*scale.y,frame.frameSize.x*scale.x,frame.frameSize.y*scale.y)},_proto.drawFlipped=function(ctx,image,frame,position,scale){ctx.save(),ctx.translate(position.x*scale.x,position.y*scale.y),ctx.scale(-1,1),this.drawNormal(ctx,image,frame,Vector2.zero,scale),ctx.restore()},RendererV3}();(AnimationType=AnimationType1||(AnimationType1={}))[AnimationType.Cyclic=0]="Cyclic",AnimationType[AnimationType.Sequential=1]="Sequential";var SpriteAnimator=function(){function SpriteAnimator(animationConfigs,renderer){var _this=this;this.animationConfigs=animationConfigs,this.renderer=renderer,this.currentAnimationIndex=0,this.currentFrameIndex=0,this.timeSinceLastFrame=0,this.isForward=!0,this.image=new Image,this.image.src=animationConfigs[0].imagePath,this.animationType=animationConfigs[0].animationType,this.animations=animationConfigs.map(function(config,index){return _this.createAnimationFrames(config,index)}),this.frameDurations=animationConfigs.map(function(config){return config.frameDuration})}var _proto=SpriteAnimator.prototype;return _proto.createAnimationFrames=function(config,animIndex){for(var frames=[],i=0;i<config.frameCount;i++)frames.push({framePosition:new Vector2(i*config.frameSize.x,animIndex*config.frameSize.y),frameSize:Vector2.fromVector(config.frameSize)});return frames},_proto.update=function(deltaTime){switch(this.animationType){case AnimationType1.Cyclic:this.cyclic(deltaTime);break;case AnimationType1.Sequential:this.sequential(deltaTime)}},_proto.cyclic=function(deltaTime){this.timeSinceLastFrame+=deltaTime,this.timeSinceLastFrame>=this.frameDurations[this.currentAnimationIndex]&&(this.currentFrameIndex<this.animations[this.currentAnimationIndex].length-1&&this.isForward?this.currentFrameIndex++:this.currentFrameIndex>0&&!this.isForward?this.currentFrameIndex--:this.isForward=!this.isForward,this.timeSinceLastFrame=0)},_proto.sequential=function(deltaTime){this.timeSinceLastFrame+=deltaTime,this.timeSinceLastFrame>=this.frameDurations[this.currentAnimationIndex]&&(this.currentFrameIndex<this.animations[this.currentAnimationIndex].length-1?this.currentFrameIndex++:this.currentFrameIndex=0,this.timeSinceLastFrame=0)},_proto.switchAnimation=function(animationIndex){if(animationIndex>=0&&animationIndex<this.animations.length){this.currentAnimationIndex=animationIndex,this.currentFrameIndex=0,this.timeSinceLastFrame=0;var config=this.animationConfigs[animationIndex];this.image.src=config.imagePath,this.animationType=config.animationType}},_proto.draw=function(ctx,position,scale,isFlipped){void 0===isFlipped&&(isFlipped=!1);var currentFrame=this.animations[this.currentAnimationIndex][this.currentFrameIndex];isFlipped?this.renderer.drawFlipped(ctx,this.image,currentFrame,position,scale):this.renderer.drawNormal(ctx,this.image,currentFrame,position,scale)},SpriteAnimator}(),SpriteAnimatorFactory=function(){function SpriteAnimatorFactory(version,logger){this.version=version,this.logger=logger}return SpriteAnimatorFactory.prototype.createSpriteAnimator=function(animationConfigs){var renderer;return"1.0.0"===this.version?renderer=new RendererV1:"2.0.0"===this.version?renderer=new RendererV2:"3.0.0"===this.version?renderer=new RendererV3:(this.logger.warn("Version "+this.version+" not present. Default renderer set."),renderer=new RendererV1),new SpriteAnimator(animationConfigs,renderer)},SpriteAnimatorFactory}();function SpriteRendererV3_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SpriteRendererV3_set_prototype_of(o,p){return(SpriteRendererV3_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteRendererV3=function(System){function SpriteRendererV3(entityCache,_renderer,_eventSystem,_spriteAnimatorFactory,_keyboardActionHandler){var _this,_this__keyboardActionHandler,_this__keyboardActionHandler_initKeyboardKey;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._eventSystem=_eventSystem,_this._spriteAnimatorFactory=_spriteAnimatorFactory,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=null!=(_this__keyboardActionHandler_initKeyboardKey=null==(_this__keyboardActionHandler=_this._keyboardActionHandler)?void 0:_this__keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))))&&_this__keyboardActionHandler_initKeyboardKey,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteRendererV3_set_prototype_of(subClass,superClass)}(SpriteRendererV3,System);var _proto=SpriteRendererV3.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchIt=function(){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SpriteRendererV3_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SpriteRendererV3_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._cache.values());!(_step=_iterator()).done;){var cache=_step.value;cache.sprite.flags.showCenter=!cache.sprite.flags.showCenter,cache.sprite.flags.showOrigin=!cache.sprite.flags.showOrigin}},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.startEntity=function(entity){var sprite=entity.getComponentStrict(Sprite),cache={sprite:sprite,animator:this._spriteAnimatorFactory.createSpriteAnimator(sprite.spriteAnimation),transform:entity.getComponentStrict(Transform_Transform),boxes:[],spriteOrigin:new Vector2,spriteCenter:new Vector2,boxCenter:[],renderPosition:new Vector2,scale:new Vector2};this._cache.set(entity.id,cache),this.subscribeEvent(entity,cache)},_proto.subscribeEvent=function(entity,cache){this._eventSystem.subscribe(EventNames.AnimationSwitch,this.switchAnimation.bind(this,entity,cache))},_proto.switchAnimation=function(entity,cache,data){data.id===entity.id&&cache.animator.switchAnimation(data.animId)},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(cache){cache.animator.update(deltaTime);var transform=cache.transform,scaleFactor=this._canvasScale.scaleFactor,scaledPosX=transform.position.x*scaleFactor.x,scaledPosY=transform.position.y*scaleFactor.y;cache.spriteOrigin.x=scaledPosX,cache.spriteOrigin.y=scaledPosY}},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var ctx=this._renderer.ctx,transform=cache.transform,sprite=cache.sprite,spriteOrigin=cache.spriteOrigin;cache.animator.draw(ctx,transform.position,this._canvasScale.scaleFactor,sprite.isFlipped),sprite.flags.showOrigin&&this._renderer.drawPoint(spriteOrigin,{color:sprite.values.originColor,halfSize:sprite.numbers.pointWidth})}},SpriteRendererV3}(System);function SpriteRendererV1_set_prototype_of(o,p){return(SpriteRendererV1_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteRendererV1=function(System){function SpriteRendererV1(entityCache,_renderer,_eventSystem,_spriteAnimatorFactory,_logger){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._eventSystem=_eventSystem,_this._spriteAnimatorFactory=_spriteAnimatorFactory,_this._logger=_logger,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteRendererV1_set_prototype_of(subClass,superClass)}(SpriteRendererV1,System);var _proto=SpriteRendererV1.prototype;return _proto.startEntity=function(entity){var cache=this.createCache(entity);this._cache.set(entity.id,cache),this.subscribeEvent(entity,cache)},_proto.createCache=function(entity){var sprite=entity.getComponentStrict(Sprite);return{sprite:sprite,transform:entity.getComponentStrict(Transform_Transform),renderPosition:new Vector2,scale:new Vector2(1,1),animator:this._spriteAnimatorFactory.createSpriteAnimator(sprite.spriteAnimation),boxes:[],spriteOrigin:new Vector2,spriteCenter:new Vector2,boxCenter:[]}},_proto.subscribeEvent=function(entity,cache){this._eventSystem.subscribe(EventNames.AnimationSwitch,this.switchAnimation.bind(this,entity,cache))},_proto.switchAnimation=function(entity,cache,data){data.id===entity.id&&cache.animator.switchAnimation(data.animId)},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(!cache){this._logger.warn("No cache for "+entity.id);return}this.setPosition(cache),cache.animator.update(deltaTime)},_proto.setPosition=function(cache){var transform=cache.transform,sprite=cache.sprite;cache.renderPosition.x=transform.position.x+sprite.spriteOffset.x,cache.renderPosition.y=transform.position.y+sprite.spriteOffset.y},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(!cache){this._logger.warn("No cache for "+entity.id);return}var animator=cache.animator,renderPosition=cache.renderPosition,scale=cache.scale,sprite=cache.sprite;animator.draw(this._renderer.ctx,renderPosition,scale,sprite.isFlipped)},SpriteRendererV1}(System);function SpriteRendererV2_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SpriteRendererV2_set_prototype_of(o,p){return(SpriteRendererV2_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteRendererV2=function(System){function SpriteRendererV2(entityCache,_renderer,_eventSystem,_spriteAnimatorFactory,_keyboardActionHandler){var _this,_this__keyboardActionHandler,_this__keyboardActionHandler_initKeyboardKey;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._eventSystem=_eventSystem,_this._spriteAnimatorFactory=_spriteAnimatorFactory,_this._keyboardActionHandler=_keyboardActionHandler,_this._cache=new Map,_this._pressOnceOnStart=!1,_this._canvasScale=_this.getCanvasScale(),_this._pressOnceOnStart=null!=(_this__keyboardActionHandler_initKeyboardKey=null==(_this__keyboardActionHandler=_this._keyboardActionHandler)?void 0:_this__keyboardActionHandler.initKeyboardKey(_this.switchIt.bind(function(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}(_this))))&&_this__keyboardActionHandler_initKeyboardKey,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteRendererV2_set_prototype_of(subClass,superClass)}(SpriteRendererV2,System);var _proto=SpriteRendererV2.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.switchIt=function(){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SpriteRendererV2_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SpriteRendererV2_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._cache.values());!(_step=_iterator()).done;){var cache=_step.value;cache.sprite.flags.showCenter=!cache.sprite.flags.showCenter,cache.sprite.flags.showOrigin=!cache.sprite.flags.showOrigin}},_proto.start=function(){System.prototype.start.call(this),this._pressOnceOnStart&&this.switchIt()},_proto.startEntity=function(entity){var sprite=entity.getComponentStrict(Sprite),cache={sprite:sprite,animator:this._spriteAnimatorFactory.createSpriteAnimator(sprite.spriteAnimation),transform:entity.getComponentStrict(Transform_Transform),boxes:[],spriteOrigin:new Vector2,spriteCenter:new Vector2,boxCenter:[],renderPosition:new Vector2,scale:new Vector2};this._cache.set(entity.id,cache),this.subscribeEvent(entity,cache)},_proto.subscribeEvent=function(entity,cache){this._eventSystem.subscribe(EventNames.AnimationSwitch,this.switchAnimation.bind(this,entity,cache))},_proto.switchAnimation=function(entity,cache,data){data.id===entity.id&&cache.animator.switchAnimation(data.animId)},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(cache){cache.animator.update(deltaTime);var transform=cache.transform,frameSize=cache.sprite.spriteAnimation[0].frameSize,scaleFactor=this._canvasScale.scaleFactor,scaledPosX=transform.position.x*scaleFactor.x,scaledPosY=transform.position.y*scaleFactor.y,halfFrameSizeX=frameSize.x/2,halfFrameSizeY=frameSize.y/2,scaledCenterX=(transform.position.x+halfFrameSizeX)*scaleFactor.x,scaledCenterY=(transform.position.y+halfFrameSizeY)*scaleFactor.y;cache.spriteOrigin.x=scaledPosX,cache.spriteOrigin.y=scaledPosY,cache.spriteCenter.x=scaledCenterX,cache.spriteCenter.y=scaledCenterY}},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var ctx=this._renderer.ctx,transform=cache.transform,sprite=cache.sprite,spriteOrigin=cache.spriteOrigin,spriteCenter=cache.spriteCenter;cache.animator.draw(ctx,transform.position,this._canvasScale.scaleFactor,sprite.isFlipped),sprite.flags.showOrigin&&this._renderer.drawPoint(spriteOrigin,{color:sprite.values.originColor,halfSize:sprite.numbers.pointWidth}),sprite.flags.showCenter&&this._renderer.drawPoint(spriteCenter,{color:sprite.values.centerColor,halfSize:sprite.numbers.pointWidth})}},SpriteRendererV2}(System);function SpriteRendererV4_set_prototype_of(o,p){return(SpriteRendererV4_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteRendererV4=function(System){function SpriteRendererV4(entityCache,_renderer,_eventSystem,_spriteAnimatorFactory,_switchToAnim){var _this;return(_this=System.call(this,entityCache)||this)._renderer=_renderer,_this._eventSystem=_eventSystem,_this._spriteAnimatorFactory=_spriteAnimatorFactory,_this._switchToAnim=_switchToAnim,_this._cache=new Map,_this._canvasScale=_this.getCanvasScale(),_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteRendererV4_set_prototype_of(subClass,superClass)}(SpriteRendererV4,System);var _proto=SpriteRendererV4.prototype;return _proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.startEntity=function(entity){var sprite=entity.getComponentStrict(Sprite),cache={sprite:sprite,animator:this._spriteAnimatorFactory.createSpriteAnimator(sprite.spriteAnimation),transform:entity.getComponentStrict(Transform_Transform)};this._cache.set(entity.id,cache),this.subscribeEvent(entity,cache),this._switchToAnim&&cache.animator.switchAnimation(1)},_proto.subscribeEvent=function(entity,cache){this._eventSystem.subscribe(EventNames.AnimationSwitch,this.switchAnimation.bind(this,entity,cache))},_proto.switchAnimation=function(entity,cache,data){data.id===entity.id&&cache.animator.switchAnimation(data.animId)},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);cache&&cache.animator.update(deltaTime)},_proto.renderEntity=function(entity,_deltaTime){var cache=this._cache.get(entity.id);if(cache){var ctx=this._renderer.ctx,transform=cache.transform,sprite=cache.sprite;cache.animator.draw(ctx,this._canvasScale.scaleFactor,transform,sprite.isFlipped)}},SpriteRendererV4}(System),CyclicAnimation=function(){function CyclicAnimation(){}return CyclicAnimation.prototype.update=function(deltaTime,state){state.timeSinceLastFrame+=deltaTime;var frameDuration=state.frameDurations[state.currentAnimationIndex],frames=state.animations[state.currentAnimationIndex].length-1;state.timeSinceLastFrame>=frameDuration&&(state.currentFrameIndex<frames&&state.isForward?state.currentFrameIndex++:state.currentFrameIndex>0&&!state.isForward?state.currentFrameIndex--:state.isForward=!state.isForward,state.timeSinceLastFrame=0)},CyclicAnimation}(),RendererV4=function(){function RendererV4(){}var _proto=RendererV4.prototype;return _proto.drawNormal=function(ctx,canvasScale,image,frame,transform){var position=transform.position,scale=transform.scale;ctx.save(),ctx.scale(canvasScale.x,canvasScale.y),ctx.scale(scale.x,scale.y),ctx.drawImage(image,frame.framePosition.x,frame.framePosition.y,frame.frameSize.x,frame.frameSize.y,position.x-frame.frameSize.x/2,position.y-frame.frameSize.y/2,frame.frameSize.x,frame.frameSize.y),ctx.restore()},_proto.drawFlipped=function(ctx,canvasScale,image,frame,transform){var position=transform.position,scale=transform.scale;ctx.save(),ctx.scale(canvasScale.x,canvasScale.y),ctx.scale(-scale.x,scale.y),ctx.drawImage(image,frame.framePosition.x,frame.framePosition.y,frame.frameSize.x,frame.frameSize.y,-(position.x+frame.frameSize.x/2),position.y-frame.frameSize.y/2,frame.frameSize.x,frame.frameSize.y),ctx.restore()},RendererV4}(),SequentialAnimation=function(){function SequentialAnimation(){}return SequentialAnimation.prototype.update=function(deltaTime,state){state.timeSinceLastFrame+=deltaTime;var frameDuration=state.frameDurations[state.currentAnimationIndex],frames=state.animations[state.currentAnimationIndex].length-1;state.timeSinceLastFrame>=frameDuration&&(state.currentFrameIndex<frames?state.currentFrameIndex++:state.currentFrameIndex=0,state.timeSinceLastFrame=0)},SequentialAnimation}(),AnimationState=function(frameDurations,animations,currentAnimationIndex,currentFrameIndex,timeSinceLastFrame,isForward){void 0===currentAnimationIndex&&(currentAnimationIndex=0),void 0===currentFrameIndex&&(currentFrameIndex=0),void 0===timeSinceLastFrame&&(timeSinceLastFrame=0),void 0===isForward&&(isForward=!0),this.frameDurations=frameDurations,this.animations=animations,this.currentAnimationIndex=currentAnimationIndex,this.currentFrameIndex=currentFrameIndex,this.timeSinceLastFrame=timeSinceLastFrame,this.isForward=isForward},SpriteAnimatorV4=function(){function SpriteAnimatorV4(animationConfigs,renderer,cyclicAnimation,sequentialAnimation){var _this=this;this.animationConfigs=animationConfigs,this.renderer=renderer,this.cyclicAnimation=cyclicAnimation,this.sequentialAnimation=sequentialAnimation,this.image=new Image,this.image.src=animationConfigs[0].imagePath,this.animations=animationConfigs.map(function(config,index){return _this.createAnimationFrames(config,index)}),this.animationState=new AnimationState(animationConfigs.map(function(config){return config.frameDuration}),this.animations),this.setAnimationStrategy(animationConfigs[0].animationType)}var _proto=SpriteAnimatorV4.prototype;return _proto.createAnimationFrames=function(config,animIndex){for(var frames=[],i=0;i<config.frameCount;i++)frames.push({framePosition:new Vector2(i*config.frameSize.x,animIndex*config.frameSize.y),frameSize:Vector2.fromVector(config.frameSize)});return frames},_proto.setAnimationStrategy=function(animationType){switch(animationType){case AnimationType1.Cyclic:this.animationStrategy=this.cyclicAnimation;break;case AnimationType1.Sequential:this.animationStrategy=this.sequentialAnimation;break;default:throw Error("Unsupported animation type")}},_proto.update=function(deltaTime){this.animationStrategy.update(deltaTime,this.animationState)},_proto.switchAnimation=function(animationIndex){if(animationIndex>=0&&animationIndex<this.animations.length){var config=this.animationConfigs[animationIndex];this.image.src=config.imagePath,this.setAnimationStrategy(config.animationType),this.animationState.currentAnimationIndex=animationIndex,this.animationState.currentFrameIndex=0,this.animationState.timeSinceLastFrame=0}},_proto.draw=function(ctx,canvasScale,transform,isFlipped){void 0===isFlipped&&(isFlipped=!1);var currentFrame=this.animationState.animations[this.animationState.currentAnimationIndex][this.animationState.currentFrameIndex];isFlipped?this.renderer.drawFlipped(ctx,canvasScale,this.image,currentFrame,transform):this.renderer.drawNormal(ctx,canvasScale,this.image,currentFrame,transform)},SpriteAnimatorV4}(),SpriteAnimatorFactoryV4=function(){function SpriteAnimatorFactoryV4(version,logger){this.version=version,this.logger=logger}return SpriteAnimatorFactoryV4.prototype.createSpriteAnimator=function(animationConfigs){return"4.0.0"===this.version||this.logger.warn("Version "+this.version+" not present. Default renderer set."),new SpriteAnimatorV4(animationConfigs,new RendererV4,new CyclicAnimation,new SequentialAnimation)},SpriteAnimatorFactoryV4}();function activateAnimationSwitcher(sysData,eventSystem,entityCache,logger,animations){return!!hasFeature(sysData,"keys")&&(new AnimationSwitcher(eventSystem,new KeyboardActionHandler(entityCache,eventSystem,logger,{entityId:"debugUI",actionId:"toggleAnimation",defaultKey:"o"}),animations),!0)}function createKeyHandler(isKeys,entityCache,eventSystem,logger){return isKeys?new KeyboardActionHandler(entityCache,eventSystem,logger,{entityId:"debugUI",actionId:"toggleOrigin",defaultKey:"y"}):void 0}var spriteRendererFactory_versions=new Map([["1.0.0",function(engine,sysData){var entityCache=engine.entityCache,renderer=engine.renderer,eventSystem=engine.eventSystem,logger=engine.logger;return activateAnimationSwitcher(sysData,eventSystem,entityCache,logger,getFootballAnimations()),new SpriteRendererV1(entityCache,renderer,eventSystem,new SpriteAnimatorFactory("1.0.0",logger),logger)}],["2.0.0",function(engine,sysData){var entityCache=engine.entityCache,renderer=engine.renderer,eventSystem=engine.eventSystem,logger=engine.logger,isKeys=activateAnimationSwitcher(sysData,eventSystem,entityCache,logger,getFootballAnimations());return new SpriteRendererV2(entityCache,renderer,eventSystem,new SpriteAnimatorFactory("2.0.0",logger),createKeyHandler(isKeys,entityCache,eventSystem,logger))}],["3.0.0",function(engine,sysData){var entityCache=engine.entityCache,renderer=engine.renderer,eventSystem=engine.eventSystem,logger=engine.logger,isKeys=activateAnimationSwitcher(sysData,eventSystem,entityCache,logger,getFootballAnimations());return new SpriteRendererV3(entityCache,renderer,eventSystem,new SpriteAnimatorFactory("3.0.0",logger),createKeyHandler(isKeys,entityCache,eventSystem,logger))}],["4.0.0",function(engine,sysData){var entityCache=engine.entityCache,renderer=engine.renderer,eventSystem=engine.eventSystem,logger=engine.logger;return activateAnimationSwitcher(sysData,eventSystem,entityCache,logger,[{entityId:"player1",animations:[0,1],currentAnimation:0},{entityId:"player2",animations:[0,1],currentAnimation:0},{entityId:"player3",animations:[0,1],currentAnimation:0},{entityId:"player4",animations:[0,1],currentAnimation:0}]),new SpriteRendererV4(entityCache,renderer,eventSystem,new SpriteAnimatorFactoryV4("4.0.0",logger),1)}]]);function getSpriteRenderer(engine,sysData){return getSystem(engine,sysData,spriteRendererFactory_versions)}function getSpriteRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("spriteRenderer")(entities,logger,config)&&isEngineDependencyOn("renderer")(entities,logger,config)&&entityWithComponentsExist([Sprite,Transform_Transform])(entities,logger)}}function getCurrent(engine,sysData){var entityCache=engine.entityCache,systems=[];return systems.push(getSpriteRenderer(engine,sysData)),systems.push(getCollisionBoxRenderer(engine,sysData)),new SceneRenderer(entityCache,systems)}var sceneRendererFactory_versions=new Map([["1.0.0",getCurrent],["2.0.0",getCurrent],["3.0.0",getCurrent],["4.0.0",getCurrent]]);function getSceneRenderer(engine,sysData){return getSystem(engine,sysData,sceneRendererFactory_versions)}function getSceneRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("sceneRenderer")(entities,logger,config)&&entityWithComponentsExist([Sprite,Transform_Transform])(entities,logger)}}function SingleEntitySystem_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ScoreRenderer_set_prototype_of(o,p){return(ScoreRenderer_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ScoreRenderer=function(SingleEntitySystem){function ScoreRenderer(entityCache,_renderer,_state){var _this;return(_this=SingleEntitySystem.call(this,entityCache)||this)._renderer=_renderer,_this._state=_state,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ScoreRenderer_set_prototype_of(subClass,superClass)}(ScoreRenderer,SingleEntitySystem);var _proto=ScoreRenderer.prototype;return _proto.start=function(){this._score=this._entity.getComponentStrict(Score),this._canvasScale=this.getCanvasScale()},_proto.getCanvasScale=function(){return this._entityCache.getStrict("canvas").getComponentStrict(CanvasScale)},_proto.render=function(_deltaTime){var _this__score=this._score,position=_this__score.position,score=_this__score.score,redTeam=_this__score.redTeam,blueTeam=_this__score.blueTeam,delimiter=_this__score.delimiter,font=_this__score.font,scale=this._canvasScale.scaleFactor;this._state.drawText&&this.useDrawText(position,delimiter,font,score,redTeam,blueTeam),this._state.drawTextScaling&&this.useDrawTextScaling(position,scale,delimiter,font,score,redTeam,blueTeam),this._state.drawTextTransform&&this.useDrawTextTransform(position,scale,delimiter,font,score,redTeam,blueTeam)},_proto.useDrawText=function(position,delimiter,font,score,redTeam,blueTeam){this._renderer.drawText(delimiter.text,position,Vector2.zero,delimiter.color,font),this._renderer.drawText(score.redScore.toString(),position,redTeam.offset,redTeam.color,font),this._renderer.drawText(this._score.score.blueScore.toString(),position,blueTeam.offset,blueTeam.color,font)},_proto.useDrawTextScaling=function(position,scale,delimiter,font,score,redTeam,blueTeam){this._renderer.drawTextScaling(delimiter.text,position,Vector2.zero,scale,delimiter.color,font),this._renderer.drawTextScaling(score.redScore.toString(),position,redTeam.offset,scale,redTeam.color,font),this._renderer.drawTextScaling(this._score.score.blueScore.toString(),position,blueTeam.offset,scale,blueTeam.color,font)},_proto.useDrawTextTransform=function(position,scale,delimiter,font,score,redTeam,blueTeam){this._renderer.drawTextTransform(delimiter.text,position,Vector2.zero,scale,delimiter.color,font),this._renderer.drawTextTransform(score.redScore.toString(),position,redTeam.offset,scale,redTeam.color,font),this._renderer.drawTextTransform(this._score.score.blueScore.toString(),position,blueTeam.offset,scale,blueTeam.color,font)},ScoreRenderer}(function(){function SingleEntitySystem(_entityCache){this._entityCache=_entityCache}var _proto=SingleEntitySystem.prototype;return _proto.registerEntityById=function(entity){this._entity=this._entityCache.getStrict(entity.id)},_proto.registerEntitiesById=function(entitys){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SingleEntitySystem_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SingleEntitySystem_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(entitys);!(_step=_iterator()).done;){var entity=_step.value;this.registerEntityById(entity)}},_proto.start=function(){},_proto.update=function(_deltaTime){},_proto.render=function(_deltaTime){},SingleEntitySystem}());function scoreRendererFactory_getVersion(engine,sysData){var entityCache=engine.entityCache,renderer=engine.renderer,version=sysData.version;return new ScoreRenderer(entityCache,renderer,{drawText:"1.0.0"===version,drawTextScaling:"1.5.0"===version,drawTextTransform:"2.0.0"===version})}var scoreRendererFactory_versions=new Map([["1.0.0",scoreRendererFactory_getVersion],["1.5.0",scoreRendererFactory_getVersion],["2.0.0",scoreRendererFactory_getVersion]]);function getScoreRenderer(engine,sysData){return getSystem(engine,sysData,scoreRendererFactory_versions)}function getScoreRendererValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("scoreRenderer")(entities,logger,config)}}function ServerMovement_set_prototype_of(o,p){return(ServerMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ServerMovement_ServerMovement=function(Component){var protoProps;function ServerMovement(){var _this;return _this=Component.apply(this,arguments)||this,_this._inputDto=new InputDto_InputDto,_this}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ServerMovement_set_prototype_of(subClass,superClass)}(ServerMovement,Component),protoProps=[{key:"inputDto",get:function(){return this._inputDto},set:function(inputDto){this._inputDto=inputDto}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ServerMovement.prototype,protoProps),ServerMovement}(Component);function ServerMovement_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ecs_system_ServerMovement_set_prototype_of(o,p){return(ecs_system_ServerMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var ecs_system_ServerMovement_ServerMovement=function(System){function ServerMovement(){var _this;return _this=System.apply(this,arguments)||this,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&ecs_system_ServerMovement_set_prototype_of(subClass,superClass)}(ServerMovement,System);var _proto=ServerMovement.prototype;return _proto.startEntity=function(entity){var keyActions=this.initializeKeyActions(entity),serverMovement=entity.getComponentStrict(ServerMovement_ServerMovement);this._cache.set(entity.id,{serverMovement:serverMovement,keyActions:keyActions})},_proto.initializeKeyActions=function(entity){var _obj,transform=entity.getComponentStrict(Transform_Transform),rigidBody=entity.getComponentStrict(RigidBody_RigidBody);return(_obj={})[dto_Direction_Direction.Up]=function(deltaTime){transform.position.y-=Math.round(rigidBody.moveStep*deltaTime)},_obj[dto_Direction_Direction.Down]=function(deltaTime){transform.position.y+=Math.round(rigidBody.moveStep*deltaTime)},_obj[dto_Direction_Direction.Left]=function(deltaTime){transform.position.x-=Math.round(rigidBody.moveStep*deltaTime)},_obj[dto_Direction_Direction.Right]=function(deltaTime){transform.position.x+=Math.round(rigidBody.moveStep*deltaTime)},_obj[dto_Direction_Direction.None]=function(_deltaTime){},_obj},_proto.updateEntity=function(entity,deltaTime){var cache=this._cache.get(entity.id);if(cache){var keyActions=cache.keyActions,inputDto=cache.serverMovement.inputDto;if(inputDto&&inputDto.direction)for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return ServerMovement_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ServerMovement_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(inputDto.direction);!(_step=_iterator()).done;){var direction=_step.value;Object.prototype.hasOwnProperty.call(keyActions,direction)&&keyActions[direction](deltaTime)}}},ServerMovement}(System),serverMovementFactory_versions=new Map([["1.0.0",function(engine,_sysData){return new ecs_system_ServerMovement_ServerMovement(engine.entityCache)}]]);function getServerMovement(engine,sysData){return getSystem(engine,sysData,serverMovementFactory_versions)}function getServerMovementValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("serverMovement")(entities,logger,config)&&isEnvironmentOn({server:!0,singlePlayer:!1,desktop:!1,mobile:!1,client:!1})(entities,logger,config)}}function SpriteFlip_set_prototype_of(o,p){return(SpriteFlip_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteFlip=function(System){function SpriteFlip(entityCache,_eventSystem){var _this;return(_this=System.call(this,entityCache)||this)._eventSystem=_eventSystem,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteFlip_set_prototype_of(subClass,superClass)}(SpriteFlip,System);var _proto=SpriteFlip.prototype;return _proto.startEntity=function(entity){var _this=this,sprite=entity.getComponentStrict(Sprite);sprite.id=entity.id,"player1"===entity.id&&(this._eventSystem.subscribe(""+entity.id+"_left",function(data){return _this.onLeftPlayer1(data.id,sprite)}),this._eventSystem.subscribe(""+entity.id+"_right",function(data){return _this.onRightPlayer1(data.id,sprite)})),"player2"===entity.id&&(this._eventSystem.subscribe(""+entity.id+"_left",function(data){return _this.onLeftPlayer2(data.id,sprite)}),this._eventSystem.subscribe(""+entity.id+"_right",function(data){return _this.onRightPlayer2(data.id,sprite)}))},_proto.onLeftPlayer1=function(_id,sprite){sprite.isFlipped=!0},_proto.onRightPlayer1=function(_id,sprite){sprite.isFlipped=!1},_proto.onLeftPlayer2=function(_id,sprite){sprite.isFlipped=!1},_proto.onRightPlayer2=function(_id,sprite){sprite.isFlipped=!0},SpriteFlip}(System),spriteFlipFactory_versions=new Map([["1.0.0",function(engine,sysData){return new SpriteFlip(engine.entityCache,engine.eventSystem)}]]);function getSpriteFlip(engine,sysData){return getSystem(engine,sysData,spriteFlipFactory_versions)}function getSpriteFlipValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("spriteFlip")(entities,logger,config)&&entityWithSubstringExists("player")(entities,logger)}}function SpriteState_set_prototype_of(o,p){return(SpriteState_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SpriteState=function(System){function SpriteState(entityCache,eventSystem){var _this;return(_this=System.call(this,entityCache)||this).eventSystem=eventSystem,_this._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SpriteState_set_prototype_of(subClass,superClass)}(SpriteState,System);var _proto=SpriteState.prototype;return _proto.startEntity=function(entity){var sprite=entity.getComponentStrict(Sprite);this._cache.set(entity.id,sprite),sprite.state=new IdleState(this.eventSystem),sprite.state.enter(entity),this.eventSystem.subscribe(EventNames.ChangeState+entity.id,this.handleChangeState.bind(this,entity))},_proto.handleChangeState=function(entity,data){this.changeState(entity,data)},_proto.changeState=function(entity,data){var left,right,id=data.id,newState=data.newState,force=data.force,sprite=this._cache.get(id);return!!sprite&&entity.id===id&&!(!force&&(left=sprite.state,null!=(right=newState.constructor)&&"undefined"!=typeof Symbol&&right[Symbol.hasInstance]?right[Symbol.hasInstance](left):left instanceof right))&&(sprite.state.exit(entity),sprite.state=newState,sprite.state.enter(entity),!0)},SpriteState}(System),spriteStateFactory_versions=new Map([["1.0.0",function(engine,sysData){return new SpriteState(engine.entityCache,engine.eventSystem)}]]);function getSpriteState(engine,sysData){return getSystem(engine,sysData,spriteStateFactory_versions)}function getSpriteStateValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("spriteState")(entities,logger,config)&&entityWithSubstringExists("player")(entities,logger)}}function StepMovement_set_prototype_of(o,p){return(StepMovement_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var StepMovement=function(Movement){function StepMovement(entityCache,input,eventSystem){var _this;return(_this=Movement.call(this,entityCache,input,eventSystem)||this)._cache=new Map,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&StepMovement_set_prototype_of(subClass,superClass)}(StepMovement,Movement);var _proto=StepMovement.prototype;return _proto.startEntity=function(entity){Movement.prototype.startEntity.call(this,entity);var stepCache={transform:entity.getComponentStrict(Transform_Transform),rigidBody:entity.getComponentStrict(RigidBody_RigidBody)};this._cache.set(entity.id,stepCache)},_proto.OnLeft=function(id){var _this__cache_get,_ref=null!=(_this__cache_get=this._cache.get(id))?_this__cache_get:{},transform=_ref.transform,rigidBody=_ref.rigidBody;transform&&rigidBody&&this.move(transform,-rigidBody.moveStep,0)},_proto.OnRight=function(id){var _this__cache_get,_ref=null!=(_this__cache_get=this._cache.get(id))?_this__cache_get:{},transform=_ref.transform,rigidBody=_ref.rigidBody;transform&&rigidBody&&this.move(transform,rigidBody.moveStep,0)},_proto.OnUp=function(id){var _this__cache_get,_ref=null!=(_this__cache_get=this._cache.get(id))?_this__cache_get:{},transform=_ref.transform,rigidBody=_ref.rigidBody;transform&&rigidBody&&this.move(transform,0,-rigidBody.moveStep)},_proto.OnDown=function(id){var _this__cache_get,_ref=null!=(_this__cache_get=this._cache.get(id))?_this__cache_get:{},transform=_ref.transform,rigidBody=_ref.rigidBody;transform&&rigidBody&&this.move(transform,0,rigidBody.moveStep)},_proto.move=function(transform,deltaX,deltaY){transform.position.x+=deltaX,transform.position.y+=deltaY},_proto.handleKeyDown=function(_key,id,_rigidBody,keyActions){this.handleKey(keyActions,id)},_proto.handleKey=function(keyActions,id){this._pressedKey.forEach(function(key){var action=keyActions[key];action&&action(id)})},_proto.handleKeyUp=function(_key,id,_rigidBody,keyActions){this.handleKey(keyActions,id)},StepMovement}(Movement),stepMovementFactory_versions=new Map([["1.0.0",function(engine,_sysData){var entityCache=engine.entityCache,input=engine.input,eventSystem=engine.eventSystem,logger=engine.logger;return input||logger.warn("InputManager requiered for BallMovement."),new StepMovement(entityCache,input,eventSystem)}]]);function getStepMovement(engine,sysData){return getSystem(engine,sysData,stepMovementFactory_versions)}function getStepMovementValidator(){return function(entities,logger,config){return validationFunction_isSystemOn("stepMovement")(entities,logger,config)&&entityWithComponentsExist([Transform_Transform,RigidBody_RigidBody])(entities,logger)}}var engineSystemMap={};function createEngineSystemMap(){engineSystemMap.ballDribble=getBallDribble,engineSystemMap.ballFieldCollision=getBallFieldCollision,engineSystemMap.ballGateCollision=getBallGateCollision,engineSystemMap.ballMovement=getBallMovement,engineSystemMap.boxColliderRenderer=getBoxColliderRenderer,engineSystemMap.boxFlip=getBoxFlip,engineSystemMap.canvasScaler=getCanvasScaler,engineSystemMap.clientMovement=getClientMovement,engineSystemMap.collisionBoxRenderer=getCollisionBoxRenderer,engineSystemMap.collisionBoxRenderer_layer2=getCollisionBoxRenderer,engineSystemMap.contentScalerTester=getContentScalerTester,engineSystemMap.debugRenderer=getDebugRenderer,engineSystemMap.drawDirection=getDrawDirection,engineSystemMap.entityScaler=getEntityScaler,engineSystemMap.gameScore=getGameScore,engineSystemMap.gameState=getGameState,engineSystemMap.insideBoxCollision=getInsideBoxCollision,engineSystemMap.keyboardMapping=getKeyboardMapping,engineSystemMap.kinematics=getKinematics,engineSystemMap.limitMove=getLimitMove,engineSystemMap.markers=getMarkersRenderer,engineSystemMap.mouseInput=getMouseInput,engineSystemMap.playerBallCollision=getPlayerBallCollision,engineSystemMap.playerKick=getPlayerKick,engineSystemMap.playerMovement=getPlayerMovement,engineSystemMap.playerStateRenderer=getPlayerStateRenderer,engineSystemMap.sceneRenderer=getSceneRenderer,engineSystemMap.sceneRenderer_layer2=getSceneRenderer,engineSystemMap.sceneRenderer_layer3=getSceneRenderer,engineSystemMap.scoreRenderer=getScoreRenderer,engineSystemMap.serverMovement=getServerMovement,engineSystemMap.spriteFlip=getSpriteFlip,engineSystemMap.spriteRenderer=getSpriteRenderer,engineSystemMap.spriteRenderer_layer2=getSpriteRenderer,engineSystemMap.spriteRenderer_layer3=getSpriteRenderer,engineSystemMap.spriteRenderer_layer4=getSpriteRenderer,engineSystemMap.spriteState=getSpriteState,engineSystemMap.stepMovement=getStepMovement}var FootballClientConfigurator=function(){function FootballClientConfigurator(){}var protoProps,_proto=FootballClientConfigurator.prototype;return _proto.getConfiguration=function(){return FootballClientConfigurator.getConfigurationSingleton()},_proto.getLogger=function(){return FootballClientConfigurator.getLoggerSingleton(this.getBit("logger"))},_proto.getJsonLoader=function(){return FootballClientConfigurator.getJsonLoaderSingleton()},_proto.getGameLoop=function(){return FootballClientConfigurator.getGameLoopSingleton()},_proto.getSystemMap=function(){return[createEngineSystemMap]},_proto.getBit=function(id){var _this__config_engineDependency_find,_this__config_engineDependency_find_isOn;return null!=(_this__config_engineDependency_find_isOn=null==(_this__config_engineDependency_find=this._config.engineDependency.find(function(c){return c.id===id}))?void 0:_this__config_engineDependency_find.isOn)&&_this__config_engineDependency_find_isOn},FootballClientConfigurator.getInstance=function(){return FootballClientConfigurator._instance||(FootballClientConfigurator._instance=new FootballClientConfigurator),FootballClientConfigurator._instance},protoProps=[{key:"config",set:function(config){this._config=config}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(FootballClientConfigurator.prototype,protoProps),FootballClientConfigurator}();FootballClientConfigurator.getConfigurationSingleton=createSingleton(function(){return new Configuration}),FootballClientConfigurator.getGameLoopSingleton=createSingleton(function(){return new ClientGameLoop}),FootballClientConfigurator.getJsonLoaderSingleton=createSingleton(function(){return new JsonLoader}),FootballClientConfigurator.getLoggerSingleton=createSingleton(function(flag){return flag?LoggerSingleton.getLogger():new LoggerEmpty});var GameLoop=function(){function GameLoop(){var _this=this;this.animationFrameId=null,this.lastFrameTime=0,this.updateCallbacks=[],this.renderCallbacks=[],this.paused=!1,this.loop=function(){if(!_this.paused){var currentTime=performance.now();_this.lastFrameTime||(_this.lastFrameTime=currentTime);var deltaTime=(currentTime-_this.lastFrameTime)/1e3;_this.updateCallbacks.forEach(function(callback){return callback(deltaTime)}),_this.renderCallbacks.forEach(function(callback){return callback(deltaTime)}),_this.lastFrameTime=currentTime,_this.animationFrameId=requestAnimationFrame(_this.loop)}}}var _proto=GameLoop.prototype;return _proto.start=function(){this.paused=!1,this.loop()},_proto.stop=function(){null!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)},_proto.pause=function(){this.paused=!0},_proto.resume=function(){this.paused=!1,this.loop()},_proto.subscribeUpdate=function(callback){this.updateCallbacks.push(callback)},_proto.unsubscribeUpdate=function(callback){this.updateCallbacks=this.updateCallbacks.filter(function(cb){return cb!==callback})},_proto.subscribeRender=function(callback){this.renderCallbacks.push(callback)},_proto.unsubscribeRender=function(callback){this.renderCallbacks=this.renderCallbacks.filter(function(cb){return cb!==callback})},GameLoop}(),FootballConfigurator=function(){function FootballConfigurator(){}var protoProps,_proto=FootballConfigurator.prototype;return _proto.getConfiguration=function(){return FootballConfigurator.getConfigurationSingleton()},_proto.getLogger=function(){return FootballConfigurator.getLoggerSingleton(this.getBit("logger"))},_proto.getJsonLoader=function(){return FootballConfigurator.getJsonLoaderSingleton()},_proto.getGameLoop=function(){return FootballConfigurator.getGameLoopSingleton()},_proto.getSystemMap=function(){return[createEngineSystemMap]},_proto.getBit=function(id){var _this__config_engineDependency_find,_this__config_engineDependency_find_isOn;return null!=(_this__config_engineDependency_find_isOn=null==(_this__config_engineDependency_find=this._config.engineDependency.find(function(c){return c.id===id}))?void 0:_this__config_engineDependency_find.isOn)&&_this__config_engineDependency_find_isOn},FootballConfigurator.getInstance=function(){return FootballConfigurator._instance||(FootballConfigurator._instance=new FootballConfigurator),FootballConfigurator._instance},protoProps=[{key:"config",set:function(config){this._config=config}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(FootballConfigurator.prototype,protoProps),FootballConfigurator}();FootballConfigurator._instance=null,FootballConfigurator.getConfigurationSingleton=createSingleton(function(){return new Configuration}),FootballConfigurator.getGameLoopSingleton=createSingleton(function(){return new GameLoop}),FootballConfigurator.getJsonLoaderSingleton=createSingleton(function(){return new JsonLoader}),FootballConfigurator.getLoggerSingleton=createSingleton(function(flag){return flag?LoggerSingleton.getLogger():new LoggerEmpty});var UIBuilder=function(){function UIBuilder(containerId,_textBuilder,_buttonBuilder,_comboBoxBuilder){this._textBuilder=_textBuilder,this._buttonBuilder=_buttonBuilder,this._comboBoxBuilder=_comboBoxBuilder,this._container=this.getContainer(containerId)}var _proto=UIBuilder.prototype;return _proto.getContainer=function(containerId){var container=document.getElementById(containerId);if(!container)throw Error("No container found with id: "+containerId);return container},_proto.clearUI=function(){this._container.innerHTML=""},_proto.getLabelAndComboBox=function(data){var label=data.label,options=data.options,onChange=data.onChange,textElement=this.text.createTextElement(label);textElement.addToContainer(this.container);var comboBoxElement=this.comboBox.createComboBox(options,onChange);return comboBoxElement.addToContainer(this.container),[textElement,comboBoxElement]},_proto.getLabelAndButton=function(data){var label=data.label,btnLabel=data.btnLabel,onClick=data.onClick,textElement=this.text.createTextElement(label);textElement.addToContainer(this.container);var buttonElement=this.button.createButton(btnLabel,onClick);return buttonElement.addToContainer(this.container),[textElement,buttonElement]},_proto.getButton=function(data){var btnLabel=data.btnLabel,onClick=data.onClick;this.button.createButton(btnLabel,onClick).addToContainer(this.container)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(UIBuilder.prototype,[{key:"container",get:function(){return this._container}},{key:"text",get:function(){return this._textBuilder}},{key:"button",get:function(){return this._buttonBuilder}},{key:"comboBox",get:function(){return this._comboBoxBuilder}}]),UIBuilder}(),StringHelper=function(){function StringHelper(){}return StringHelper.isDigit=function(char){return char>="0"&&char<="9"},StringHelper.removeNumbersFromEnd=function(inputString){for(var lastNonDigitIndex=inputString.length-1;lastNonDigitIndex>=0&&StringHelper.isDigit(inputString[lastNonDigitIndex]);)lastNonDigitIndex--;return inputString.substring(0,lastNonDigitIndex+1)},StringHelper.lowerFirstLetter=function(s){return 0===s.length?s:s.charAt(0).toLowerCase()+s.slice(1)},StringHelper}();function EntitySaver_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var EntitySaver=function(){function EntitySaver(entityCache){this.entityCache=entityCache}var _proto=EntitySaver.prototype;return _proto.saveLevel=function(fileName){var blob=new Blob([JSON.stringify(this.saveEntities(),null,2)],{type:"application/json"}),url=URL.createObjectURL(blob),link=document.createElement("a");link.href=url,link.download=fileName+".json",document.body.appendChild(link),link.click(),URL.revokeObjectURL(url)},_proto.saveEntities=function(){var _this=this,entitiesJSON={};return this.entityCache.forEach(function(key,entity){var entityData={};entityData.id=entity.id,entityData.name=entity.name;for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return EntitySaver_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EntitySaver_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(entity.getAllComponents());!(_step=_iterator()).done;){var _step_value=_step.value,componentClass=_step_value[0],componentArray=_step_value[1],componentName=StringHelper.lowerFirstLetter(componentClass.name),serializedComponent=void 0;serializedComponent=1!==componentArray.length||entity.id.includes("player")&&"boxCollider"===componentName?componentArray.map(function(component){return _this.serializeComponent(component)}):_this.serializeComponent(componentArray[0]),entityData[componentName]=serializedComponent}entitiesJSON[key]=entityData}),entitiesJSON},_proto.serializeComponent=function(component){return component.toJSON()},EntitySaver}(),Style=function(){function Style(){}return Style.removeStyle=function(elementId,className){var element=document.getElementById(elementId);element&&element.classList.remove(className)},Style.addStyle=function(elementId,className){var element=document.getElementById(elementId);element&&element.classList.add(className)},Style}(),Overlay=function(){function Overlay(showButtonId,overlayId,closeButtonId){var _this=this;this.showButton=document.getElementById(showButtonId),this.overlay=document.getElementById(overlayId),this.closeButton=document.getElementById(closeButtonId),this.showButton.addEventListener("mouseover",function(){_this.show()}),this.closeButton.addEventListener("click",function(){_this.hide()})}var _proto=Overlay.prototype;return _proto.show=function(){this.overlay.style.display="block"},_proto.hide=function(){this.overlay.style.display="none"},Overlay}(),TextBuilder=function(){function TextBuilder(){}var _proto=TextBuilder.prototype;return _proto.createTextElement=function(text){var textElement=document.createElement("p");return textElement.innerText=text,textElement.classList.add("menu-label"),{element:textElement,addToContainer:function(container){container.appendChild(textElement)},removeFromContainer:function(container){container.removeChild(textElement)}}},_proto.updateTextElement=function(index,text){var textElements=document.querySelectorAll("p");textElements[index]&&(textElements[index].innerText=text)},TextBuilder}(),ButtonBuilder=function(){function ButtonBuilder(){}var _proto=ButtonBuilder.prototype;return _proto.createButton=function(text,onClick){var button=document.createElement("button");return button.innerText=text,button.addEventListener("click",onClick),button.classList.add("menu-btn"),{element:button,addToContainer:function(container){container.appendChild(button)},removeFromContainer:function(container){container.removeChild(button)}}},_proto.updateButtonText=function(index,text){var buttonElements=document.querySelectorAll("button");buttonElements[index]&&(buttonElements[index].innerText=text)},ButtonBuilder}(),ComboBoxBuilder=function(){function ComboBoxBuilder(){}var _proto=ComboBoxBuilder.prototype;return _proto.createComboBox=function(options,onChange){var selectElement=document.createElement("select");return selectElement.classList.add("menu-select"),options.forEach(function(option){var optionElement=document.createElement("option");optionElement.value=option,optionElement.innerText=option,selectElement.appendChild(optionElement)}),selectElement.addEventListener("change",function(event){onChange(selectElement.value,event)}),{element:selectElement,addToContainer:function(container){container.appendChild(selectElement)},removeFromContainer:function(container){container.removeChild(selectElement)}}},_proto.updateComboBoxOptions=function(index,options){var selectElements=document.querySelectorAll("select");if(selectElements[index]){var selectElement=selectElements[index];selectElement.innerHTML="",options.forEach(function(option){var optionElement=document.createElement("option");optionElement.value=option,optionElement.innerText=option,selectElement.appendChild(optionElement)})}},_proto.updateComboBoxSelection=function(index,selected){var selectElements=document.querySelectorAll("select");selectElements[index]&&(selectElements[index].value=selected)},ComboBoxBuilder}(),LevelHelper=function(){function LevelHelper(){}return LevelHelper.getSystemPath=function(config){var format=config.format,systemFileName=config.systemFileName,_config_select=config.select;return _config_select.folder+"/"+_config_select.subFolder+"/"+_config_select.scene+"/"+systemFileName+"."+format},LevelHelper.getScenePath=function(config){var format=config.format,entityFileName=config.entityFileName,_config_select=config.select;return _config_select.folder+"/"+_config_select.subFolder+"/"+_config_select.scene+"/"+entityFileName+"."+format},LevelHelper}(),EditorMenu=function(){function EditorMenu(uiBuilder,entitySaver,engine){this.uiBuilder=uiBuilder,this.entitySaver=entitySaver,this.engine=engine,this.config=this.engine.config,this.createMenu()}var _proto=EditorMenu.prototype;return _proto.createMenu=function(){this.createSaveSceneBtn(),this.createFolderComboBox(),this.subFolder=this.createSubFolderComboBox(),this.scene=this.createSceneComboBox(),this.load=this.createLoadSceneBtn()},_proto.createSaveSceneBtn=function(){var _this=this;this.uiBuilder.getLabelAndButton({label:"Save Current Scene",btnLabel:"Save",onClick:function(){_this.entitySaver.saveLevel(_this.config.data.saveFileName)}})},_proto.createFolderComboBox=function(){var _this=this,folders=this.config.data.selector.folder.list;this.uiBuilder.getLabelAndComboBox({label:"Select Folder",options:[].concat(["None"],folders),onChange:function(selected,_event){_this.config.data.select.folder=selected,_this.engine.configManager.update(_this.config),_this.load.forEach(function(e){return e.removeFromContainer(_this.uiBuilder.container)}),_this.subFolder.forEach(function(e){return e.removeFromContainer(_this.uiBuilder.container)}),_this.scene.forEach(function(e){return e.removeFromContainer(_this.uiBuilder.container)}),_this.subFolder=_this.createSubFolderComboBox(),_this.scene=_this.createSceneComboBox(),_this.load=_this.createLoadSceneBtn()}})},_proto.createSubFolderComboBox=function(){var _this=this,folder=this.config.data.select.folder,folders=this.config.data.selector.subFolder.find(function(f){return f.folder===folder});return this.uiBuilder.getLabelAndComboBox({label:"Select SubFolder",options:void 0===folders?["None"]:[].concat(["None"],folders.list),onChange:function(selected,_event){_this.config.data.select.subFolder=selected,_this.engine.configManager.update(_this.config),_this.load.forEach(function(e){return e.removeFromContainer(_this.uiBuilder.container)}),_this.scene.forEach(function(e){return e.removeFromContainer(_this.uiBuilder.container)}),_this.scene=_this.createSceneComboBox(),_this.load=_this.createLoadSceneBtn()}})},_proto.createSceneComboBox=function(){var _this=this,_this_config_data_select=this.config.data.select,path=_this_config_data_select.folder+"/"+_this_config_data_select.subFolder,scenes=this.config.data.selector.scene.find(function(s){return s.folder===path});return this.uiBuilder.getLabelAndComboBox({label:"Select Scene",options:void 0===scenes?["None"]:[].concat(["None"],scenes.list),onChange:function(selected,_event){_this.config.data.select.scene=selected,_this.engine.configManager.update(_this.config)}})},_proto.createLoadSceneBtn=function(){var _this=this;return this.uiBuilder.getLabelAndButton({label:"",btnLabel:"Load Scene",onClick:function(){_this.engine.clear(),_this.engine.loadEntityData(LevelHelper.getScenePath(_this.config.data))}})},EditorMenu.build=function(engine){var config=engine.config,logger=engine.logger,entityCache=engine.entityCache;return EngineConfig.getGameDependencyBit(config,"editor_menu")?(logger.log("Editor menu is on"),Style.removeStyle("overlay","remove"),Style.removeStyle("showOverlayBtn","remove"),new Overlay("showOverlayBtn","overlay","closeOverlayBtn"),new EditorMenu(new UIBuilder("editor-menu-container",new TextBuilder,new ButtonBuilder,new ComboBoxBuilder),new EntitySaver(entityCache),engine),!0):(logger.log("Editor menu is off"),!1)},EditorMenu}(),InitializationChecker=function(){function InitializationChecker(){}var _proto=InitializationChecker.prototype;return _proto.assertData=function(){if(!this._predicates||!this._errorTable)throw Error("Please set predicates and errorTable in InitializationChecker")},_proto.assertInitialized=function(methodName){if(this.assertData(),!this._predicates[methodName]())throw console.error("Error in method "+methodName+": "+this._errorTable[methodName]),Error(this._errorTable[methodName])},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(InitializationChecker.prototype,[{key:"predicates",set:function(predicates){this._predicates=predicates}},{key:"errorTable",set:function(errorTable){this._errorTable=errorTable}}]),InitializationChecker}(),TileMap=function(){function TileMap(){this.map=[],this.tiles=[],this._tilePositions=[],this._zeroTile={id:0,size:new Vector2(0,0),rgba:"rgba(0, 0, 0, 0)",desc:"default zero tile"}}var _proto=TileMap.prototype;return _proto.load=function(mapFactory){var _this=this;if(this.map=mapFactory.createMap(),this.tiles=mapFactory.createTiles(),this._tilePositions=this.map.map(function(row,y){return row.map(function(_,x){return new Vector2(x*_this.tiles[0].size.x,y*_this.tiles[0].size.y)})}),!this._renderer)throw Error("renderer must be set in TileMap !")},_proto.render=function(dt){for(var y=0;y<this.map.length;y++)for(var x=0;x<this.map[y].length;x++){var tileId=this.map[y][x],tile=this.getTileById(tileId),position=this._tilePositions[y][x];tile&&this.renderTile(tile,position)}},_proto.getTileById=function(id){return this.tiles.find(function(tile){return tile.id===id})||this._zeroTile},_proto.renderTile=function(tile,position){this._renderer.drawRect(position,tile.size,tile.rgba)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(TileMap.prototype,[{key:"renderer",set:function(renderer){this._renderer=renderer}}]),TileMap}();function EntityDataCache_set_prototype_of(o,p){return(EntityDataCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var EntityDataCache=function(ResourceCache){function EntityDataCache(){return ResourceCache.apply(this,arguments)}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&EntityDataCache_set_prototype_of(subClass,superClass)}(EntityDataCache,ResourceCache),EntityDataCache}(ResourceCache);function RendererCache_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function RendererCache_set_prototype_of(o,p){return(RendererCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function RendererCache_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return RendererCache_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return RendererCache_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var RendererCache=function(ResourceCache){function RendererCache(){return ResourceCache.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&RendererCache_set_prototype_of(subClass,superClass)}(RendererCache,ResourceCache);var _proto=RendererCache.prototype;return _proto.start=function(){for(var _step,_iterator=RendererCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.start()},_proto.update=function(deltaTime){for(var _step,_iterator=RendererCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.update(deltaTime)},_proto.render=function(deltaTime){for(var _step,_iterator=RendererCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.render(deltaTime)},RendererCache}(ResourceCache);function RendererCacheEmpty_set_prototype_of(o,p){return(RendererCacheEmpty_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var RendererCacheEmpty=function(ResourceCacheEmpty){function RendererCacheEmpty(){return ResourceCacheEmpty.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&RendererCacheEmpty_set_prototype_of(subClass,superClass)}(RendererCacheEmpty,ResourceCacheEmpty);var _proto=RendererCacheEmpty.prototype;return _proto.start=function(){},_proto.update=function(deltaTime){},_proto.render=function(deltaTime){},RendererCacheEmpty}(function(){function ResourceCacheEmpty(){}var _proto=ResourceCacheEmpty.prototype;return _proto.add=function(name,object){},_proto.remove=function(name){},_proto.removeAll=function(){},_proto.get=function(name){},_proto.getStrict=function(name){return{}},_proto.getWithStatus=function(name){return{found:!1,object:void 0}},_proto.forEach=function(callback){},_proto.getRegistered=function(entityIds){return[]},_proto.getKeys=function(){return[]},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ResourceCacheEmpty.prototype,[{key:"count",get:function(){return 0}}]),ResourceCacheEmpty}());function SystemCache_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SystemCache_set_prototype_of(o,p){return(SystemCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function SystemCache_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SystemCache_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SystemCache_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var SystemCache=function(ResourceCache){function SystemCache(){return ResourceCache.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SystemCache_set_prototype_of(subClass,superClass)}(SystemCache,ResourceCache);var _proto=SystemCache.prototype;return _proto.start=function(){for(var _step,_iterator=SystemCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.start()},_proto.update=function(deltaTime){for(var _step,_iterator=SystemCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.update(deltaTime)},_proto.render=function(deltaTime){for(var _step,_iterator=SystemCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.render(deltaTime)},SystemCache}(ResourceCache);function SumSystemCache_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SumSystemCache_set_prototype_of(o,p){return(SumSystemCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function SumSystemCache_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SumSystemCache_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SumSystemCache_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var SumSystemCache=function(ResourceCache){function SumSystemCache(){return ResourceCache.apply(this,arguments)}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SumSystemCache_set_prototype_of(subClass,superClass)}(SumSystemCache,ResourceCache);var _proto=SumSystemCache.prototype;return _proto.start=function(){for(var _step,_iterator=SumSystemCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.start()},_proto.render=function(deltaTime){for(var _step,_iterator=SumSystemCache_create_for_of_iterator_helper_loose(this.values());!(_step=_iterator()).done;)_step.value.render(deltaTime)},SumSystemCache}(ResourceCache);function Entity_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Entity_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return Entity_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Entity_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Entity=function(){function Entity(){this._components=new Map}var _proto=Entity.prototype;return _proto.addComponent=function(component){this.addComponentToEntity(component)},_proto.addComponents=function(components){for(var _step,_iterator=Entity_create_for_of_iterator_helper_loose(components);!(_step=_iterator()).done;){var component=_step.value;this.addComponentToEntity(component)}},_proto.addComponentToEntity=function(component){var componentType=component.constructor;this._components.has(componentType)?this._components.get(componentType).push(component):this._components.set(componentType,[component])},_proto.getComponentStrict=function(componentType,id){var components=this._components.get(componentType),errorMessage=function(id){return id?"Component of type "+componentType.name+" and id "+id+" not found.":"No components of type "+componentType.name+" found."};if(components){if(id){var component=components.find(function(item){return item.id===id});if(component)return component;throw Error(errorMessage(id))}var firstComponent=components[0];if(firstComponent)return firstComponent}throw Error(errorMessage())},_proto.getComponent=function(componentType,id){var components=this._components.get(componentType);if(components)return id?components.find(function(item){return item.id===id}):components[0]},_proto.getComponents=function(componentType){return this._components.get(componentType)},_proto.getAllComponents=function(){return this._components},_proto.toJSON=function(){for(var _step,serializedEntity={id:this._id,name:this._name,builder:this._builder,components:{}},_iterator=Entity_create_for_of_iterator_helper_loose(this._components.entries());!(_step=_iterator()).done;){var _step_value=_step.value,componentType=_step_value[0],components=_step_value[1],componentName=componentType.name;serializedEntity.components[componentName]=components.map(function(component){return component.toJSON()})}return serializedEntity},_proto.update=function(deltaTime){for(var _step,_iterator=Entity_create_for_of_iterator_helper_loose(this._components.values());!(_step=_iterator()).done;)for(var _step1,componentArrays=_step.value,_iterator1=Entity_create_for_of_iterator_helper_loose(componentArrays);!(_step1=_iterator1()).done;)_step1.value.update(deltaTime)},_proto.render=function(deltaTime){for(var _step,_iterator=Entity_create_for_of_iterator_helper_loose(this._components.values());!(_step=_iterator()).done;)for(var _step1,componentArrays=_step.value,_iterator1=Entity_create_for_of_iterator_helper_loose(componentArrays);!(_step1=_iterator1()).done;)_step1.value.render(deltaTime)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Entity.prototype,[{key:"id",get:function(){return this._id},set:function(id){this._id=id}},{key:"clientId",get:function(){return this._clientId},set:function(clientId){this._clientId=clientId}},{key:"role",get:function(){return this._role},set:function(role){this._role=role}},{key:"name",get:function(){return this._name},set:function(name){this._name=name}},{key:"builder",get:function(){return this._builder},set:function(builder){this._builder=builder}}]),Entity}(),EntityComponentCreator=function(){function EntityComponentCreator(_componentMapper){this._componentMapper=_componentMapper}var _proto=EntityComponentCreator.prototype;return _proto.createEntity=function(data){var entityCache=new ResourceCache;return this.createEntities(data,entityCache),entityCache},_proto.loadEntity=function(data,entityCache){this.createEntities(data,entityCache)},_proto.createEntities=function(data,entityCache){for(var key in data){var entityProps=["id","name","builderKey"],fileMetaDataProps=["fileName","fileDescription","fileUsage"],entity=new Entity;entity.id=key,entity.name=data[key].name,entityCache.add(key,entity),this.createEntityComponents(data[key],entity,[].concat(entityProps,fileMetaDataProps))}},_proto.createEntityComponents=function(data,entity,excludedProps){for(var key in data)if(!excludedProps.includes(key)){var componentType=componentList_componentList[key];if(!componentType){console.warn("Unsupported component type: "+key),console.log(componentList_componentList);continue}var component=this._componentMapper.mappers[componentType](data[key]);component?this.addComponent(entity,component):(console.warn("Unsupported mapper for component type: "+key),console.log(this._componentMapper.mappers))}},_proto.addComponent=function(entity,component){Array.isArray(component)?entity.addComponents(component):entity.addComponent(component)},EntityComponentCreator}(),Camera=function(){function Camera(){this._center0=new Vector2,this._center=new Vector2,this._delta=new Vector2}var _proto=Camera.prototype;return _proto.load=function(tileMap){if(this._tileMap=tileMap,!this._tileMap)throw Error("tile map must be set in Camera !");if(!this._renderer)throw Error("renderer must be set in Camera !");this._center0=this._renderer.getCenter()},_proto.setPosition=function(position){var _this__tileMap_mapOffset_x,_this__tileMap_mapOffset_y;this._center.x=this._center0.x,this._center.y=this._center0.y,this._delta=this._center.subtract(position).add(new Vector2(null!=(_this__tileMap_mapOffset_x=this._tileMap.mapOffset.x)?_this__tileMap_mapOffset_x:0,null!=(_this__tileMap_mapOffset_y=this._tileMap.mapOffset.y)?_this__tileMap_mapOffset_y:0)),this._renderer.translate(this._delta)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Camera.prototype,[{key:"renderer",set:function(renderer){this._renderer=renderer}}]),Camera}(),EventSystem=function(){function EventSystem(){this.events={}}var _proto=EventSystem.prototype;return _proto.subscribe=function(eventName,handler){this.events[eventName]||(this.events[eventName]=[]),this.events[eventName].push(handler)},_proto.publish=function(eventName,data){var handlers=this.events[eventName];handlers&&handlers.forEach(function(handler){return handler(data)})},_proto.clear=function(){this.events={}},EventSystem}(),InputManager=function(){function InputManager(){this.inputCallbacks={},this.keyStates={}}var _proto=InputManager.prototype;return _proto.subscribeInputEvent=function(eventType,callback){this.inputCallbacks[eventType]||(this.inputCallbacks[eventType]=[]),this.inputCallbacks[eventType].push(callback)},_proto.unsubscribeInputEvent=function(eventType,callback){var callbacks=this.inputCallbacks[eventType];callbacks&&(this.inputCallbacks[eventType]=callbacks.filter(function(cb){return cb!==callback}))},_proto.unsubscribeAll=function(eventType){this.inputCallbacks[eventType]&&delete this.inputCallbacks[eventType]},_proto.handleKeyDown=function(key){this.keyStates[key]=!0,this.handleInputEvent("KeyDown",key)},_proto.handleKeyUp=function(key){this.keyStates[key]=!1,this.handleInputEvent("KeyUp",key)},_proto.isKeyDown=function(key){return this.keyStates[key]||!1},_proto.handleInputEvent=function(eventType,inputData){var callbacks=this.inputCallbacks[eventType];callbacks&&callbacks.forEach(function(callback){return callback(inputData)})},InputManager}(),InputManagerEmpty=function(){function InputManagerEmpty(){}var _proto=InputManagerEmpty.prototype;return _proto.subscribeInputEvent=function(eventType,callback){},_proto.unsubscribeInputEvent=function(eventType,callback){},_proto.unsubscribeAll=function(eventType){},_proto.handleKeyDown=function(key){},_proto.handleKeyUp=function(key){},_proto.isKeyDown=function(key){return!1},InputManagerEmpty}(),RendererEmpty=function(){function RendererEmpty(){}var _proto=RendererEmpty.prototype;return _proto.drawText=function(text,position,offset,color,font){},_proto.drawTextScaling=function(text,position,offset,scale,color,font){},_proto.drawTextTransform=function(text,position,offset,scale,color,font){},_proto.drawPointXY=function(x,y,options){},_proto.clearCanvas=function(){},_proto.drawRect=function(topLeft,size,color){},_proto.drawRectAroundPoint=function(center,size,color){},_proto.drawFrame=function(topLeft,size,color,lineWidth){},_proto.drawFrameAroundPoint=function(center,size,color,lineWidth){},_proto.translate=function(v){},_proto.resetTranslation=function(){},_proto.save=function(){},_proto.restore=function(){},_proto.getCenter=function(){return Vector2.zero},_proto.fillCanvas=function(color){},_proto.drawCollisionBox=function(transform,boxCollider,fill){},_proto.drawObject=function(transform,boxCollider,rigidBody,direction,fill){},_proto.drawPoint=function(point,options){},_proto.drawVector=function(start,end,color,scale,width){},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(RendererEmpty.prototype,[{key:"ctx",get:function(){return{}}}]),RendererEmpty}();function EntityData_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function EntityData_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){EntityData_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EntityData_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function EntityData_set_prototype_of(o,p){return(EntityData_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function EntityData_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var EntityData=function(EntityDataCache){function EntityData(_center){var _this;return(_this=EntityDataCache.call(this)||this)._center=_center,_this}!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&EntityData_set_prototype_of(subClass,superClass)}(EntityData,EntityDataCache);var _proto=EntityData.prototype;return _proto.loadData=function(data,fromCode,saveData){void 0===fromCode&&(fromCode=!1),void 0===saveData&&(saveData=!1);var _this=this;return EntityData_async_to_generator(function(){return EntityData_ts_generator(this,function(_state){switch(_state.label){case 0:if(fromCode)return[3,2];return[4,_this.loadFromJson(data)];case 1:return _state.sent(),[3,3];case 2:_this.loadFromCode(),_state.label=3;case 3:if(!saveData)return[2];return _this.downloadJson(),[2]}})})()},_proto.loadFromJson=function(data){var _this=this;return EntityData_async_to_generator(function(){return EntityData_ts_generator(this,function(_state){return Object.entries(data).forEach(function(param){var key=param[0],value=param[1];_this.add(key,value)}),[2]})})()},_proto.loadFromCode=function(){var config,_this=this;Object.entries({gameState:{id:"gameState",name:"gameState",builderKey:"gameState",gameState:{position:new Vector2((config={center:this._center,showColliders:!0}).center.x,340)}},field:{id:"field",name:"field",builderKey:"sprite",transform:{position:new Vector2(370,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(687,360),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"blue",enableRender:config.showColliders},sprite:{spriteOffset:new Vector2(-370,-180),isFlipped:!0,spriteAnimation:[{imagePath:"./assets/grass.png",frameCount:1,frameDuration:1,frameSize:{x:740,y:360},animationType:1}],state:"idle"}},leftGate:{id:"leftGate",name:"leftGate",builderKey:"gate",transform:{position:new Vector2(14,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(25,140),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},rigidBody:{velocity:new Vector2,mass:0,cor:0,speedMultiplier:0,maxSpeed:0,moveStep:0,useArrowKeys:!1,stopThreshold:0},sprite:{spriteOffset:new Vector2(-128,-83),isFlipped:!0,spriteAnimation:[{imagePath:"./assets/goalPost.png",frameCount:1,frameDuration:1,frameSize:{x:260,y:170},animationType:1}],state:"idle"},collisionObject:{objectIdToCollideWith:"ball"}},rightGate:{id:"rightGate",name:"rightGate",builderKey:"gate",transform:{position:new Vector2(726,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(25,140),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},rigidBody:{velocity:new Vector2,mass:0,cor:0,speedMultiplier:0,maxSpeed:0,moveStep:0,useArrowKeys:!1,stopThreshold:0},sprite:{spriteOffset:new Vector2(-128,-83),isFlipped:!1,spriteAnimation:[{imagePath:"./assets/goalPost.png",frameCount:1,frameDuration:1,frameSize:{x:260,y:170},animationType:1}],state:"idle"},collisionObject:{objectIdToCollideWith:"ball"}},player1:{id:"player1",name:"player1",builderKey:"player",transform:{position:new Vector2(270,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(40,110),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},limitMove:{limitSize:new Vector2(740,360),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},rigidBody:{velocity:new Vector2,mass:70,cor:0,speedMultiplier:0,maxSpeed:0,moveStep:100,useArrowKeys:!1,stopThreshold:0},sprite:{spriteOffset:new Vector2(-36,-75),isFlipped:!1,spriteAnimation:[{imagePath:"./assets/red-player.png",frameCount:20,frameDuration:.05,frameSize:{x:80,y:160},animationType:1},{imagePath:"./assets/red-player.png",frameCount:17,frameDuration:.05,frameSize:{x:80,y:160},animationType:1}],state:"idle"},collisionObject:{objectIdToCollideWith:"ball"}},player2:{id:"player2",name:"player2",builderKey:"player",transform:{position:new Vector2(470,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(40,110),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},limitMove:{limitSize:new Vector2(740,360),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},rigidBody:{velocity:new Vector2,mass:70,cor:0,speedMultiplier:0,maxSpeed:0,moveStep:100,useArrowKeys:!0,stopThreshold:0},sprite:{spriteOffset:new Vector2(-40,-75),isFlipped:!1,spriteAnimation:[{imagePath:"./assets/blue-player.png",frameCount:20,frameDuration:.05,frameSize:{x:80,y:160},animationType:1},{imagePath:"./assets/blue-player.png",frameCount:17,frameDuration:.05,frameSize:{x:80,y:160},animationType:1}],state:"idle"},collisionObject:{objectIdToCollideWith:"ball"}},ball:{id:"ball",name:"ball",builderKey:"ball",transform:{position:new Vector2(370,config.center.y),scale:new Vector2(1,1),rotation:0},boxCollider:{size:new Vector2(25,25),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"red",enableRender:config.showColliders},circleCollider:{radius:12.5,center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"yellow",enableRender:config.showColliders},insideBoxCollider:{size:new Vector2(740,360),center:new Vector2,isTrigger:!1,material:{dynamicFriction:.8,staticFriction:.2,bounciness:0},color:"pink",enableRender:config.showColliders},rigidBody:{velocity:new Vector2,mass:1,cor:.9,speedMultiplier:10,maxSpeed:100,moveStep:0,useArrowKeys:!1,stopThreshold:10},sprite:{spriteOffset:new Vector2(-35,-19),isFlipped:!1,spriteAnimation:[{imagePath:"./assets/ball.png",frameCount:20,frameDuration:100,frameSize:{x:80,y:40},animationType:1},{imagePath:"./assets/ball.png",frameCount:20,frameDuration:.05,frameSize:{x:80,y:40},animationType:1}],state:"idle"}}}).forEach(function(param){var key=param[0],value=param[1];_this.add(key,value)})},_proto.downloadJson=function(){var blob=new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download="entityData.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(url)},_proto.toJSON=function(){var data={};return this.forEach(function(entityId,entityData){data[entityId]=entityData}),data},EntityData}(EntityDataCache),GameData=function(){};function Engine_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Engine_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){Engine_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Engine_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Engine_instanceof(left,right){return null!=right&&"undefined"!=typeof Symbol&&right[Symbol.hasInstance]?!!right[Symbol.hasInstance](left):left instanceof right}function Engine_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var Engine=function(){function Engine(dependencies){var _this=this;this._player={},this._playerPosition={},this._isCameraOn=!1,this._isStarted=!1,this.render=function(deltaTime){_this._renderer.clearCanvas(),_this._renderer.fillCanvas("rgba(39, 147, 196, 1)"),_this._isCameraOn&&_this._playerPosition&&_this._camera.setPosition(_this._playerPosition),_this._rendererCache.render(deltaTime),_this._sumSystemCache.render(deltaTime),_this._entityCache.render(deltaTime),_this.systemCache.render(deltaTime),_this._isCameraOn&&_this._renderer.resetTranslation()},this.update=function(deltaTime){_this._systemCache.update(deltaTime),_this._entityCache.update(deltaTime),_this._rendererCache.update(deltaTime)};var config=dependencies.engineConfig,configManager=dependencies.engineConfiguration,logger=dependencies.logger,gameLoop=dependencies.gameLoop,renderer=dependencies.renderer,input=dependencies.input,entityDataCache=dependencies.entityDataCache,entityCache=dependencies.entityCache,camera=dependencies.camera,tileMap=dependencies.tileMap,eventSystem=dependencies.eventSystem,startSystemCache=dependencies.startSystemCache,systemCache=dependencies.systemCache,rendererCache=dependencies.rendererCache,sumSystemCache=dependencies.sumSystemCache,dataLoader=dependencies.dataLoader,jsonLoader=dependencies.jsonLoader;this._config=config,this._configManager=configManager,this._logger=logger,this._gameLoop=gameLoop,this._entityDataCache=entityDataCache,this._entityCache=entityCache,this._camera=camera,this._eventSystem=eventSystem,this._startSystemCache=startSystemCache,this._systemCache=systemCache,this._sumSystemCache=sumSystemCache,this._renderer=renderer,this._input=input,this._rendererCache=rendererCache,this._tileMap=tileMap,this._dataLoader=dataLoader,this._jsonLoader=jsonLoader,this._isCameraOn=this.validateConfig("camera")}var _proto=Engine.prototype;return _proto.initializeCamera=function(gameData){this._isCameraOn&&this._camera.load(gameData.tileMapData)},_proto.validateConfig=function(id){var config=this._config.engineDependency.find(function(c){return c.id===id});return!!config&&config.isOn},_proto.subscribeKeyboardEvents=function(){var _this=this;if(Engine_instanceof(this._input,InputManagerEmpty)){this._logger.debug("InputManager is off");return}this._keyDownHandler=function(event){_this._input.handleKeyDown(event.key)},this._keyUpHandler=function(event){_this._input.handleKeyUp(event.key)},document.addEventListener("keydown",this._keyDownHandler),document.addEventListener("keyup",this._keyUpHandler)},_proto.loadEntityData=function(fileName){var _this=this;return Engine_async_to_generator(function(){var _ref,gameData,data;return Engine_ts_generator(this,function(_state){switch(_state.label){case 0:return _this._logger.log("loading gameData"),[4,_this.wrappData(fileName)];case 1:return gameData=(_ref=_state.sent()).gameData,data=_ref.data,_this._dataLoader.loadEntityData(gameData),[4,_this._dataLoader.loadEntityCache(data)];case 2:return _state.sent(),_this._afterCreateEntitiesCallback(_this._entityCache),[2]}})})()},_proto.wrappData=function(fileName){var _this=this;return Engine_async_to_generator(function(){var entityData,data,gameData;return Engine_ts_generator(this,function(_state){switch(_state.label){case 0:return entityData=new EntityData(new Vector2(960,540)),[4,_this.loadEntityJson(fileName)];case 1:return data=_state.sent(),entityData.loadData(data),(gameData=new GameData).entityData=entityData,[2,{gameData:gameData,data:data}]}})})()},_proto.loadEntityJson=function(fileName){var _this=this;return Engine_async_to_generator(function(){return Engine_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this._jsonLoader.getData(fileName,{})];case 1:return[2,_state.sent()]}})})()},_proto.start=function(){if(this._isStarted)throw Error("Already started.");this._logger.log("starting Engine"),this.subscribeKeyboardEvents(),this._isCameraOn&&this.setupCamera(),this._gameLoop.subscribeRender(this.render),this._gameLoop.subscribeUpdate(this.update),this._gameLoop.start(),this._isStarted=!0},_proto.startSystem=function(){this._startSystemCache.start(),this._systemCache.start(),this.startRenderer(),this._sumSystemCache.start()},_proto.startRenderer=function(){if(Engine_instanceof(this._renderer,RendererEmpty)){this._logger.debug("Renderer is off");return}this._logger.log("starting Renderer"),this._rendererCache.start()},_proto.setupCamera=function(){this._player=this._entityCache.getStrict(EntityId_Player1),this._playerPosition=this._player.getComponentStrict(Transform_Transform).position},_proto.stop=function(){this._logger.log("Stoping Engine"),this._gameLoop.stop(),this._gameLoop.unsubscribeRender(this.render),this._gameLoop.unsubscribeUpdate(this.update),this._player={},this._playerPosition={}},_proto.reloadEngine=function(){this.reset()},_proto.clear=function(){this.clearEntityData(),this.clearSystem(),this._eventSystem.clear()},_proto.clearEntityData=function(){this._entityDataCache.removeAll(),this._entityCache.removeAll()},_proto.clearSystem=function(){this._startSystemCache.removeAll(),this._systemCache.removeAll(),this._sumSystemCache.removeAll(),this._rendererCache.removeAll(),this._input.unsubscribeAll("KeyDown"),this._input.unsubscribeAll("KeyUp")},_proto.reset=function(){this.unsubscribeKeyboardEvents(),this._input.unsubscribeAll("KeyDown"),this._entityDataCache.removeAll(),this._entityCache.removeAll()},_proto.unsubscribeKeyboardEvents=function(){document.removeEventListener("keydown",this._keyDownHandler),document.removeEventListener("keyup",this._keyUpHandler)},_proto.getScreenCenter=function(){return this._renderer.getCenter()},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Engine.prototype,[{key:"gameLoop",get:function(){return this._gameLoop},set:function(gameLoop){this._gameLoop=gameLoop}},{key:"logger",get:function(){return this._logger}},{key:"config",get:function(){return this._config}},{key:"configManager",get:function(){return this._configManager}},{key:"afterCreateEntitiesCallback",set:function(callback){this._afterCreateEntitiesCallback=callback}},{key:"startSystemCache",get:function(){return this._startSystemCache}},{key:"rendererCache",get:function(){return this._rendererCache}},{key:"sumSystemCache",get:function(){return this._sumSystemCache}},{key:"systemCache",get:function(){return this._systemCache}},{key:"renderer",get:function(){return this._renderer}},{key:"entityCache",get:function(){return this._entityCache}},{key:"input",get:function(){return this._input}},{key:"eventSystem",get:function(){return this._eventSystem}},{key:"entityDataCache",get:function(){return this._entityDataCache}},{key:"isStarted",get:function(){return this._isStarted}}]),Engine}(),EngineBuilder=function(){function EngineBuilder(){this._dependencies={}}var _proto=EngineBuilder.prototype;return _proto.withEngineConfigOptions=function(config,configManager){return this._dependencies.engineConfig=config,this._dependencies.engineConfiguration=configManager,this},_proto.withLogger=function(logger){return this._dependencies.logger=logger,this},_proto.withGameLoop=function(gameLoop){return this._dependencies.gameLoop=gameLoop,this},_proto.withRenderer=function(renderer){return this._dependencies.renderer=renderer,this},_proto.withInput=function(input){return this._dependencies.input=input,this},_proto.withEntityDataCache=function(entityDataCache){return this._dependencies.entityDataCache=entityDataCache,this},_proto.getError=function(childName,parentName){return childName+" must be set before setting the "+parentName},_proto.withEntityCache=function(entityCache){return this._dependencies.logger||console.log(this.getError("Logger","Entity Cache")),this._dependencies.entityCache=entityCache,this},_proto.withCamera=function(camera){return this._dependencies.renderer||console.log(this.getError("Renderer","Camera")),this._dependencies.camera=camera,this._dependencies.camera.renderer=this._dependencies.renderer,this},_proto.withTileMap=function(tileMap){return this._dependencies.renderer||console.log(this.getError("Renderer","Tile Map")),this._dependencies.tileMap=tileMap,this._dependencies.tileMap.renderer=this._dependencies.renderer,this},_proto.withEventSystem=function(eventSystem){return this._dependencies.eventSystem=eventSystem,this},_proto.withStartSystemCache=function(startSystemManager){return this._dependencies.startSystemCache=startSystemManager,this},_proto.withSystemCache=function(systemCache){return this._dependencies.systemCache=systemCache,this},_proto.withRendererCache=function(rendererCollection){return this._dependencies.rendererCache=rendererCollection,this},_proto.withSumSystemCache=function(sumSystemCollection){return this._dependencies.sumSystemCache=sumSystemCollection,this},_proto.withJsonLoader=function(loader){return this._dependencies.jsonLoader=loader,this},_proto.withDataLoader=function(dataLoader){return this._dependencies.dataLoader=dataLoader,this},_proto.build=function(){return new Engine(this._dependencies)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(EngineBuilder.prototype,[{key:"entityCache",get:function(){return this._dependencies.entityCache}}]),EngineBuilder}(),Renderer=function(){function Renderer(_canvasHelper){this._canvasHelper=_canvasHelper}var _proto=Renderer.prototype;return _proto.clearCanvas=function(){this._canvasHelper.clearCanvas()},_proto.drawRect=function(topLeft,size,color){void 0===color&&(color="yellow"),this.ctx.fillStyle=color,this.ctx.fillRect(topLeft.x,topLeft.y,size.x,size.y)},_proto.drawRectAroundPoint=function(center,size,color){void 0===color&&(color="yellow"),this.ctx.fillStyle=color,this.ctx.fillRect(center.x-size.x/2,center.y-size.y/2,size.x,size.y)},_proto.drawFrame=function(topLeft,size,color,lineWidth){void 0===color&&(color="yellow"),void 0===lineWidth&&(lineWidth=2),this.ctx.strokeStyle=color,this.ctx.lineWidth=lineWidth,this.ctx.strokeRect(topLeft.x,topLeft.y,size.x,size.y)},_proto.drawFrameAroundPoint=function(center,size,color,lineWidth){void 0===color&&(color="yellow"),void 0===lineWidth&&(lineWidth=2),this.ctx.strokeStyle=color,this.ctx.lineWidth=lineWidth,this.ctx.strokeRect(center.x-size.x/2,center.y-size.y/2,size.x,size.y)},_proto.save=function(){this.ctx.save()},_proto.restore=function(){this.ctx.restore()},_proto.translate=function(v){this.ctx.translate(v.x,v.y)},_proto.resetTranslation=function(){this.ctx.setTransform(1,0,0,1,0,0)},_proto.getCenter=function(){return new Vector2(this._canvasHelper.width/2,this._canvasHelper.height/2)},_proto.fillCanvas=function(color){this.ctx.fillStyle=color,this.ctx.fillRect(0,0,this._canvasHelper.width,this._canvasHelper.height)},_proto.drawObject=function(transform,boxCollider,rigidBody,direction,fill){void 0===fill&&(fill=!1),this.drawCollisionBox(transform,boxCollider,fill),this.drawVector(transform.position,rigidBody.velocity,boxCollider.color),this.drawVector(transform.position,direction.directionPoint,"orange"),this.drawPoint(transform.position)},_proto.drawVector=function(start,end,color,scale,width){void 0===scale&&(scale=1),void 0===width&&(width=4);var arrowEnd=new Vector2(start.x+end.x*scale,start.y+end.y*scale);this.ctx.beginPath(),this.ctx.moveTo(start.x,start.y),this.ctx.lineTo(arrowEnd.x,arrowEnd.y),this.ctx.strokeStyle=color,this.ctx.lineWidth=width,this.ctx.stroke()},_proto.drawPoint=function(param,param1){var x=param.x,y=param.y,_ref=void 0===param1?{}:param1,_ref_halfSize=_ref.halfSize,halfSize=void 0===_ref_halfSize?2.5:_ref_halfSize,_ref_color=_ref.color,size=2*halfSize;this.setFillStyle(void 0===_ref_color?"yellow":_ref_color),this.ctx.fillRect(x-halfSize,y-halfSize,size,size)},_proto.drawPointXY=function(x,y,param){var _ref=void 0===param?{}:param,_ref_halfSize=_ref.halfSize,halfSize=void 0===_ref_halfSize?2.5:_ref_halfSize,_ref_color=_ref.color,size=2*halfSize;this.setFillStyle(void 0===_ref_color?"yellow":_ref_color),this.ctx.fillRect(x-halfSize,y-halfSize,size,size)},_proto.setFillStyle=function(color){this.ctx.fillStyle=color},_proto.drawCollisionBox=function(transform,boxCollider,fill){void 0===fill&&(fill=!1);var pos=new Vector2(transform.position.x+boxCollider.center.x,transform.position.y+boxCollider.center.y);fill?this.drawRectAroundPoint(pos,boxCollider.size,boxCollider.color):this.drawFrameAroundPoint(pos,boxCollider.size,boxCollider.color)},_proto.drawText=function(text,position,offset,color,font){void 0===offset&&(offset=Vector2.zero),void 0===color&&(color="white"),void 0===font&&(font="12px sans-serif"),this.ctx.fillStyle=color,this.ctx.font=font,this.ctx.fillText(text,position.x+offset.x,position.y+offset.y)},_proto.drawTextScaling=function(text,position,offset,scale,color,font){void 0===offset&&(offset=Vector2.zero),void 0===scale&&(scale=Vector2.one),void 0===color&&(color="white"),void 0===font&&(font="12px sans-serif"),this.ctx.fillStyle=color,this.ctx.font=font,this.ctx.fillText(text,(position.x+offset.x)*scale.x,(position.y+offset.y)*scale.y)},_proto.drawTextTransform=function(text,position,offset,scale,color,font){void 0===offset&&(offset=Vector2.zero),void 0===scale&&(scale=Vector2.one),void 0===color&&(color="white"),void 0===font&&(font="12px sans-serif"),this.ctx.save(),this.ctx.scale(scale.x,scale.y),this.ctx.fillStyle=color,this.ctx.font=font,this.ctx.fillText(text,position.x+offset.x,position.y+offset.y),this.ctx.restore()},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(Renderer.prototype,[{key:"ctx",get:function(){return this._canvasHelper.canvasContext2D.ctx}}]),Renderer}();function DataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function DataLoader_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){DataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){DataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function DataLoader_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var DataLoader=function(){function DataLoader(_tileMapDataLoader,_entityLoader){this._tileMapDataLoader=_tileMapDataLoader,this._entityLoader=_entityLoader}var _proto=DataLoader.prototype;return _proto.loadTileMap=function(gameData){var _this=this;return DataLoader_async_to_generator(function(){return DataLoader_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this._tileMapDataLoader.load(gameData)];case 1:return _state.sent(),[2]}})})()},_proto.loadEntityData=function(gameData){var _this=this;return DataLoader_async_to_generator(function(){return DataLoader_ts_generator(this,function(_state){return _this._entityLoader.loadEntityData(gameData),[2]})})()},_proto.loadEntityCache=function(data){var _this=this;return DataLoader_async_to_generator(function(){return DataLoader_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this._entityLoader.loadEntityCache(data)];case 1:return _state.sent(),[2]}})})()},DataLoader}();function EntityCreator_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var EntityCreator=function(){function EntityCreator(_entityComponentCreator,_entityCache){this._entityComponentCreator=_entityComponentCreator,this._entityCache=_entityCache}return EntityCreator.prototype.loadData=function(data){var fn,_this=this;return(fn=function(){return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){return _this._entityComponentCreator.loadEntity(data,_this._entityCache),[2]})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){EntityCreator_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EntityCreator_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},EntityCreator}();function EntityDataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var EntityDataLoader=function(){function EntityDataLoader(_entityDataCache,_entityCreator){this._entityDataCache=_entityDataCache,this._entityCreator=_entityCreator}var _proto=EntityDataLoader.prototype;return _proto.loadEntityData=function(gameData){var _this=this;gameData.entityData.forEach(function(key,entityData){_this._entityDataCache.add(key,entityData)})},_proto.loadEntityCache=function(data){var fn,_this=this;return(fn=function(){return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:return[4,_this._entityCreator.loadData(data)];case 1:return _state.sent(),[2]}})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){EntityDataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EntityDataLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},EntityDataLoader}();function TileMapLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var TileMapLoader=function(){function TileMapLoader(_tileMap){this._tileMap=_tileMap}return TileMapLoader.prototype.load=function(gameData){var fn,_this=this;return(fn=function(){return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){return gameData.tileMapData&&_this._tileMap.load(gameData.tileMapData),[2]})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){TileMapLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){TileMapLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},TileMapLoader}(),CanvasHelper=function(){function CanvasHelper(_canvasContext2D){this._canvasContext2D=_canvasContext2D}var _proto=CanvasHelper.prototype;return _proto.addEventListener=function(eventName,callback){this._canvasContext2D.canvas.addEventListener(eventName,callback)},_proto.requestFullscreen=function(){this._canvasContext2D.canvas.requestFullscreen()},_proto.addFullscreenOnButtonClick=function(buttonId){var _this=this,button=document.getElementById(buttonId);button?button.addEventListener("click",function(){document.fullscreenElement||_this.requestFullscreen()}):console.warn("No button found with id: "+buttonId)},_proto.clearCanvas=function(){this._canvasContext2D.ctx.clearRect(0,0,this.width,this.height)},_proto.fillCanvas=function(fillStyle){this._canvasContext2D.ctx.fillStyle=fillStyle,this._canvasContext2D.ctx.fillRect(0,0,this.width,this.height)},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(CanvasHelper.prototype,[{key:"canvasContext2D",get:function(){return this._canvasContext2D}},{key:"width",get:function(){return this._canvasContext2D.canvas.width}},{key:"height",get:function(){return this._canvasContext2D.canvas.height}}]),CanvasHelper}(),EngineDirector=function(){function EngineDirector(_componentMapper,_engineConfigurator){this._componentMapper=_componentMapper,this._engineConfigurator=_engineConfigurator}return EngineDirector.prototype.createDefaultEngineBuilder=function(config,configManager){var entityDataCache=new EntityDataCache,tileMap=new TileMap,entityCache=new EntityCache_EntityCache,engineBuilder=new EngineBuilder,isRenderer=EngineConfig.getEngineDependencyBit(config,"renderer"),isInput=EngineConfig.getEngineDependencyBit(config,"input");return engineBuilder.withEngineConfigOptions(config,configManager).withLogger(this._engineConfigurator.getLogger()),engineBuilder.withRenderer(isRenderer?new Renderer(new CanvasHelper(GenericFactory.getInstance(CanvasContext2D,config.canvasId))):new RendererEmpty).withRendererCache(isRenderer?new RendererCache:new RendererCacheEmpty),engineBuilder.withGameLoop(this._engineConfigurator.getGameLoop()).withInput(isInput?new InputManager:new InputManagerEmpty).withEntityDataCache(entityDataCache).withEntityCache(entityCache).withCamera(new Camera).withTileMap(tileMap).withEventSystem(new EventSystem).withStartSystemCache(new SystemCache).withSystemCache(new SystemCache).withSumSystemCache(new SumSystemCache).withJsonLoader(this._engineConfigurator.getJsonLoader()).withDataLoader(new DataLoader(new TileMapLoader(tileMap),new EntityDataLoader(entityDataCache,new EntityCreator(new EntityComponentCreator(this._componentMapper),entityCache)))),engineBuilder},EngineDirector}(),EntityStep=function(){function EntityStep(_entityContainer,_logger,_config){this._entityContainer=_entityContainer,this._logger=_logger,this._config=_config}var _proto=EntityStep.prototype;return _proto.selectEntitiesForSystem=function(data){var entityIds=data.entityIds,allEntities=data.allEntities,systemData=data.systemData;entityIds.forEach(function(id){var entity=allEntities[id];entity&&systemData.entities.push(entity)})},_proto.validateNotEmpty=function(data){return 0!==data.systemData.entities.length},_proto.run=function(data){return(this.selectEntitiesForSystem(data),this.validateNotEmpty(data))?(data.entityValidator?data.isEntityValid=data.entityValidator(this._entityContainer.allEntities,this._logger,this._config):data.isEntityValid=!1,this._logger.debug("'"+data.systemData.id+"': "+data.isEntityValid),!!data.isEntityValid):(this._logger.debug(""+data.systemData.id+" has no entities in data"),!1)},EntityStep}(),SystemAdder=function(){function SystemAdder(_logger){this._logger=_logger}var _proto=SystemAdder.prototype;return _proto.validateSystemInstance=function(data){return null!=data.systemData.instance},_proto.registerSystem=function(data){var register=data.register,_data_systemData=data.systemData,id=_data_systemData.id,instance=_data_systemData.instance;register.add(id,instance)},_proto.run=function(data){return this.validateSystemInstance(data)?(data.systemData.instance.registerEntitiesById(data.systemData.entities),this.registerSystem(data),this._logger.log("Register "+data.systemData.name),!0):(this._logger.log(""+data.systemData.name+": system instance fail"),!1)},SystemAdder}(),SystemPreparer=function(){function SystemPreparer(_logger,_config){this._logger=_logger,this._config=_config}var _proto=SystemPreparer.prototype;return _proto.validateId=function(data){return 0!==data.systemData.id.length},_proto.validateName=function(data){return 0!==data.systemData.name.length},_proto.validateConfig=function(data){var sysConfig=this._config.system.find(function(c){return c.id===data.systemData.id});return!!sysConfig&&sysConfig.isOn},_proto.validateIsOn=function(data){return data.jsonData.isOn},_proto.run=function(data){return this.validateId(data)?this.validateName(data)?this.validateConfig(data)?!!this.validateIsOn(data)||(this._logger.warn("System isOn false"),!1):(this._logger.warn("System Config validation failed"),!1):(this._logger.warn("System Name validation failed"),!1):(this._logger.warn("System Id validation failed"),!1)},SystemPreparer}(),SystemStep=function(){function SystemStep(_entityContainer,_systemDataCache){this._entityContainer=_entityContainer,this._systemDataCache=_systemDataCache}return SystemStep.prototype.run=function(data){if("playerKick"!==data.systemData.id)return!0;try{var _this__entityContainer_allEntities=this._entityContainer.allEntities,player1=_this__entityContainer_allEntities.player1,player2=_this__entityContainer_allEntities.player2,ball=_this__entityContainer_allEntities.ball,sys=this._systemDataCache.getStrict("playerKick");return sys.systemData.instance.registerBallById(player1.id,ball),sys.systemData.instance.registerBallById(player2.id,ball),!0}catch(e){return!1}},SystemStep}();function SystemAssembler_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var SystemAssembler=function(){function SystemAssembler(_logger){this._logger=_logger,this._steps=[]}var _proto=SystemAssembler.prototype;return _proto.withEntityStep=function(entityContainer,logger,config){return this._steps.push(new EntityStep(entityContainer,logger,config)),this},_proto.withSystemPreparer=function(logger,config){return this._steps.push(new SystemPreparer(logger,config)),this},_proto.withSystemAdder=function(logger){return this._steps.push(new SystemAdder(logger)),this},_proto.withSystemStep=function(entityContainer,systemDataCache){return this._steps.push(new SystemStep(entityContainer,systemDataCache)),this},_proto.build=function(){return this},_proto.run=function(data){for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SystemAssembler_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SystemAssembler_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._steps);!(_step=_iterator()).done;)if(!_step.value.run(data)){this._logger.log(""+data.systemData.id+" failed assembly");return}},SystemAssembler}();function EntityContainer_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var EntityContainer=function(){function EntityContainer(_cache){this._cache=_cache,this._entityList=this.getEntityList()}return EntityContainer.prototype.getEntityList=function(){for(var _step,entities={},_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return EntityContainer_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EntityContainer_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._cache.getKeys());!(_step=_iterator()).done;){var entityId=_step.value;entities[entityId]=this._cache.getStrict(entityId)}return entities},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(EntityContainer.prototype,[{key:"allEntities",get:function(){return this._entityList}}]),EntityContainer}();function SystemDataCache_set_prototype_of(o,p){return(SystemDataCache_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SystemDataCache=function(ResourceCache){function SystemDataCache(){return ResourceCache.apply(this,arguments)}return!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SystemDataCache_set_prototype_of(subClass,superClass)}(SystemDataCache,ResourceCache),SystemDataCache}(ResourceCache);function SystemDataProvider_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SystemDataProvider_create_for_of_iterator_helper_loose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SystemDataProvider_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SystemDataProvider_array_like_to_array(o,void 0)}}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var SystemDataProvider=function(){function SystemDataProvider(){this._steps=[]}var _proto=SystemDataProvider.prototype;return _proto.add=function(step){this._steps.push(step)},_proto.run=function(systemData){for(var _step,_iterator=SystemDataProvider_create_for_of_iterator_helper_loose(this._steps);!(_step=_iterator()).done;)for(var _step1,step=_step.value,_iterator1=SystemDataProvider_create_for_of_iterator_helper_loose(systemData);!(_step1=_iterator1()).done;){var data=_step1.value;step.run(data)}},SystemDataProvider}(),DefaultDataProvider=function(){function DefaultDataProvider(_entityContainer,_cache){this._entityContainer=_entityContainer,this._cache=_cache}var _proto=DefaultDataProvider.prototype;return _proto.add=function(systemId){var data={allEntities:this._entityContainer.allEntities,entityIds:[],systemData:{id:"",name:"",entities:[],instance:void 0},register:{},jsonData:{}};this._cache.add(systemId,data)},_proto.run=function(data){this.add(data.system)},DefaultDataProvider}(),Selector=function(){function Selector(_cache){this._cache=_cache}var _proto=Selector.prototype;return _proto.add=function(id,entityIds){this._cache.getStrict(id).entityIds=entityIds},_proto.run=function(data){var systemId=data.system,entityIds=data.entity;this.add(systemId,entityIds)},Selector}(),SystemIdsProvider=function(){function SystemIdsProvider(_cache){this._cache=_cache}var _proto=SystemIdsProvider.prototype;return _proto.add=function(id,name){var data=this._cache.getStrict(id);data.systemData.id=id,data.systemData.name=name},_proto.run=function(data){var system=data.system,name=data.name;this.add(system,name)},SystemIdsProvider}(),engineSystemValidatorMap={};function engineSystemValidatorMap_add(systemId,getValidator){engineSystemValidatorMap[systemId]=getValidator()}var Validator=function(){function Validator(_cache){this._cache=_cache}var _proto=Validator.prototype;return _proto.add=function(id,entityValidator){this._cache.getStrict(id).entityValidator=entityValidator},_proto.run=function(data){var system=data.system;this.add(system,engineSystemValidatorMap[system])},Validator}(),Stage1SystemDataProviderFactory=function(){function Stage1SystemDataProviderFactory(_provider){this._provider=_provider}var _proto=Stage1SystemDataProviderFactory.prototype;return _proto.withDefault=function(entityContainer,cache){return this._provider.add(new DefaultDataProvider(entityContainer,cache)),this},_proto.withIds=function(cache){return this._provider.add(new SystemIdsProvider(cache)),this},_proto.withEntities=function(cache){return this._provider.add(new Selector(cache)),this},_proto.withEntityValidation=function(cache){return this._provider.add(new Validator(cache)),this},_proto.build=function(){return this._provider},Stage1SystemDataProviderFactory}(),SystemInstanceProvider=function(){function SystemInstanceProvider(_cache,_engine){this._cache=_cache,this._engine=_engine}return SystemInstanceProvider.prototype.run=function(jsonData){var system=jsonData.system;this._cache.getStrict(system).systemData.instance=engineSystemMap[system](this._engine,jsonData)},SystemInstanceProvider}(),SystemCacheProvider=function(){function SystemCacheProvider(_cache,_engine){this._cache=_cache,this._engine=_engine,this._cacheList={rendererCache:this._engine.rendererCache,sumSystemCache:this._engine.sumSystemCache,startSystemCache:this._engine.startSystemCache,systemCache:this._engine.systemCache}}var _proto=SystemCacheProvider.prototype;return _proto.add=function(id,register){this._cache.getStrict(id).register=register},_proto.run=function(data){var system=data.system,cache=data.cache,systemCache=this._cacheList[cache];systemCache?this.add(system,systemCache):this._engine.logger.warn("Cache type "+cache+" not found for system "+system)},SystemCacheProvider}(),Stage2SystemDataProviderFactory=function(){function Stage2SystemDataProviderFactory(_provider){this._provider=_provider}var _proto=Stage2SystemDataProviderFactory.prototype;return _proto.withInstance=function(cache,engine){return this._provider.add(new SystemInstanceProvider(cache,engine)),this},_proto.withCache=function(cache,engine){return this._provider.add(new SystemCacheProvider(cache,engine)),this},_proto.build=function(){return this._provider},Stage2SystemDataProviderFactory}();function SystemBuilder_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function SystemBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var SystemBuilder=function(){function SystemBuilder(_jsonLoader){this._jsonLoader=_jsonLoader}var _proto=SystemBuilder.prototype;return _proto.withEngine=function(engine){return this._engine=engine,this},_proto.withEntityContainer=function(entityContainer){return this._entityContainer=entityContainer,this},_proto.withSystemDataCache=function(systemDataCache){return this._systemDataCache=systemDataCache,this},_proto.withSystemAssembler=function(systemAssembler){return this._systemAssembler=systemAssembler,this},_proto.withStage1Data=function(stage1){return this._stage1=stage1,this},_proto.withStage2Data=function(stage2){return this._stage2=stage2,this},_proto.build=function(systemMap){var fn,_this=this;return(fn=function(){var data,_iterator,_step;return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:return _this.assertAll(),[4,_this._jsonLoader.getData(LevelHelper.getSystemPath(_this._engine.config.data),[{}])];case 1:if(data=_state.sent(),_this._stage1.run(data),systemMap)for(_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return SystemBuilder_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SystemBuilder_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(systemMap);!(_step=_iterator()).done;)(0,_step.value)();return _this._stage2.run(data),_this._systemDataCache.forEach(function(id,_system){var systemData=_this._systemDataCache.getStrict(id),json=data.find(function(d){return d.system===id});json||_this._engine.logger.warn("System "+id+" json data not found."),systemData.jsonData=null!=json?json:{},_this._systemAssembler.run(systemData)}),[2]}})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){SystemBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){SystemBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},_proto.assertAll=function(){this.assert(this._engine),this.assert(this._entityContainer),this.assert(this._systemDataCache),this.assert(this._systemAssembler),this.assert(this._stage1),this.assert(this._stage2)},_proto.assert=function(field){if(!field)throw Error(this.message(void 0===field?"undefined":field&&"undefined"!=typeof Symbol&&field.constructor===Symbol?"symbol":typeof field))},_proto.message=function(type){return""+type+" not set"},SystemBuilder}(),SystemBuilderFactory=function(){function SystemBuilderFactory(){}var _proto=SystemBuilderFactory.prototype;return _proto.buildDependencies=function(engine){var entityCache=engine.entityCache,logger=engine.logger,config=engine.config,entityContainer=new EntityContainer(entityCache),systemDataCache=new SystemDataCache,systemAssembler=new SystemAssembler(logger).withEntityStep(entityContainer,logger,config).withSystemPreparer(logger,config).withSystemAdder(logger).withSystemStep(entityContainer,systemDataCache).build(),stage1Data=new Stage1SystemDataProviderFactory(new SystemDataProvider).withDefault(entityContainer,systemDataCache).withIds(systemDataCache).withEntities(systemDataCache).withEntityValidation(systemDataCache).build(),stage2Data=new Stage2SystemDataProviderFactory(new SystemDataProvider).withInstance(systemDataCache,engine).withCache(systemDataCache,engine).build();return{entityContainer:entityContainer,systemDataCache:systemDataCache,systemAssembler:systemAssembler,stage1Data:stage1Data,stage2Data:stage2Data}},_proto.build=function(engine,engineConfigurator){var _this_buildDependencies=this.buildDependencies(engine),entityContainer=_this_buildDependencies.entityContainer,systemDataCache=_this_buildDependencies.systemDataCache,systemAssembler=_this_buildDependencies.systemAssembler,stage1Data=_this_buildDependencies.stage1Data,stage2Data=_this_buildDependencies.stage2Data;return new SystemBuilder(engineConfigurator.getJsonLoader()).withEngine(engine).withEntityContainer(entityContainer).withSystemDataCache(systemDataCache).withSystemAssembler(systemAssembler).withStage1Data(stage1Data).withStage2Data(stage2Data)},SystemBuilderFactory}(),SceneAutoLoader=function(){function SceneAutoLoader(engine){this.engine=engine,this.currentIndex=0,this.sceneList=[],this.intervalId=null,this.config=this.engine.config,this.initializeSceneList()}var _proto=SceneAutoLoader.prototype;return _proto.initializeSceneList=function(){var path=this.config.data.select.folder+"/"+this.config.data.select.subFolder,scenes=this.config.data.selector.scene.find(function(s){return s.folder===path});if(scenes){var _scenes_interval,_scenes_interval_default,defaultInterval=null!=(_scenes_interval_default=null==(_scenes_interval=scenes.interval)?void 0:_scenes_interval.default)?_scenes_interval_default:5e3;this.sceneList=scenes.list.map(function(sceneName){var _scenes_interval,_scenes_interval_sceneName;return{name:sceneName,interval:null!=(_scenes_interval_sceneName=null==(_scenes_interval=scenes.interval)?void 0:_scenes_interval[sceneName])?_scenes_interval_sceneName:defaultInterval}})}},_proto.startAutoLoad=function(){var _this=this;if(!(this.sceneList.length<=1)){var firstSceneInterval=this.sceneList[0].interval;this.intervalId=setTimeout(function(){_this.loadNextScene()},firstSceneInterval)}},_proto.loadNextScene=function(){var _this=this;if(0!==this.sceneList.length){this.currentIndex=(this.currentIndex+1)%this.sceneList.length;var sceneData=this.sceneList[this.currentIndex];this.loadScene(sceneData),this.intervalId=setTimeout(function(){_this.loadNextScene()},sceneData.interval)}},_proto.loadScene=function(sceneData){this.config.data.select.scene=sceneData.name,this.engine.configManager.update(this.config),this.engine.clear(),this.engine.loadEntityData(LevelHelper.getScenePath(this.config.data))},_proto.stopAutoLoad=function(){this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null)},SceneAutoLoader.build=function(engine){var config=engine.config,logger=engine.logger;return EngineConfig.getGameDependencyBit(config,"scene_auto_loader")?(logger.log("Scene auto loader is on"),new SceneAutoLoader(engine).startAutoLoad(),!0):(logger.log("Scene auto loader is off"),!1)},SceneAutoLoader}();function GameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function GameBuilder_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){GameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){GameBuilder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function GameBuilder_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var GameBuilder=function(){function GameBuilder(_engineConfigurator){this._engineConfigurator=_engineConfigurator,this._check={isConfig:!1,isLogger:!1,isEngineDirector:!1,isEngineBuilder:!1,isEngine:!1,isData:!1,isSystem:!1},this._initializationChecker=new InitializationChecker,this.setChecker(),this._jsonLoader=this._engineConfigurator.getJsonLoader()}var _proto=GameBuilder.prototype;return _proto.setChecker=function(){var _this=this;this._initializationChecker.predicates={withLogger:function(){return _this._check.isConfig},withEngineDirector:function(){return _this._check.isLogger},withEngineBuilder:function(){return _this._check.isEngineDirector},withEngine:function(){return _this._check.isEngineBuilder},withSystems:function(){return _this._check.isEngine},withData:function(){return _this._check.isSystem},getEngine:function(){return _this._check.isEngineBuilder&&_this._check.isEngine&&_this._check.isSystem&&_this._check.isData}},this._initializationChecker.errorTable={withLogger:this.getErrorMessage(),withEngineDirector:this.getErrorMessage(),withEngineBuilder:this.getErrorMessage(),withEngine:this.getErrorMessage(),withSystems:this.getErrorMessage(),withData:this.getErrorMessage(),getEngine:this.getErrorMessage()}},_proto.getErrorMessage=function(){var message=[];return this._config||message.push("Config required"),this._logger||message.push("Logger required"),this._engineDirector||message.push("EngineDirector required"),this._engineBuilder||message.push("EngineBuilder required"),this._engine||message.push("Engine required"),this._check.isData||message.push("Data required"),this._check.isSystem||message.push("System required"),message.join("; ")+" before game can be created"},_proto.withConfig=function(configName){var _this=this;return GameBuilder_async_to_generator(function(){var configuration,config;return GameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return configuration=_this._engineConfigurator.getConfiguration(),[4,_this.getConfig(configName,configuration)];case 1:return config=_state.sent(),_this._engineConfigurator.config=config,_this._configuration=configuration,_this._config=config,_this._check.isConfig=!0,[2,_this]}})})()},_proto.getConfig=function(configName,config){return GameBuilder_async_to_generator(function(){return GameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,config.load(configName)];case 1:return _state.sent(),[2,config.get()]}})})()},_proto.withLogger=function(logger){return this._initializationChecker.assertInitialized("withLogger"),this._logger=logger,this.configureLogger(this._config),this._check.isLogger=!0,this},_proto.configureLogger=function(config){var _config_log=config.log,level=_config_log.level,validLevel=_config_log.level_list.find(function(l){return l===level.toUpperCase()});if(!validLevel)throw Error("log level: "+level+" invalid");this._logger.setLogLevel(Logger.toLogLevel(validLevel))},_proto.withEngineDirector=function(componentMapper){return this._initializationChecker.assertInitialized("withEngineDirector"),this._engineDirector=new EngineDirector(componentMapper,this._engineConfigurator),this._check.isEngineDirector=!0,this},_proto.withEngineBuilder=function(){return this._initializationChecker.assertInitialized("withEngineBuilder"),this._engineBuilder=this._engineDirector.createDefaultEngineBuilder(this._config,this._configuration),this._check.isEngineBuilder=!0,this},_proto.withEngine=function(){return this._initializationChecker.assertInitialized("withEngine"),this._engine=this._engineBuilder.build(),this._check.isEngine=!0,this},_proto.withData=function(){var _this=this;return GameBuilder_async_to_generator(function(){return GameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return _this._initializationChecker.assertInitialized("withData"),[4,_this._engine.loadEntityData(LevelHelper.getScenePath(_this._config.data))];case 1:return _state.sent(),_this._check.isData=!0,[2,_this]}})})()},_proto.withSystems=function(){this._initializationChecker.assertInitialized("withSystems");var _this=this;return this._engine.afterCreateEntitiesCallback=GameBuilder_async_to_generator(function(_entityManager){var systemBuilder;return GameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return _this._logger.log("starting afterCreateEntitiesCallback"),systemBuilder=new SystemBuilderFactory().build(_this._engine,_this._engineConfigurator),engineSystemValidatorMap_add("ballDribble",getBallDribbleValidator),engineSystemValidatorMap_add("ballFieldCollision",getBallFieldCollisionValidator),engineSystemValidatorMap_add("ballGateCollision",getBallGateCollisionValidator),engineSystemValidatorMap_add("ballMovement",getBallMovementValidator),engineSystemValidatorMap_add("boxColliderRenderer",getBoxColliderRendererValidator),engineSystemValidatorMap_add("boxFlip",getBoxFlipValidator),engineSystemValidatorMap_add("canvasScaler",getCanvasScalerValidator),engineSystemValidatorMap_add("clientMovement",getClientMovementValidator),engineSystemValidatorMap_add("collisionBoxRenderer",getCollisionBoxRendererValidator),engineSystemValidatorMap_add("collisionBoxRenderer_layer2",getCollisionBoxRendererValidator),engineSystemValidatorMap_add("contentScalerTester",getCollisionBoxRendererValidator),engineSystemValidatorMap_add("debugRenderer",getDebugRendererValidator),engineSystemValidatorMap_add("drawDirection",getDrawDirectionValidator),engineSystemValidatorMap_add("entityScaler",getEntityScalerValidator),engineSystemValidatorMap_add("gameScore",getGameScoreValidator),engineSystemValidatorMap_add("gameState",getGameStateValidator),engineSystemValidatorMap_add("insideBoxCollision",getInsideBoxCollisionValidator),engineSystemValidatorMap_add("keyboardMapping",getKeyboardMappingValidator),engineSystemValidatorMap_add("kinematics",getKinematicsValidator),engineSystemValidatorMap_add("limitMove",getLimitMoveValidator),engineSystemValidatorMap_add("markers",getMarkersRendererValidator),engineSystemValidatorMap_add("mouseInput",getMouseInputValidator),engineSystemValidatorMap_add("playerBallCollision",getPlayerBallCollisionValidator),engineSystemValidatorMap_add("playerKick",getPlayerKickValidator),engineSystemValidatorMap_add("playerMovement",getPlayerMovementValidator),engineSystemValidatorMap_add("playerStateRenderer",getPlayerStateRendererValidator),engineSystemValidatorMap_add("sceneRenderer",getSceneRendererValidator),engineSystemValidatorMap_add("sceneRenderer_layer2",getSceneRendererValidator),engineSystemValidatorMap_add("sceneRenderer_layer3",getSceneRendererValidator),engineSystemValidatorMap_add("scoreRenderer",getScoreRendererValidator),engineSystemValidatorMap_add("serverMovement",getServerMovementValidator),engineSystemValidatorMap_add("spriteFlip",getSpriteFlipValidator),engineSystemValidatorMap_add("spriteRenderer",getSpriteRendererValidator),engineSystemValidatorMap_add("spriteRenderer_layer2",getSpriteRendererValidator),engineSystemValidatorMap_add("spriteRenderer_layer3",getSpriteRendererValidator),engineSystemValidatorMap_add("spriteRenderer_layer4",getSpriteRendererValidator),engineSystemValidatorMap_add("spriteState",getSpriteStateValidator),engineSystemValidatorMap_add("stepMovement",getStepMovementValidator),[4,systemBuilder.build(_this._engineConfigurator.getSystemMap())];case 1:return _state.sent(),_this._engine.startSystem(),_this._engine.isStarted||_this._engine.eventSystem.publish("engineStart"),[2]}})}),this._check.isSystem=!0,this},_proto.getBit=function(id){var _this__config_gameDependency_find,_this__config_gameDependency_find_isOn;return null!=(_this__config_gameDependency_find_isOn=null==(_this__config_gameDependency_find=this._config.gameDependency.find(function(c){return c.id===id}))?void 0:_this__config_gameDependency_find.isOn)&&_this__config_gameDependency_find_isOn},_proto.withEditorMenu=function(){return EditorMenu.build(this._engine),this},_proto.withSceneAutoLoader=function(){return SceneAutoLoader.build(this._engine),this},_proto.build=function(configName,componentMapper){var _this=this;return GameBuilder_async_to_generator(function(){return GameBuilder_ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.withConfig(configName)];case 1:return _state.sent(),_this.withLogger(_this._engineConfigurator.getLogger()),_this.withEngineDirector(componentMapper).withEngineBuilder().withEngine().withSystems(),[4,_this.withData()];case 2:return _state.sent(),_this.withEditorMenu().withSceneAutoLoader(),[2]}})})()},_proto.getEngine=function(){return this._initializationChecker.assertInitialized("getEngine"),this._engine},GameBuilder}(),ObjectDto_ObjectDto=function(){function ObjectDto(id,transform,boxCollider,rigidBody){this.id=id,this.position=transform.position,this.size=boxCollider.size,this.color=boxCollider.color,this.moveStep=rigidBody.moveStep,this.velocity=rigidBody.velocity}return ObjectDto.prototype.toData=function(){return{id:this.id,position:this.position,size:this.size,color:this.color,moveStep:this.moveStep,velocity:this.velocity}},ObjectDto.fromData=function(data){var id=data.id,position=data.position,size=data.size,color=data.color,moveStep=data.moveStep;return new ObjectDto(id,{position:position},{color:color,size:size},{velocity:data.velocity,moveStep:moveStep})},ObjectDto}(),GameFrameDto_GameFrameDto=function(){function GameFrameDto(){this.players=new Map}var _proto=GameFrameDto.prototype;return _proto.toPlainObject=function(){return{players:Array.from(this.players.values())}},_proto.addPlayer=function(playerId,playerObject){this.players.set(playerId,playerObject)},_proto.removePlayer=function(playerId){this.players.delete(playerId)},_proto.getPlayer=function(playerId){return this.players.get(playerId)},GameFrameDto.fromPlainObject=function(data){var gameFrameDTO=new GameFrameDto;return gameFrameDTO.players=new Map(data.players.map(function(player){return[player.id,ObjectDto_ObjectDto.fromData(player)]})),gameFrameDTO},GameFrameDto}(),SocketEvents_SocketEvents={Connect:"connect",PlayerJoined:"player_joined",SendPlayers:"send_players",ChatMessage:"chat message",ConnectError:"connect_error",ClientFrame:"client_frame",ServerFrame:"server_frame"};let PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";let PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(key=>{PACKET_TYPES_REVERSE[PACKET_TYPES[key]]=key});let ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=obj=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer,encodePacket=({type,data},supportsBinary,callback)=>withNativeBlob&&data instanceof Blob?supportsBinary?callback(data):encodeBlobAsBase64(data,callback):withNativeArrayBuffer&&(data instanceof ArrayBuffer||isView(data))?supportsBinary?callback(data):encodeBlobAsBase64(new Blob([data]),callback):callback(PACKET_TYPES[type]+(data||"")),encodeBlobAsBase64=(data,callback)=>{let fileReader=new FileReader;return fileReader.onload=function(){callback("b"+(fileReader.result.split(",")[1]||""))},fileReader.readAsDataURL(data)};function toArray(data){return data instanceof Uint8Array?data:data instanceof ArrayBuffer?new Uint8Array(data):new Uint8Array(data.buffer,data.byteOffset,data.byteLength)}let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;let decode=base64=>{let bufferLength=.75*base64.length,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);let arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer},decodePacket_browser_withNativeArrayBuffer="function"==typeof ArrayBuffer,decodePacket=(encodedPacket,binaryType)=>{if("string"!=typeof encodedPacket)return{type:"message",data:mapBinary(encodedPacket,binaryType)};let type=encodedPacket.charAt(0);return"b"===type?{type:"message",data:decodeBase64Packet(encodedPacket.substring(1),binaryType)}:PACKET_TYPES_REVERSE[type]?encodedPacket.length>1?{type:PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:PACKET_TYPES_REVERSE[type]}:ERROR_PACKET},decodeBase64Packet=(data,binaryType)=>decodePacket_browser_withNativeArrayBuffer?mapBinary(decode(data),binaryType):{base64:!0,data},mapBinary=(data,binaryType)=>"blob"===binaryType?data instanceof Blob?data:new Blob([data]):data instanceof ArrayBuffer?data:data.buffer,encodePayload=(packets,callback)=>{let length=packets.length,encodedPackets=Array(length),count=0;packets.forEach((packet,i)=>{encodePacket(packet,!1,encodedPacket=>{encodedPackets[i]=encodedPacket,++count===length&&callback(encodedPackets.join("\x1e"))})})},decodePayload=(encodedPayload,binaryType)=>{let encodedPackets=encodedPayload.split("\x1e"),packets=[];for(let i=0;i<encodedPackets.length;i++){let decodedPacket=decodePacket(encodedPackets[i],binaryType);if(packets.push(decodedPacket),"error"===decodedPacket.type)break}return packets};function totalLength(chunks){return chunks.reduce((acc,chunk)=>acc+chunk.length,0)}function concatChunks(chunks,size){if(chunks[0].length===size)return chunks.shift();let buffer=new Uint8Array(size),j=0;for(let i=0;i<size;i++)buffer[i]=chunks[0][j++],j===chunks[0].length&&(chunks.shift(),j=0);return chunks.length&&j<chunks[0].length&&(chunks[0]=chunks[0].slice(j)),buffer}function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var cb,callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return 0===callbacks.length&&delete this._callbacks["$"+event],this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};for(var args=Array(arguments.length-1),callbacks=this._callbacks["$"+event],i=1;i<arguments.length;i++)args[i-1]=arguments[i];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};let globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function pick(obj,...attr){return attr.reduce((acc,k)=>(obj.hasOwnProperty(k)&&(acc[k]=obj[k]),acc),{})}let NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(obj,opts){opts.useNativeTimers?(obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(obj.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),obj.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}class TransportError extends Error{constructor(reason,description,context){super(reason),this.description=description,this.context=context,this.type="TransportError"}}class Transport extends Emitter{constructor(opts){super(),this.writable=!1,installTimerFunctions(this,opts),this.opts=opts,this.query=opts.query,this.socket=opts.socket}onError(reason,description,context){return super.emitReserved("error",new TransportError(reason,description,context)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(packets){"open"===this.readyState&&this.write(packets)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(data){let packet=decodePacket(data,this.socket.binaryType);this.onPacket(packet)}onPacket(packet){super.emitReserved("packet",packet)}onClose(details){this.readyState="closed",super.emitReserved("close",details)}pause(onPause){}createUri(schema,query={}){return schema+"://"+this._hostname()+this._port()+this.opts.path+this._query(query)}_hostname(){let hostname=this.opts.hostname;return -1===hostname.indexOf(":")?hostname:"["+hostname+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(query){let encodedQuery=function(obj){let str="";for(let i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str}(query);return encodedQuery.length?"?"+encodedQuery:""}}let alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),map={},seed=0,i=0,prev;function yeast_encode(num){let encoded="";do encoded=alphabet[num%64]+encoded,num=Math.floor(num/64);while(num>0)return encoded}function yeast(){let now=yeast_encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+yeast_encode(seed++)}for(;i<64;i++)map[alphabet[i]]=i;let value=!1;try{value="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){}let hasCORS=value;function XHR(opts){let xdomain=opts.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}if(!xdomain)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function empty(){}let hasXHR2=null!=new XHR({xdomain:!1}).responseType;class Request extends Emitter{constructor(uri,opts){super(),installTimerFunctions(this,opts),this.opts=opts,this.method=opts.method||"GET",this.uri=uri,this.data=void 0!==opts.data?opts.data:null,this.create()}create(){var _a;let opts=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");opts.xdomain=!!this.opts.xd;let xhr=this.xhr=new XHR(opts);try{xhr.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(let i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.opts.extraHeaders[i])}catch(e){}if("POST"===this.method)try{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}null===(_a=this.opts.cookieJar)||void 0===_a||_a.addCookies(xhr),"withCredentials"in xhr&&(xhr.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(xhr.timeout=this.opts.requestTimeout),xhr.onreadystatechange=()=>{var _a;3===xhr.readyState&&(null===(_a=this.opts.cookieJar)||void 0===_a||_a.parseCookies(xhr)),4===xhr.readyState&&(200===xhr.status||1223===xhr.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof xhr.status?xhr.status:0)},0))},xhr.send(this.data)}catch(e){this.setTimeoutFn(()=>{this.onError(e)},0);return}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(err){this.emitReserved("error",err,this.xhr),this.cleanup(!0)}cleanup(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}onLoad(){let data=this.xhr.responseText;null!==data&&(this.emitReserved("data",data),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function unloadHandler(){for(let i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}Request.requestsCount=0,Request.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",unloadHandler):"function"==typeof addEventListener&&addEventListener("onpagehide"in globalThisShim?"pagehide":"unload",unloadHandler,!1));let nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?cb=>Promise.resolve().then(cb):(cb,setTimeoutFn)=>setTimeoutFn(cb,0),WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),transports={websocket:class extends Transport{constructor(opts){super(opts),this.supportsBinary=!opts.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let uri=this.uri(),protocols=this.opts.protocols,opts=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=isReactNative?new WebSocket(uri,protocols,opts):protocols?new WebSocket(uri,protocols):new WebSocket(uri)}catch(err){return this.emitReserved("error",err)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=closeEvent=>this.onClose({description:"websocket connection closed",context:closeEvent}),this.ws.onmessage=ev=>this.onData(ev.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){let packet=packets[i],lastPacket=i===packets.length-1;encodePacket(packet,this.supportsBinary,data=>{try{this.ws.send(data)}catch(e){}lastPacket&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let schema=this.opts.secure?"wss":"ws",query=this.query||{};return this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||(query.b64=1),this.createUri(schema,query)}check(){return!!WebSocket}},webtransport:class extends Transport{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(err=>{this.onError("webtransport error",err)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(stream=>{let decoderStream=function(maxPayload,binaryType){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);let chunks=[],state=0,expectedLength=-1,isBinary=!1;return new TransformStream({transform(chunk,controller){for(chunks.push(chunk);;){if(0===state){if(1>totalLength(chunks))break;let header=concatChunks(chunks,1);isBinary=(128&header[0])==128,state=(expectedLength=127&header[0])<126?3:126===expectedLength?1:2}else if(1===state){if(2>totalLength(chunks))break;let headerArray=concatChunks(chunks,2);expectedLength=new DataView(headerArray.buffer,headerArray.byteOffset,headerArray.length).getUint16(0),state=3}else if(2===state){if(8>totalLength(chunks))break;let headerArray=concatChunks(chunks,8),view=new DataView(headerArray.buffer,headerArray.byteOffset,headerArray.length),n=view.getUint32(0);if(n>2097151){controller.enqueue(ERROR_PACKET);break}expectedLength=4294967296*n+view.getUint32(4),state=3}else{if(totalLength(chunks)<expectedLength)break;let data=concatChunks(chunks,expectedLength);controller.enqueue(decodePacket(isBinary?data:TEXT_DECODER.decode(data),binaryType)),state=0}if(0===expectedLength||expectedLength>maxPayload){controller.enqueue(ERROR_PACKET);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),reader=stream.readable.pipeThrough(decoderStream).getReader(),encoderStream=new TransformStream({transform(packet,controller){var callback;callback=encodedPacket=>{let header;let payloadLength=encodedPacket.length;if(payloadLength<126)new DataView((header=new Uint8Array(1)).buffer).setUint8(0,payloadLength);else if(payloadLength<65536){let view=new DataView((header=new Uint8Array(3)).buffer);view.setUint8(0,126),view.setUint16(1,payloadLength)}else{let view=new DataView((header=new Uint8Array(9)).buffer);view.setUint8(0,127),view.setBigUint64(1,BigInt(payloadLength))}packet.data&&"string"!=typeof packet.data&&(header[0]|=128),controller.enqueue(header),controller.enqueue(encodedPacket)},withNativeBlob&&packet.data instanceof Blob?packet.data.arrayBuffer().then(toArray).then(callback):withNativeArrayBuffer&&(packet.data instanceof ArrayBuffer||isView(packet.data))?callback(toArray(packet.data)):encodePacket(packet,!1,encoded=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),callback(TEXT_ENCODER.encode(encoded))})}});encoderStream.readable.pipeTo(stream.writable),this.writer=encoderStream.writable.getWriter();let read=()=>{reader.read().then(({done,value})=>{done||(this.onPacket(value),read())}).catch(err=>{})};read();let packet={type:"open"};this.query.sid&&(packet.data=`{"sid":"${this.query.sid}"}`),this.writer.write(packet).then(()=>this.onOpen())})}))}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){let packet=packets[i],lastPacket=i===packets.length-1;this.writer.write(packet).then(()=>{lastPacket&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var _a;null===(_a=this.transport)||void 0===_a||_a.close()}},polling:class extends Transport{constructor(opts){if(super(opts),this.polling=!1,"undefined"!=typeof location){let isSSL="https:"===location.protocol,port=location.port;port||(port=isSSL?"443":"80"),this.xd="undefined"!=typeof location&&opts.hostname!==location.hostname||port!==opts.port}let forceBase64=opts&&opts.forceBase64;this.supportsBinary=hasXHR2&&!forceBase64,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(onPause){this.readyState="pausing";let pause=()=>{this.readyState="paused",onPause()};if(this.polling||!this.writable){let total=0;this.polling&&(total++,this.once("pollComplete",function(){--total||pause()})),this.writable||(total++,this.once("drain",function(){--total||pause()}))}else pause()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(data){decodePayload(data,this.socket.binaryType).forEach(packet=>{if("opening"===this.readyState&&"open"===packet.type&&this.onOpen(),"close"===packet.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(packet)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let close=()=>{this.write([{type:"close"}])};"open"===this.readyState?close():this.once("open",close)}write(packets){this.writable=!1,encodePayload(packets,data=>{this.doWrite(data,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let schema=this.opts.secure?"https":"http",query=this.query||{};return!1!==this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||query.sid||(query.b64=1),this.createUri(schema,query)}request(opts={}){return Object.assign(opts,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request(this.uri(),opts)}doWrite(data,fn){let req=this.request({method:"POST",data:data});req.on("success",fn),req.on("error",(xhrStatus,context)=>{this.onError("xhr post error",xhrStatus,context)})}doPoll(){let req=this.request();req.on("data",this.onData.bind(this)),req.on("error",(xhrStatus,context)=>{this.onError("xhr poll error",xhrStatus,context)}),this.pollXhr=req}}},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(str){if(str.length>2e3)throw"URI too long";let src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));let m=re.exec(str||""),uri={},i=14;for(;i--;)uri[parts[i]]=m[i]||"";return -1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri.pathNames=function(obj,path){let names=path.replace(/\/{2,9}/g,"/").split("/");return("/"==path.slice(0,1)||0===path.length)&&names.splice(0,1),"/"==path.slice(-1)&&names.splice(names.length-1,1),names}(0,uri.path),uri.queryKey=function(uri,query){let data={};return query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){$1&&(data[$1]=$2)}),data}(0,uri.query),uri}class Socket extends Emitter{constructor(uri,opts={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],uri&&"object"==typeof uri&&(opts=uri,uri=null),uri?(uri=parse(uri),opts.hostname=uri.host,opts.secure="https"===uri.protocol||"wss"===uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=parse(opts.host).host),installTimerFunctions(this,opts),this.secure=null!=opts.secure?opts.secure:"undefined"!=typeof location&&"https:"===location.protocol,opts.hostname&&!opts.port&&(opts.port=this.secure?"443":"80"),this.hostname=opts.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=opts.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=opts.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},opts),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(qs){let qry={},pairs=qs.split("&");for(let i=0,l=pairs.length;i<l;i++){let pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(name){let query=Object.assign({},this.opts.query);query.EIO=4,query.transport=name,this.id&&(query.sid=this.id);let opts=Object.assign({},this.opts,{query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[name]);return new transports[name](opts)}open(){let transport;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))transport="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else transport=this.transports[0];this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){this.transports.shift(),this.open();return}transport.open(),this.setTransport(transport)}setTransport(transport){this.transport&&this.transport.removeAllListeners(),this.transport=transport,transport.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",reason=>this.onClose("transport close",reason))}probe(name){let transport=this.createTransport(name),failed=!1;Socket.priorWebsocketSuccess=!1;let onTransportOpen=()=>{failed||(transport.send([{type:"ping",data:"probe"}]),transport.once("packet",msg=>{if(!failed){if("pong"===msg.type&&"probe"===msg.data)this.upgrading=!0,this.emitReserved("upgrading",transport),transport&&(Socket.priorWebsocketSuccess="websocket"===transport.name,this.transport.pause(()=>{failed||"closed"===this.readyState||(cleanup(),this.setTransport(transport),transport.send([{type:"upgrade"}]),this.emitReserved("upgrade",transport),transport=null,this.upgrading=!1,this.flush())}));else{let err=Error("probe error");err.transport=transport.name,this.emitReserved("upgradeError",err)}}}))};function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}let onerror=err=>{let error=Error("probe error: "+err);error.transport=transport.name,freezeTransport(),this.emitReserved("upgradeError",error)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!==transport.name&&freezeTransport()}let cleanup=()=>{transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),this.off("close",onclose),this.off("upgrading",onupgrade)};transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==name?this.setTimeoutFn(()=>{failed||transport.open()},200):transport.open()}onOpen(){if(this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let i=0,l=this.upgrades.length;for(;i<l;i++)this.probe(this.upgrades[i])}}onPacket(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",packet),this.emitReserved("heartbeat"),this.resetPingTimeout(),packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let err=Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emitReserved("data",packet.data),this.emitReserved("message",packet.data)}}onHandshake(data){this.emitReserved("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.maxPayload=data.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let packets=this.getWritablePackets();this.transport.send(packets),this.prevBufferLen=packets.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let payloadSize=1;for(let i=0;i<this.writeBuffer.length;i++){let data=this.writeBuffer[i].data;if(data&&(payloadSize+="string"==typeof data?function(str){let c=0,length=0;for(let i=0,l=str.length;i<l;i++)(c=str.charCodeAt(i))<128?length+=1:c<2048?length+=2:c<55296||c>=57344?length+=3:(i++,length+=4);return length}(data):Math.ceil(1.33*(data.byteLength||data.size))),i>0&&payloadSize>this.maxPayload)return this.writeBuffer.slice(0,i);payloadSize+=2}return this.writeBuffer}write(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}send(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}sendPacket(type,data,options,fn){if("function"==typeof data&&(fn=data,data=void 0),"function"==typeof options&&(fn=options,options=null),"closing"===this.readyState||"closed"===this.readyState)return;(options=options||{}).compress=!1!==options.compress;let packet={type:type,data:data,options:options};this.emitReserved("packetCreate",packet),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush()}close(){let close=()=>{this.onClose("forced close"),this.transport.close()},cleanupAndClose=()=>{this.off("upgrade",cleanupAndClose),this.off("upgradeError",cleanupAndClose),close()},waitForUpgrade=()=>{this.once("upgrade",cleanupAndClose),this.once("upgradeError",cleanupAndClose)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()),this}onError(err){Socket.priorWebsocketSuccess=!1,this.emitReserved("error",err),this.onClose("transport error",err)}onClose(reason,description){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",reason,description),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(upgrades){let filteredUpgrades=[],i=0,j=upgrades.length;for(;i<j;i++)~this.transports.indexOf(upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}Socket.protocol=4,Socket.protocol;let is_binary_withNativeArrayBuffer="function"==typeof ArrayBuffer,is_binary_isView=obj=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj.buffer instanceof ArrayBuffer,is_binary_toString=Object.prototype.toString,is_binary_withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===is_binary_toString.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===is_binary_toString.call(File);function isBinary(obj){return is_binary_withNativeArrayBuffer&&(obj instanceof ArrayBuffer||is_binary_isView(obj))||is_binary_withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File}let RESERVED_EVENTS=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],build_esm_protocol=5;(PacketType=PacketType1||(PacketType1={}))[PacketType.CONNECT=0]="CONNECT",PacketType[PacketType.DISCONNECT=1]="DISCONNECT",PacketType[PacketType.EVENT=2]="EVENT",PacketType[PacketType.ACK=3]="ACK",PacketType[PacketType.CONNECT_ERROR=4]="CONNECT_ERROR",PacketType[PacketType.BINARY_EVENT=5]="BINARY_EVENT",PacketType[PacketType.BINARY_ACK=6]="BINARY_ACK";class Encoder{constructor(replacer){this.replacer=replacer}encode(obj){return(obj.type===PacketType1.EVENT||obj.type===PacketType1.ACK)&&function hasBinary(obj,toJSON){if(!obj||"object"!=typeof obj)return!1;if(Array.isArray(obj)){for(let i=0,l=obj.length;i<l;i++)if(hasBinary(obj[i]))return!0;return!1}if(isBinary(obj))return!0;if(obj.toJSON&&"function"==typeof obj.toJSON&&1==arguments.length)return hasBinary(obj.toJSON(),!0);for(let key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key]))return!0;return!1}(obj)?this.encodeAsBinary({type:obj.type===PacketType1.EVENT?PacketType1.BINARY_EVENT:PacketType1.BINARY_ACK,nsp:obj.nsp,data:obj.data,id:obj.id}):[this.encodeAsString(obj)]}encodeAsString(obj){let str=""+obj.type;return(obj.type===PacketType1.BINARY_EVENT||obj.type===PacketType1.BINARY_ACK)&&(str+=obj.attachments+"-"),obj.nsp&&"/"!==obj.nsp&&(str+=obj.nsp+","),null!=obj.id&&(str+=obj.id),null!=obj.data&&(str+=JSON.stringify(obj.data,this.replacer)),str}encodeAsBinary(obj){let deconstruction=function(packet){let buffers=[],packetData=packet.data;return packet.data=function _deconstructPacket(data,buffers){if(!data)return data;if(isBinary(data)){let placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(Array.isArray(data)){let newData=Array(data.length);for(let i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i],buffers);return newData}if("object"==typeof data&&!(data instanceof Date)){let newData={};for(let key in data)Object.prototype.hasOwnProperty.call(data,key)&&(newData[key]=_deconstructPacket(data[key],buffers));return newData}return data}(packetData,buffers),packet.attachments=buffers.length,{packet:packet,buffers:buffers}}(obj),pack=this.encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;return buffers.unshift(pack),buffers}}function isObject(value){return"[object Object]"===Object.prototype.toString.call(value)}class Decoder extends Emitter{constructor(reviver){super(),this.reviver=reviver}add(obj){let packet;if("string"==typeof obj){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");let isBinaryEvent=(packet=this.decodeString(obj)).type===PacketType1.BINARY_EVENT;isBinaryEvent||packet.type===PacketType1.BINARY_ACK?(packet.type=isBinaryEvent?PacketType1.EVENT:PacketType1.ACK,this.reconstructor=new BinaryReconstructor(packet),0===packet.attachments&&super.emitReserved("decoded",packet)):super.emitReserved("decoded",packet)}else if(isBinary(obj)||obj.base64){if(this.reconstructor)(packet=this.reconstructor.takeBinaryData(obj))&&(this.reconstructor=null,super.emitReserved("decoded",packet));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+obj)}decodeString(str){let i=0,p={type:Number(str.charAt(0))};if(void 0===PacketType1[p.type])throw Error("unknown packet type "+p.type);if(p.type===PacketType1.BINARY_EVENT||p.type===PacketType1.BINARY_ACK){let start=i+1;for(;"-"!==str.charAt(++i)&&i!=str.length;);let buf=str.substring(start,i);if(buf!=Number(buf)||"-"!==str.charAt(i))throw Error("Illegal attachments");p.attachments=Number(buf)}if("/"===str.charAt(i+1)){let start=i+1;for(;++i&&","!==str.charAt(i)&&i!==str.length;);p.nsp=str.substring(start,i)}else p.nsp="/";let next=str.charAt(i+1);if(""!==next&&Number(next)==next){let start=i+1;for(;++i;){let c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(i===str.length)break}p.id=Number(str.substring(start,i+1))}if(str.charAt(++i)){let payload=this.tryParse(str.substr(i));if(Decoder.isPayloadValid(p.type,payload))p.data=payload;else throw Error("invalid payload")}return p}tryParse(str){try{return JSON.parse(str,this.reviver)}catch(e){return!1}}static isPayloadValid(type,payload){switch(type){case PacketType1.CONNECT:return isObject(payload);case PacketType1.DISCONNECT:return void 0===payload;case PacketType1.CONNECT_ERROR:return"string"==typeof payload||isObject(payload);case PacketType1.EVENT:case PacketType1.BINARY_EVENT:return Array.isArray(payload)&&("number"==typeof payload[0]||"string"==typeof payload[0]&&-1===RESERVED_EVENTS.indexOf(payload[0]));case PacketType1.ACK:case PacketType1.BINARY_ACK:return Array.isArray(payload)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(packet){this.packet=packet,this.buffers=[],this.reconPack=packet}takeBinaryData(binData){if(this.buffers.push(binData),this.buffers.length===this.reconPack.attachments){var packet,buffers;let packet1=(packet=this.reconPack,buffers=this.buffers,packet.data=function _reconstructPacket(data,buffers){if(!data)return data;if(data&&!0===data._placeholder){if("number"==typeof data.num&&data.num>=0&&data.num<buffers.length)return buffers[data.num];throw Error("illegal attachments")}if(Array.isArray(data))for(let i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i],buffers);else if("object"==typeof data)for(let key in data)Object.prototype.hasOwnProperty.call(data,key)&&(data[key]=_reconstructPacket(data[key],buffers));return data}(packet.data,buffers),delete packet.attachments,packet);return this.finishedReconstruction(),packet1}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function on(obj,ev,fn){return obj.on(ev,fn),function(){obj.off(ev,fn)}}let socket_RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class socket_Socket extends Emitter{constructor(io,nsp,opts){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=io,this.nsp=nsp,opts&&opts.auth&&(this.auth=opts.auth),this._opts=Object.assign({},opts),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let io=this.io;this.subs=[on(io,"open",this.onopen.bind(this)),on(io,"packet",this.onpacket.bind(this)),on(io,"error",this.onerror.bind(this)),on(io,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...args){return args.unshift("message"),this.emit.apply(this,args),this}emit(ev,...args){if(socket_RESERVED_EVENTS.hasOwnProperty(ev))throw Error('"'+ev.toString()+'" is a reserved event name');if(args.unshift(ev),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(args),this;let packet={type:PacketType1.EVENT,data:args};if(packet.options={},packet.options.compress=!1!==this.flags.compress,"function"==typeof args[args.length-1]){let id=this.ids++,ack=args.pop();this._registerAckCallback(id,ack),packet.id=id}let isTransportWritable=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return(!this.flags.volatile||isTransportWritable&&this.connected)&&(this.connected?(this.notifyOutgoingListeners(packet),this.packet(packet)):this.sendBuffer.push(packet)),this.flags={},this}_registerAckCallback(id,ack){var _a;let timeout=null!==(_a=this.flags.timeout)&&void 0!==_a?_a:this._opts.ackTimeout;if(void 0===timeout){this.acks[id]=ack;return}let timer=this.io.setTimeoutFn(()=>{delete this.acks[id];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===id&&this.sendBuffer.splice(i,1);ack.call(this,Error("operation has timed out"))},timeout),fn=(...args)=>{this.io.clearTimeoutFn(timer),ack.apply(this,args)};fn.withError=!0,this.acks[id]=fn}emitWithAck(ev,...args){return new Promise((resolve,reject)=>{let fn=(arg1,arg2)=>arg1?reject(arg1):resolve(arg2);fn.withError=!0,args.push(fn),this.emit(ev,...args)})}_addToQueue(args){let ack;"function"==typeof args[args.length-1]&&(ack=args.pop());let packet={id:this._queueSeq++,tryCount:0,pending:!1,args,flags:Object.assign({fromQueue:!0},this.flags)};args.push((err,...responseArgs)=>{if(packet===this._queue[0])return null!==err?packet.tryCount>this._opts.retries&&(this._queue.shift(),ack&&ack(err)):(this._queue.shift(),ack&&ack(null,...responseArgs)),packet.pending=!1,this._drainQueue()}),this._queue.push(packet),this._drainQueue()}_drainQueue(force=!1){if(!this.connected||0===this._queue.length)return;let packet=this._queue[0];(!packet.pending||force)&&(packet.pending=!0,packet.tryCount++,this.flags=packet.flags,this.emit.apply(this,packet.args))}packet(packet){packet.nsp=this.nsp,this.io._packet(packet)}onopen(){"function"==typeof this.auth?this.auth(data=>{this._sendConnectPacket(data)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(data){this.packet({type:PacketType1.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},data):data})}onerror(err){this.connected||this.emitReserved("connect_error",err)}onclose(reason,description){this.connected=!1,delete this.id,this.emitReserved("disconnect",reason,description),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(id=>{if(!this.sendBuffer.some(packet=>String(packet.id)===id)){let ack=this.acks[id];delete this.acks[id],ack.withError&&ack.call(this,Error("socket has been disconnected"))}})}onpacket(packet){if(!(packet.nsp!==this.nsp))switch(packet.type){case PacketType1.CONNECT:packet.data&&packet.data.sid?this.onconnect(packet.data.sid,packet.data.pid):this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType1.EVENT:case PacketType1.BINARY_EVENT:this.onevent(packet);break;case PacketType1.ACK:case PacketType1.BINARY_ACK:this.onack(packet);break;case PacketType1.DISCONNECT:this.ondisconnect();break;case PacketType1.CONNECT_ERROR:this.destroy();let err=Error(packet.data.message);err.data=packet.data.data,this.emitReserved("connect_error",err)}}onevent(packet){let args=packet.data||[];null!=packet.id&&args.push(this.ack(packet.id)),this.connected?this.emitEvent(args):this.receiveBuffer.push(Object.freeze(args))}emitEvent(args){if(this._anyListeners&&this._anyListeners.length)for(let listener of this._anyListeners.slice())listener.apply(this,args);super.emit.apply(this,args),this._pid&&args.length&&"string"==typeof args[args.length-1]&&(this._lastOffset=args[args.length-1])}ack(id){let self1=this,sent=!1;return function(...args){sent||(sent=!0,self1.packet({type:PacketType1.ACK,id:id,data:args}))}}onack(packet){let ack=this.acks[packet.id];"function"==typeof ack&&(delete this.acks[packet.id],ack.withError&&packet.data.unshift(null),ack.apply(this,packet.data))}onconnect(id,pid){this.id=id,this.recovered=pid&&this._pid===pid,this._pid=pid,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(args=>this.emitEvent(args)),this.receiveBuffer=[],this.sendBuffer.forEach(packet=>{this.notifyOutgoingListeners(packet),this.packet(packet)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(subDestroy=>subDestroy()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType1.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(compress){return this.flags.compress=compress,this}get volatile(){return this.flags.volatile=!0,this}timeout(timeout){return this.flags.timeout=timeout,this}onAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(listener),this}prependAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(listener),this}offAny(listener){if(!this._anyListeners)return this;if(listener){let listeners=this._anyListeners;for(let i=0;i<listeners.length;i++)if(listener===listeners[i]){listeners.splice(i,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(listener),this}prependAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(listener),this}offAnyOutgoing(listener){if(!this._anyOutgoingListeners)return this;if(listener){let listeners=this._anyOutgoingListeners;for(let i=0;i<listeners.length;i++)if(listener===listeners[i]){listeners.splice(i,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(packet){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(let listener of this._anyOutgoingListeners.slice())listener.apply(this,packet.data)}}function Backoff(opts){opts=opts||{},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=(1&Math.floor(10*rand))==0?ms-deviation:ms+deviation}return 0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter};class Manager extends Emitter{constructor(uri,opts){var _a;super(),this.nsps={},this.subs=[],uri&&"object"==typeof uri&&(opts=uri,uri=void 0),(opts=opts||{}).path=opts.path||"/socket.io",this.opts=opts,installTimerFunctions(this,opts),this.reconnection(!1!==opts.reconnection),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(_a=opts.randomizationFactor)&&void 0!==_a?_a:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==opts.timeout?2e4:opts.timeout),this._readyState="closed",this.uri=uri;let _parser=opts.parser||socket_io_parser_build_esm_namespaceObject;this.encoder=new _parser.Encoder,this.decoder=new _parser.Decoder,this._autoConnect=!1!==opts.autoConnect,this._autoConnect&&this.open()}reconnection(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection}reconnectionAttempts(v){return void 0===v?this._reconnectionAttempts:(this._reconnectionAttempts=v,this)}reconnectionDelay(v){var _a;return void 0===v?this._reconnectionDelay:(this._reconnectionDelay=v,null===(_a=this.backoff)||void 0===_a||_a.setMin(v),this)}randomizationFactor(v){var _a;return void 0===v?this._randomizationFactor:(this._randomizationFactor=v,null===(_a=this.backoff)||void 0===_a||_a.setJitter(v),this)}reconnectionDelayMax(v){var _a;return void 0===v?this._reconnectionDelayMax:(this._reconnectionDelayMax=v,null===(_a=this.backoff)||void 0===_a||_a.setMax(v),this)}timeout(v){return arguments.length?(this._timeout=v,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(fn){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket(this.uri,this.opts);let socket=this.engine,self1=this;this._readyState="opening",this.skipReconnect=!1;let openSubDestroy=on(socket,"open",function(){self1.onopen(),fn&&fn()}),onError=err=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",err),fn?fn(err):this.maybeReconnectOnOpen()},errorSub=on(socket,"error",onError);if(!1!==this._timeout){let timeout=this._timeout,timer=this.setTimeoutFn(()=>{openSubDestroy(),onError(Error("timeout")),socket.close()},timeout);this.opts.autoUnref&&timer.unref(),this.subs.push(()=>{this.clearTimeoutFn(timer)})}return this.subs.push(openSubDestroy),this.subs.push(errorSub),this}connect(fn){return this.open(fn)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let socket=this.engine;this.subs.push(on(socket,"ping",this.onping.bind(this)),on(socket,"data",this.ondata.bind(this)),on(socket,"error",this.onerror.bind(this)),on(socket,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(data){try{this.decoder.add(data)}catch(e){this.onclose("parse error",e)}}ondecoded(packet){nextTick(()=>{this.emitReserved("packet",packet)},this.setTimeoutFn)}onerror(err){this.emitReserved("error",err)}socket(nsp,opts){let socket=this.nsps[nsp];return socket?this._autoConnect&&!socket.active&&socket.connect():(socket=new socket_Socket(this,nsp,opts),this.nsps[nsp]=socket),socket}_destroy(socket){for(let nsp of Object.keys(this.nsps))if(this.nsps[nsp].active)return;this._close()}_packet(packet){let encodedPackets=this.encoder.encode(packet);for(let i=0;i<encodedPackets.length;i++)this.engine.write(encodedPackets[i],packet.options)}cleanup(){this.subs.forEach(subDestroy=>subDestroy()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(reason,description){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",reason,description),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let self1=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let delay=this.backoff.duration();this._reconnecting=!0;let timer=this.setTimeoutFn(()=>{!self1.skipReconnect&&(this.emitReserved("reconnect_attempt",self1.backoff.attempts),self1.skipReconnect||self1.open(err=>{err?(self1._reconnecting=!1,self1.reconnect(),this.emitReserved("reconnect_error",err)):self1.onreconnect()}))},delay);this.opts.autoUnref&&timer.unref(),this.subs.push(()=>{this.clearTimeoutFn(timer)})}}onreconnect(){let attempt=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",attempt)}}let cache={};function esm_lookup(uri,opts){let io;"object"==typeof uri&&(opts=uri,uri=void 0);let parsed=function(uri,path="",loc){let obj=uri;loc=loc||"undefined"!=typeof location&&location,null==uri&&(uri=loc.protocol+"//"+loc.host),"string"==typeof uri&&("/"===uri.charAt(0)&&(uri="/"===uri.charAt(1)?loc.protocol+uri:loc.host+uri),/^(https?|wss?):\/\//.test(uri)||(uri=void 0!==loc?loc.protocol+"//"+uri:"https://"+uri),obj=parse(uri)),!obj.port&&(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/";let host=-1!==obj.host.indexOf(":")?"["+obj.host+"]":obj.host;return obj.id=obj.protocol+"://"+host+":"+obj.port+path,obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port),obj}(uri,(opts=opts||{}).path||"/socket.io"),source=parsed.source,id=parsed.id,path=parsed.path,sameNamespace=cache[id]&&path in cache[id].nsps;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex||sameNamespace?io=new Manager(source,opts):(cache[id]||(cache[id]=new Manager(source,opts)),io=cache[id]),parsed.query&&!opts.query&&(opts.query=parsed.queryKey),io.socket(parsed.path,opts)}function GameClient_array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.assign(esm_lookup,{Manager:Manager,Socket:socket_Socket,io:esm_lookup,connect:esm_lookup});var GameClient=function(){function GameClient(){}var _proto=GameClient.prototype;return _proto.start=function(serverHost){var _this=this;this._socket=esm_lookup(serverHost,{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e4}),this._socket.on(SocketEvents_SocketEvents.Connect,this.onConnect.bind(this)),this._socket.on(SocketEvents_SocketEvents.PlayerJoined,this.onPlayerJoined.bind(this)),this._socket.on(SocketEvents_SocketEvents.SendPlayers,this.onSendPlayers.bind(this)),this._socket.on(SocketEvents_SocketEvents.ChatMessage,function(message){try{console.log(message)}catch(error){console.error("Error handling chat message:",error)}}),this._socket.on(SocketEvents_SocketEvents.ServerFrame,function(players){try{var frame=GameFrameDto_GameFrameDto.fromPlainObject(players);frame.players.size>0&&_this._engine.updatePlayer(frame)}catch(error){console.error("Error handling GameDataFrame:",error)}}),this._socket.on(SocketEvents_SocketEvents.ConnectError,function(error){console.error("Connection error:",error)})},_proto.loadEngine=function(engine){this._engine=engine},_proto.sendInput=function(inputDto){inputDto.direction&&inputDto.direction.length>0&&(console.log("sending input: id:"+inputDto.id+", direction: "+inputDto.direction),this._socket.emit(SocketEvents_SocketEvents.ClientFrame,{id:inputDto.id,direction:inputDto.direction}))},_proto.onConnect=function(){var _this__socket_id;this.AssertEngine(),this._engine.clientId=null!=(_this__socket_id=this._socket.id)?_this__socket_id:"",this._socket.emit(SocketEvents_SocketEvents.ChatMessage,"Hello, I am new client at your server")},_proto.AssertEngine=function(){if(!this._engine)throw Error("_engine not valid!")},_proto.onPlayerJoined=function(data){var socketId=data.socketId,role=data.role;console.log("User is connecting from client: "+socketId+" with role: "+role),console.log(this._engine.addPlayer(socketId,role).message)},_proto.onSendPlayers=function(data){console.log("Recived players:");for(var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=function(o,minLen){if(o){if("string"==typeof o)return GameClient_array_like_to_array(o,void 0);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return GameClient_array_like_to_array(o,void 0)}}(o))){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(data);!(_step=_iterator()).done;){var item=_step.value,socketId=item.socketId,role=item.role;console.log(this._engine.addPlayer(socketId,role).message)}this._engine.loadGameLoop()},_proto.disconnect=function(){this._socket.disconnect()},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(GameClient.prototype,[{key:"socket",get:function(){return this._socket}}]),GameClient}();function Configuration_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Configuration_extends(){return(Configuration_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var Configuration_Configuration=function(){function Configuration(_fileSystem){this._fileSystem=_fileSystem,this.config={}}var _proto=Configuration.prototype;return _proto.get=function(){return Configuration_extends({},this.config)},_proto.update=function(config){this.config=Configuration_extends({},this.config,config)},_proto.load=function(filePath){var fn,_this=this;return(fn=function(){var data,fileConfig;return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){try{data=_this._fileSystem.readFileSync(filePath),fileConfig=JSON.parse(data),_this.config=Configuration_extends({},_this.config,fileConfig)}catch(error){console.error("Error loading config from "+filePath+": ",error.message)}return[2]})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){Configuration_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Configuration_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},Configuration}();function server_JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var JsonLoader_JsonLoader=function(){function JsonLoader(_fileSystem){this._fileSystem=_fileSystem}return JsonLoader.prototype.getData=function(filePath,defaultValue){var fn,_this=this;return(fn=function(){return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:return _state.trys.push([0,2,,3]),[4,_this._fileSystem.readFile(filePath)];case 1:return[2,JSON.parse(_state.sent())];case 2:return console.error("Error loading data:",_state.sent()),[2,defaultValue];case 3:return[2]}})},function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){server_JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){server_JsonLoader_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})})()},JsonLoader}(),ServerGameLoop=function(){function ServerGameLoop(_logger){var _this=this;this._logger=_logger,this.updateCallbacks=[],this.paused=!1,this.fps=25,this.frameInterval=1e3/this.fps,this.lastFrameTime=0,this.loop=function(){if(!_this.paused){var currentTime=performance.now();_this.lastFrameTime||(_this.lastFrameTime=currentTime);var deltaTime=(currentTime-_this.lastFrameTime)/1e3;_this.updateCallbacks.forEach(function(callback){return callback(deltaTime)}),_this.sendFrame(),_this.lastFrameTime=currentTime,setTimeout(_this.loop,_this.frameInterval)}}}var _proto=ServerGameLoop.prototype;return _proto.start=function(){this.paused=!1,this.lastFrameTime=performance.now(),this.loop()},_proto.stop=function(){},_proto.pause=function(){this.paused=!0},_proto.resume=function(){this.paused=!1,this.lastFrameTime=performance.now(),this.loop()},_proto.subscribeUpdate=function(callback){this.updateCallbacks.push(callback)},_proto.unsubscribeUpdate=function(callback){this.updateCallbacks=this.updateCallbacks.filter(function(cb){return cb!==callback})},_proto.sendFrame=function(){var frame=this._playerCache.getGameFrameDto();if(!frame){this._logger.warn("Frame is empty");return}var plain=frame.toPlainObject();this._serverApi.sendFrame(plain)},_proto.subscribeRender=function(callback){},_proto.unsubscribeRender=function(callback){},function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ServerGameLoop.prototype,[{key:"playerCache",set:function(playerCache){this._playerCache=playerCache}},{key:"serverApi",set:function(serverApi){this._serverApi=serverApi}}]),ServerGameLoop}(),ServerEngineConfigurator=function(){function ServerEngineConfigurator(){}var protoProps,_proto=ServerEngineConfigurator.prototype;return _proto.getConfiguration=function(){return ServerEngineConfigurator.getConfigurationSingleton()},_proto.getLogger=function(){return ServerEngineConfigurator.getLoggerSingleton(this.getBit("logger"))},_proto.getJsonLoader=function(){return ServerEngineConfigurator.getJsonLoaderSingleton()},_proto.getGameLoop=function(){return ServerEngineConfigurator.getGameLoopSingleton(ServerEngineConfigurator.getLoggerSingleton(this.getBit("logger")))},_proto.getSystemMap=function(){return[createEngineSystemMap]},_proto.getBit=function(id){var _this__config_engineDependency_find,_this__config_engineDependency_find_isOn;return null!=(_this__config_engineDependency_find_isOn=null==(_this__config_engineDependency_find=this._config.engineDependency.find(function(c){return c.id===id}))?void 0:_this__config_engineDependency_find.isOn)&&_this__config_engineDependency_find_isOn},ServerEngineConfigurator.getInstance=function(){return ServerEngineConfigurator._instance||(ServerEngineConfigurator._instance=new ServerEngineConfigurator),ServerEngineConfigurator._instance},ServerEngineConfigurator.setFileSystem=function(fileSystem){ServerEngineConfigurator._fileSystem=fileSystem},protoProps=[{key:"config",set:function(config){this._config=config}}],function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}(ServerEngineConfigurator.prototype,protoProps),ServerEngineConfigurator}();function main_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function main_async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){main_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){main_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _start(){return(_start=main_async_to_generator(function*(){let data=yield Configuration.getConfigData("config/_config.json"),configPath=function(data){let{config_folder,config_format,config_list,config}=data,validConfig=config_list.find(c=>c===config);if(!validConfig)throw Error("No valid config found");return`${config_folder}\\${validConfig}.${config_format}`}(data);"client"===data.config?yield function(configPath){return _startMultiplayer.apply(this,arguments)}(configPath):yield function(configPath){return _startSingleplayer.apply(this,arguments)}(configPath)})).apply(this,arguments)}function _startMultiplayer(){return(_startMultiplayer=main_async_to_generator(function*(configPath){let builder=new GameBuilder(FootballClientConfigurator.getInstance());yield new ClientGameBuilder(new GameClient,builder).build(configPath,new ClientComponentMapperFactory().createComponentMapper(new ComponentMapperFactory().createComponentMapper())),builder.getEngine().eventSystem.subscribe("engineStart",()=>{engineStart(builder)})})).apply(this,arguments)}function engineStart(builder){builder.getEngine().start()}function _startSingleplayer(){return(_startSingleplayer=main_async_to_generator(function*(configPath){let builder=new GameBuilder(FootballConfigurator.getInstance());yield builder.build(configPath,new ComponentMapperFactory().createComponentMapper()),builder.getEngine().eventSystem.subscribe("engineStart",()=>{engineStart(builder)})})).apply(this,arguments)}ServerEngineConfigurator._instance=null,ServerEngineConfigurator.getConfigurationSingleton=createSingleton(function(){if(!ServerEngineConfigurator._fileSystem)throw Error("use setFileSystem in ServerEngineConfigurator to set _fileSystem");return new Configuration_Configuration(ServerEngineConfigurator._fileSystem)}),ServerEngineConfigurator.getGameLoopSingleton=createSingleton(function(logger){return new ServerGameLoop(logger)}),ServerEngineConfigurator.getJsonLoaderSingleton=createSingleton(function(){return new JsonLoader_JsonLoader(ServerEngineConfigurator._fileSystem)}),ServerEngineConfigurator.getLoggerSingleton=createSingleton(function(flag){return flag?LoggerSingleton.getLogger():new LoggerEmpty}),(function(){return _start.apply(this,arguments)})().then(()=>{}).catch(error=>{console.error(error)})}},__webpack_require__=>{__webpack_require__(__webpack_require__.s=208)}]);